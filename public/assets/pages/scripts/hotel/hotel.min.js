$(document).ready(function(){var n,i,o=!1;$("#fileupload").fileupload({disableImageResize:!1,autoUpload:!1,disableImageResize:/Android(?!.*Chrome)|Opera/.test(window.navigator.userAgent),maxFileSize:5e6,acceptFileTypes:/(\.|\/)(gif|jpe?g|png)$/i}),$("#fileupload").fileupload("option",{previewMaxWidth:100,previewMaxHeight:78},"redirect",window.location.href.replace(/\/[^\/]*$/,"/cors/result.html?%s")),$(".trigger-location").on("click, focus",function(e){n=$(this),i=$(this).next(),$("#modal-location").modal("show")}),$(".hotel-category").barrating({theme:"fontawesome-stars"}),$("#tree").on("changed.jstree",function(e,t){if(t.selected.length){var a=t.instance.get_node(t.selected[0]).data;$(n).val(a.name),$(i).val(a.id),$("#node-data :input[name=name]").val(a.name),$("#modal-location").modal("hide")}$("#tree").jstree("deselect_all",!0)}).jstree({core:{data:{type:"POST",dataType:"json",url:routeLocationReadActive,data:function(e){return{id:e.id}}}},plugins:["state","contextmenu"]}),$.fn.dataTable.ext.errMode="none";var p=$("#table").on("error.dt",function(e,t,a,n){}).on("processing.dt",function(e,t,a){App.showMask(a,$(this)),App.reloadToolTips()}).on("init.dt",function(){}).DataTable({processing:!0,serverSide:!0,sDom:"ltip",iDisplayLength:25,ajax:{url:routeRead,type:"POST",complete:function(e,t){"200"!=e.status&&toastr.error("Please check your connection and try again.","Error on loading the content"),$(".br-readonly").on("click",function(e){e.preventDefault()})}},order:[[1,"asc"]],columns:[{data:"id",name:"id",visible:!1},{data:"name",name:"name"},{data:"category",name:"category",data:function(e,t,a,n){for(var i=parseInt(e.category),o='<div class="br-wrapper br-theme-fontawesome-stars"><div class="br-widget br-readonly">',r=0;r<i;r++)o+='<a href="#" class="br-selected"></a>';return o+="</div></div>"}},{data:"chain",name:"chain"},{data:"active",name:"active",className:"dt-center",data:function(e,t,a,n){var i='<span><i class="fa fa-close dt-active dt-active-0"></i></span>';return 1==e.active&&(i='<span><i class="fa fa-check dt-active dt-active-1"></i></span>'),i}},{data:"hotel",name:"hotel",visible:!1},{targets:"actions",orderable:!1,name:"actions",className:"dt-center",data:function(e,t,a,n){return'<div class="dt-actions"><a class="btn btn-default btn-circle btn-icon-only btn-action dt-view" data-toggle="modal" href="#modal-info"><i class="glyphicon glyphicon-eye-open btn-action-icon"></i></a><a class="btn btn-default btn-circle btn-icon-only btn-action dt-edit" data-toggle="modal" href="#modal-edit"><i class="icon-pencil btn-action-icon"></i></a><a class="btn btn-default btn-circle btn-icon-only btn-action dt-delete" href="javascript:;" data-popout="true" data-placement="left"data-btn-ok-label="Yes" data-btn-ok-class="btn-sm btn-success"  data-btn-ok-icon-content="check" data-btn-cancel-label="No" data-btn-cancel-class="btn-sm btn-danger" data-btn-cancel-icon-content="close" data-title="Are you sure?" data-content=""><i class="icon-trash btn-action-icon"></i></a><a class="btn btn-default btn-circle btn-icon-only btn-action dt-image" href="javascript:;"><i class="icon-camera btn-action-icon"></i></a></div>'}}]});$("#table_length").hide(),$(".search").on("click",function(e){$("#search-section").slideToggle()}),$(".reload").on("click",function(e){p.draw()}),$(".add").on("click",function(){r.validate().resetForm(),r[0].reset(),$("#modal-add :input[name=category]").barrating("set",""),$("#modal-add .js-data-ajax").val(null).trigger("change")}),$(".lenght-option").on("click",function(){var e=$(this).attr("data");$(this).parent().parent().prev("a").text(e);var t=$("select[name=table_length]");t.val(e),t.change()}),$.validator.addMethod("greaterThanZero",function(e,t,a){return this.optional(t)||0<parseInt(e)},"At least one element is required.");var r=$("#form-add");r.validate({errorElement:"span",errorClass:"help-block help-block-error",focusInvalid:!1,ignore:"",rules:{name:{required:!0}},errorPlacement:function(e,t){0<t.parents(".mt-radio-list").size()||0<t.parents(".mt-checkbox-list").size()?(0<t.parents(".mt-radio-list").size()&&e.appendTo(t.parents(".mt-radio-list")[0]),0<t.parents(".mt-checkbox-list").size()&&e.appendTo(t.parents(".mt-checkbox-list")[0])):0<t.parents(".mt-radio-inline").size()||0<t.parents(".mt-checkbox-inline").size()?(0<t.parents(".mt-radio-inline").size()&&e.appendTo(t.parents(".mt-radio-inline")[0]),0<t.parents(".mt-checkbox-inline").size()&&e.appendTo(t.parents(".mt-checkbox-inline")[0])):0<t.parent(".input-group").size()?e.insertAfter(t.parent(".input-group")):t.attr("data-error-container")?e.appendTo(t.attr("data-error-container")):t.hasClass("hotel-category")?e.insertAfter(t.next()):t.hasClass("hotel-type")?e.insertAfter(t.next()):e.insertAfter(t)},invalidHandler:function(e,t){toastr.error("Please check the entry fields.","Error")},highlight:function(e){$(e).closest(".form-group").addClass("has-error")},unhighlight:function(e){$(e).closest(".form-group").removeClass("has-error")},success:function(e){e.closest(".form-group").removeClass("has-error")},submitHandler:function(n){var i=$(n).find("button[type=submit]:focus").attr("data"),e=new FormData(r[0]);$.ajax({url:routeCreate,type:"POST",data:e,contentType:!1,processData:!1,beforeSend:function(){App.showMask(!0,r)},complete:function(e,t){if(App.showMask(!1,r),"200"!=e.status)toastr.error("Please check your connection and try again.","Error on loading the content");else{var a=$.parseJSON(e.responseText);"success"==a.status?(toastr.success(a.message,"Success"),r[0].reset(),o=!0,"accept"==i&&$(n).find("button.cancel-form").click()):toastr.error(a.message,"Error")}}})}}),$(".mt-checkbox").change(function(){$(".mt-checkbox > input[type=checkbox]").is(":checked")?$(".mt-checkbox > input[type=checkbox]").val(1):$(".mt-checkbox > input[type=checkbox]").val(0)});var m=$("#form-edit");m.validate({errorElement:"span",errorClass:"help-block help-block-error",focusInvalid:!1,ignore:"",rules:{name:{required:!0}},errorPlacement:function(e,t){0<t.parents(".mt-radio-list").size()||0<t.parents(".mt-checkbox-list").size()?(0<t.parents(".mt-radio-list").size()&&e.appendTo(t.parents(".mt-radio-list")[0]),0<t.parents(".mt-checkbox-list").size()&&e.appendTo(t.parents(".mt-checkbox-list")[0])):0<t.parents(".mt-radio-inline").size()||0<t.parents(".mt-checkbox-inline").size()?(0<t.parents(".mt-radio-inline").size()&&e.appendTo(t.parents(".mt-radio-inline")[0]),0<t.parents(".mt-checkbox-inline").size()&&e.appendTo(t.parents(".mt-checkbox-inline")[0])):0<t.parent(".input-group").size()?e.insertAfter(t.parent(".input-group")):t.attr("data-error-container")?e.appendTo(t.attr("data-error-container")):t.hasClass("hotel-category")?e.insertAfter(t.next()):t.hasClass("hotel-type")?e.insertAfter(t.next()):e.insertAfter(t)},invalidHandler:function(e,t){toastr.error("Please check the entry fields.","Error")},highlight:function(e){$(e).closest(".form-group").addClass("has-error")},unhighlight:function(e){$(e).closest(".form-group").removeClass("has-error")},success:function(e){e.closest(".form-group").removeClass("has-error")},submitHandler:function(n){var i=$(n).find("button[type=submit]:focus").attr("data"),e=new FormData(m[0]);$.ajax({url:routeUpdate,type:"POST",data:e,contentType:!1,processData:!1,beforeSend:function(){App.showMask(!0,m)},complete:function(e,t){if(App.showMask(!1,m),"200"!=e.status)toastr.error("Please check your connection and try again.","Error on loading the content");else{var a=$.parseJSON(e.responseText);"success"==a.status?(toastr.success(a.message,"Success"),o=!0,"accept"==i&&$(n).find("button.cancel-form").click()):toastr.error(a.message,"Error")}}})}}),$("#table tbody").on("click",".dt-view",function(e){var t=p.row($(this).parents("tr")).data().hotel,a=null!=t.country?t.country.name:"",n=null!=t.state?t.state.name:"",i=null!=t.city?t.city.name:"",o=null!=t.hotel_chain?t.hotel_chain.name:"";$("#modal-info :input[name=name]").val(t.name),$("#modal-info :input[name=country-text]").val(a),$("#modal-info :input[name=state-text]").val(n),$("#modal-info :input[name=city-text]").val(i),$("#modal-info :input[name=postal-code]").val(t.postal_code),$("#modal-info :input[name=address]").val(t.address),$("#modal-info :input[name=category]").barrating("readonly",!0);var r=null!=t.category?t.category:"";$("#modal-info :input[name=category]").barrating("set",r),$("#modal-info :input[name=hotel-chain]").val(o),$("#modal-info :input[name=admin-phone]").val(t.admin_phone),$("#modal-info :input[name=admin-fax]").val(t.admin_fax),$("#modal-info :input[name=web-site]").val(t.web_site),$("#modal-info :input[name=turistic-licence]").val(t.turistic_licence),$("#modal-info :input[name=email]").val(t.email),$("#modal-info :input[name=description]").val(t.description),1==t.active?($("#modal-info :input[name=active]").prop("checked","checked"),$("#modal-info :input[name=active]").val(1)):($("#modal-info :input[name=active]").prop("checked",""),$("#modal-info :input[name=active]").val(0)),e.preventDefault()}),$("#table tbody").on("click",".dt-edit",function(e){$(".parent-select").html(""),m.validate().resetForm(),m[0].reset();var t=p.row($(this).parents("tr")).data(),a=t.hotel,n=null!=a.country?a.country.name:"",i=null!=a.country?a.country.id:"",o=null!=a.state?a.state.name:"",r=null!=a.state?a.state.id:"",c=null!=a.city?a.city.name:"",s=null!=a.city?a.city.id:"",l=(null!=a.hotel_chain&&a.hotel_chain.name,null!=a.hotel_chain_id?a.hotel_chain_id:"");$("#modal-edit :input[name=id]").val(t.id),$("#modal-edit :input[name=name]").val(a.name),$("#modal-edit :input[name=country-text]").val(n),$("#modal-edit :input[name=state-text]").val(o),$("#modal-edit :input[name=city-text]").val(c),$("#modal-edit :input[name=country-id]").val(i),$("#modal-edit :input[name=state-id]").val(r),$("#modal-edit :input[name=city-id]").val(s),$("#modal-edit :input[name=postal-code]").val(a.postal_code),$("#modal-edit :input[name=address]").val(a.address);var d=null!=a.category?a.category:"";$("#modal-edit :input[name=category]").barrating("set",d),$("#modal-edit :input[name=hotel-chain-id]").val(l),$("#modal-edit :input[name=admin-phone]").val(a.admin_phone),$("#modal-edit :input[name=admin-fax]").val(a.admin_fax),$("#modal-edit :input[name=web-site]").val(a.web_site),$("#modal-edit :input[name=turistic-licence]").val(a.turistic_licence),$("#modal-edit :input[name=email]").val(a.email),$("#modal-edit :input[name=description]").val(a.description),1==a.active?($("#modal-edit :input[name=active]").prop("checked","checked"),$("#modal-edit :input[name=active]").val(1)):($("#modal-edit :input[name=active]").prop("checked",""),$("#modal-edit :input[name=active]").val(0)),e.preventDefault()}),$("#table tbody").on("click",".dt-delete",function(e){var t=p.row($(this).parents("tr")).data();$(this).confirmation("show"),$(this).on("confirmed.bs.confirmation",function(){$.ajax({url:routeDelete,type:"POST",data:{id:t.id},beforeSend:function(){App.showMask(!0,r)},complete:function(e,t){if(App.showMask(!1,r),"200"!=e.status)toastr.error("Please check your connection and try again.","Error on loading the content");else{var a=$.parseJSON(e.responseText);"success"==a.status?(toastr.success(a.message,"Success"),p.draw()):toastr.error(a.message,"Error")}}})}),e.preventDefault()}),$("#table tbody").on("click",".dt-image",function(e){$("#fileupload").find(".files").empty();var t=p.row($(this).parents("tr")).data().id;$("#modal-image :input[name=id]").val(t),$("#fileupload").addClass("fileupload-processing"),$.ajax({url:routeImages,dataType:"json",data:{id:t},type:"POST",context:$("#fileupload")[0]}).always(function(){$(this).removeClass("fileupload-processing")}).done(function(e){$(this).fileupload("option","done").call(this,$.Event("done"),{result:e}),$("#modal-image").modal("layout")}),$("#modal-image").modal("show")}),$(".cancel-form").on("click",function(e){o&&(p.draw(),o=!1)}),$(".btn-search-reset").on("click",function(e){e.preventDefault(),$("#search-section :input[name=name]").val(""),$("#search-section :input[name=active]").val("")}),$(".btn-search-cancel").on("click",function(e){e.preventDefault(),$("#search-section").slideToggle()}),$(".btn-search-submit").on("click",function(e){e.preventDefault(),p.columns("name:name").search($("#search-section :input[name=name]").val()).columns("active:name").search($("#search-section :input[name=active]").val()).draw()})});