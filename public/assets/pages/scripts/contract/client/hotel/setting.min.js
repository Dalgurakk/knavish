$(document).ready(function(){var c=!1,r=$("#search-accomodation"),l=null,N=null,d=!1;function o(){$.ajax({url:routeContract,type:"POST",data:{contractId:contractId},beforeSend:function(){App.showMask(!0,r)},complete:function(e,t){if(App.showMask(!1,r),"419"==e.status)location.reload(!0);else if("200"!=e.status)toastr.error("Please check your connection and try again.","Error on loading the content");else{var a=JSON.parse(e.responseText);null==(l=a.data)?toastr.warning(a.message,"Warning"):($("#search-accomodation :input[name=contract]").next().find(".select2-selection__rendered").html(l.name+'<span class="select2-selection__placeholder"></span>'),i(l),$(".filter-content").show())}}})}o(),$(".btn-refresh").on("click",function(){o(),d=!1}),$("#board-type").change(function(){d&&$(".btn-search-submit").click()}),$("#search-accomodation :input[name=contract]").select2({width:"off",ajax:{url:routeSearch,type:"POST",dataType:"json",delay:250,data:function(e){return{q:e.term,page:e.page}},processResults:function(e,t){return{results:e}},complete:function(e,t){"419"==e.status&&location.reload(!0)},cache:!0},escapeMarkup:function(e){return e},minimumInputLength:3,templateResult:function(e){return e.loading?e.text:"<div class=''><div class=''>"+e.name+"</div></div>"},templateSelection:function(e){return e.name}}),$("#search-accomodation :input[name=contract]").on("select2:select select2:unselect",function(e){var t=e.params.data;if(t.selected){d=!1,contractId=t.id,o(),i(l);var a=window.location.href;if(0<a.indexOf("?")){var n=a.substring(0,a.indexOf("?"));window.history.replaceState({},document.title,n)}}}),$("#modal-setting :input[name=setting-from]").datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0,format:"dd.mm.yyyy",orientation:"bottom"}).on("changeDate",function(e){var t=$(this).val(),a=$("#modal-setting :input[name=setting-to]").val(),n=moment(t,"DD.MM.YYYY"),o=moment(a,"DD.MM.YYYY");0!=t&&""!=t&&moment(o).isBefore(n)&&$("#modal-setting :input[name=setting-to]").datepicker("setDate",new Date(moment(t,"DD.MM.YYYY")))}),$("#modal-setting :input[name=setting-to]").datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0,format:"dd.mm.yyyy",orientation:"bottom"}).on("changeDate",function(e){var t=$(this).val(),a=$('input[name="setting-from"]').val(),n=moment(a,"DD.MM.YYYY"),o=moment(t,"DD.MM.YYYY");0!=a&&""!=a&&moment(o).isBefore(n)&&$('input[name="setting-from"]').datepicker("setDate",new Date(moment(t,"DD.MM.YYYY")))}),$(".add-row-setting").on("click",function(e){e.preventDefault();var i=$.now(),t='<div class="range range-optional" data="'+i+'"><div class="col-md-5 col-sm-5 col-xs-5"><div class="form-group"><label>From</label><div class="input-icon left"><i class="fa fa-calendar"></i><input type="text" class="form-control date-picker" name="setting-from-'+i+'"></div></div></div><div class="col-md-5 col-sm-5 col-xs-5"><div class="form-group"><label>To</label><div class="input-icon left"><i class="fa fa-calendar"></i><input type="text" class="form-control date-picker" name="setting-to-'+i+'"></div></div></div><div class="col-md-2 col-sm-2 col-xs-2"><div class="form-group"><a class="btn red btn-outline delete-row" href="#" data="'+i+'"><i class="fa fa-trash"></i></a></div></div></div>';$(".range-container").append(t),$('input[name="setting-from-'+i+'"]').datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0,format:"dd.mm.yyyy",orientation:"bottom"}).on("changeDate",function(e){var t=$(this).val(),a=$('input[name="setting-to-'+i+'"]').val(),n=moment(t,"DD.MM.YYYY"),o=moment(a,"DD.MM.YYYY");0==t||""==t||0!=a&&""!=a&&!moment(o).isBefore(n)||$('input[name="setting-to-'+i+'"]').datepicker("setDate",new Date(moment(t,"DD.MM.YYYY")))}),$('input[name="setting-to-'+i+'"]').datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0,format:"dd.mm.yyyy",orientation:"bottom"}).on("changeDate",function(e){var t=$(this).val(),a=$('input[name="setting-from-'+i+'"]').val(),n=moment(a,"DD.MM.YYYY"),o=moment(t,"DD.MM.YYYY");0==t||""==t||0!=a&&""!=a&&!moment(o).isBefore(n)||$('input[name="setting-from-'+i+'"]').datepicker("setDate",new Date(moment(t,"DD.MM.YYYY")))});var a=moment(l.hotel_contract.valid_from,"YYYY-MM-DD"),n=moment(l.hotel_contract.valid_to,"YYYY-MM-DD");$('input[name="setting-from-'+i+'"]').datepicker("setStartDate",new Date(a)),$('input[name="setting-from-'+i+'"]').datepicker("setEndDate",new Date(n)),$('input[name="setting-to-'+i+'"]').datepicker("setStartDate",new Date(a)),$('input[name="setting-to-'+i+'"]').datepicker("setEndDate",new Date(n)),P.validate(),$('input[name="setting-from-'+i+'"]').rules("add","required"),$('input[name="setting-to-'+i+'"]').rules("add","required"),$('.delete-row[data="'+i+'"]').on("click",function(e){$('.range[data="'+i+'"]').remove(),e.preventDefault()})}),$('#modal-change :input[name="change-room"]').select2({width:"off"});var m=$("#modal-setting .table-room-type").dataTable({sDom:"tip",autoWidth:!1,columnDefs:[{orderable:!1,className:"dt-center",targets:[0],width:"20%"},{visible:!1,targets:[1]}],order:[[3,"asc"]],lengthMenu:[[-1],["All"]],pageLength:10});m.find(".group-checkable").change(function(){var e=jQuery(this).attr("data-set"),t=jQuery(this).is(":checked");jQuery(e).each(function(){t?($(this).prop("checked",!0),$(this).parents("tr").addClass("active")):($(this).prop("checked",!1),$(this).parents("tr").removeClass("active"))})}),m.on("change","tbody tr .checkboxes",function(){$(this).parents("tr").toggleClass("active")}),$("input[name=search-code]").on("keyup",function(){m.api().columns(2).search($('input[name="search-code"]').val()).columns(3).search($('input[name="search-name"]').val()).draw()}),$("input[name=search-name]").on("keyup",function(){m.api().columns(2).search($('input[name="search-code"]').val()).columns(3).search($('input[name="search-name"]').val()).draw()}),$("input[name=share]").change(function(){$(this).is(":checked")?$(".share-rooms").show():$(".share-rooms").hide()}),$("input[name=change]").change(function(){$(this).is(":checked")&&($('#modal-change :input[name="change-room"]').val($('#modal-setting :input[name="room-type-id"]').val()).trigger("change"),$("#modal-change").modal("show"))}),$(".cancel-change").on("click",function(e){$("#modal-setting :input[name=change]").prop("checked",""),$("#modal-setting :input[name=change]").val(0)}),$(".accept-change").on("click",function(e){for(var t=$('#modal-change :input[name="change-room"]').val(),a=l.hotel_contract.room_types,n=null,o=0;o<a.length;o++)if(t==a[o].id){n=a[o];break}$('#modal-setting :input[name="room-type-id"]').val(t),$("#modal-setting .room-name-header").html(n.code+": "+n.name),$(".cancel-change").click(),j(),$("#modal-setting :input[name=share]").prop("checked",""),$("#modal-setting :input[name=share]").val(0)}),$(".btn-search-submit").on("click",function(e){if(e.preventDefault(),null==l)toastr.error("Invalid contract.","Error");else{var t=moment($("input[name=from]").datepicker("getDate")).format("DD.MM.YYYY"),a=moment($("input[name=to]").datepicker("getDate")).format("DD.MM.YYYY"),n=[],o=$("#board-type").val();$(".room-selected:checked").each(function(){n.push($(this).val())});var i=[];$(".row-selected:checked").each(function(){i.push($(this).val())}),$.ajax({url:routeData,type:"POST",data:{id:l.id,from:t,to:a,boardType:o,rooms:JSON.stringify(n),rows:JSON.stringify(i)},beforeSend:function(){App.showMask(!0,r)},complete:function(e,t){if(App.showMask(!1,r),"419"==e.status)location.reload(!0);else if("200"!=e.status)toastr.error("Please check your connection and try again.","Error on loading the content");else{d=!0;var a=$.parseJSON(e.responseText);if("success"==a.status){var n=a.table;$(".result-container").html(""),$(".result-container").html('<div class="note note-info"><p>Costing and pricing are all per person per night.</p></div>'),$(".result-container").append(n);var s=a.offers;l.hotel_contract.offers=s,N=a.operateMeasures,a.from,a.to,A=(C=l).hotel_contract.room_types,E=C.hotel_contract.measures,$(".item-setting").on("click",function(){if($(this).hasClass("complement")){var e=$(this).attr("data-measure-code");if("offer"==e){$(this).attr("data");var t=JSON.parse("["+$(this).attr("data")+"]");if(!(0<t.length))return!1;var a=C.hotel_contract.offers;$("#modal-offers .offers-container").html("");for(var n="",o=0;o<t.length;o++)for(var i=0;i<a.length;i++)if(t[o]==a[i].id){for(var s=a[i].rooms,r="",c=0;c<s.length;c++)r+=0==c?s[c].room_type.code+": "+s[c].room_type.name:", "+s[c].room_type.code+": "+s[c].room_type.name;for(var l=a[i].boards,d="",c=0;c<l.length;c++)d+=0==c?l[c].board_type.code+": "+l[c].board_type.name:", "+l[c].board_type.code+": "+l[c].board_type.name;for(var m=a[i].ranges,p="",c=0;c<m.length;c++){var u=moment(m[c].from,"YYYY-MM-DD").format("DD.MM.YYYY"),h=moment(m[c].to,"YYYY-MM-DD").format("DD.MM.YYYY");p+=0==c?u==h?u:u+" - "+h:u==h?", "+u:", "+u+" - "+h}var v="",f="",g=$.now();if("early_booking"==a[i].offer_type.code){if(v='<div class="actions"><a href="javascript:;" class="btn btn-default btn-sm btn-offer-details" data="'+g+'" style="margin-right: 5px;"><i class="fa fa-binoculars"></i> Details </a></div>',null!=a[i].discount&&(f+='<div class="row static-info"><div class="col-md-3 name"> Discount: </div>',1==a[i].discount_type?f+='<div class="col-md-9 value"> '+a[i].discount+"%</div></div>":f+='<div class="col-md-9 value">$'+a[i].discount+" </div></div>"),null!=a[i].booking_type){var k="";1==a[i].booking_type?k=a[i].booking_date_from==a[i].booking_date_to?moment(a[i].booking_date_from,"YYYY-MM-DD").format("DD.MM.YYYY"):moment(a[i].booking_date_from,"YYYY-MM-DD").format("DD.MM.YYYY")+" - "+moment(a[i].booking_date_to,"YYYY-MM-DD").format("DD.MM.YYYY"):2==a[i].booking_type&&(k=a[i].days_prior_from==a[i].days_prior_to?a[i].days_prior_from+" days prior to the check-in":a[i].days_prior_from+" - "+a[i].days_prior_to+" days prior to the check-in"),f+='<div class="row static-info"><div class="col-md-3 name"> Booking Date: </div><div class="col-md-9 value"> '+k+" </div></div>"}null!=a[i].payment_date&&(f+='<div class="row static-info"><div class="col-md-3 name"> Payment Date: </div><div class="col-md-9 value"> '+moment(a[i].payment_date,"YYYY-MM-DD").format("DD.MM.YYYY")+' </div></div><div class="row static-info"><div class="col-md-3 name"> Percentage Due: </div><div class="col-md-9 value"> '+a[i].percentage_due+"%</div></div>"),null!=a[i].minimum_stay&&(f+='<div class="row static-info"><div class="col-md-3 name"> Minimum Stay: </div><div class="col-md-9 value"> '+a[i].minimum_stay+" </div></div>");var Y=1==a[i].non_refundable?"Yes":"No";f+='<div class="row static-info"><div class="col-md-3 name"> Non Refundable: </div><div class="col-md-9 value"> '+Y+" </div></div>"}n+='<div class="col-md-12"><div class="portlet box blue"><div class="portlet-title"><div class="caption"><i class="fa fa-gift"></i>'+a[i].name+'</div><div class="tools"><a href="javascript:;" class="collapse"> </a></div>'+v+'</div><div class="portlet-body"><div class="row static-info"><div class="col-md-3 name"> Denomination: </div><div class="col-md-9 value"> '+a[i].name+'</div></div><div class="row static-info"><div class="col-md-3 name"> Type: </div><div class="col-md-9 value"> '+a[i].offer_type.name+' </div></div><div class="row static-info"><div class="col-md-3 name"> Ranges: </div><div class="col-md-9 value"> '+p+' </div></div><div class="row static-info"><div class="col-md-3 name"> Board Types: </div><div class="col-md-9 value"> '+d+' </div></div><div class="row static-info"><div class="col-md-3 name"> Rooms: </div><div class="col-md-9 value"> '+r+' </div></div><div class="offer-detail-container hidden" data="'+g+'">'+f+"</div></div></div></div>";break}$("#modal-offers .offers-container").append(n),$(".btn-offer-details").on("click",function(){var e=$(this).attr("data");$('.offer-detail-container[data="'+e+'"]').hasClass("hidden")?$('.offer-detail-container[data="'+e+'"]').removeClass("hidden"):$('.offer-detail-container[data="'+e+'"]').addClass("hidden")}),$("#modal-offers").modal("show")}}else{for(var b=!1,o=0;o<E.length;o++)if("stop_sale"==E[o].code){b=!0;break}if(!b)return!1;$("#modal-setting .expand").each(function(){$(this).click()});var D=$(this).attr("data-room-type-id");$("#modal-setting :input[name=room-type-id]").val(D);for(var y=null,M=N,i=0;i<A.length;i++)if(A[i].id==D){y=A[i];break}$(".cost-price-container").html(""),$(".measures-container").html("");for(var o=0;o<M.length;o++)if("stop_sale"==M[o].code){var _='<div class="row"><div class="col-md-12"><div class="col-md-5 col-sm-5 col-xs-5"><div class="form-group"><label>'+M[o].name+'</label><select id="select-stop-sale" class="form-control measure-input" name="'+M[o].code+'" readonly="" disabled="disabled"><option value="0">Open Sales</option><option value="1">Stop Sales</option><option value="2">On Request</option></select></div></div><div class="col-md-7 col-sm-7 col-xs-7"><div class="mt-checkbox-inline"><label class="mt-checkbox mt-checkbox-outline no-margin-bottom margin-top-15 margin-right-40"> Set<input type="checkbox" class="set" value="" name="set-'+M[o].code+'" data-set="'+M[o].code+'" data-measure-id="'+M[o].id+'" /><span></span></label><label class="mt-checkbox mt-checkbox-outline no-margin-bottom margin-top-15 margin-right-30"> Use From The Provider<input type="checkbox" class="set" value="0" name="unset-'+M[o].code+'" data-unset="'+M[o].code+'" data-measure-id="'+M[o].id+'"/><span></span></label></div></div></div></div>';$(".measures-container").append(_),$("#select-stop-sale").val(0).change(),$('input[name="set-'+M[o].code+'"]').change(function(){var e=$(this).attr("data-set");$(this).is(":checked")?($("#select-stop-sale").removeAttr("readonly",""),$('input[name="unset-'+e+'"]').prop("checked",""),$("#select-stop-sale").removeAttr("disabled"),$(this).val(1)):($("#select-stop-sale").attr("readonly",!0),$("#select-stop-sale").attr("disabled","disabled"))}),$('input[name="unset-'+M[o].code+'"]').change(function(){var e=$(this).attr("data-unset");$(this).is(":checked")?($("input[name="+e+"]").prop("readonly",!0),$('input[name="set-'+e+'"]').prop("checked",""),$(this).val($(this).attr("data-measure-id")),$("#select-stop-sale").attr("disabled","disabled")):$(this).val("0")})}P.validate(),P.validate().resetForm(),P[0].reset(),$("#modal-setting .room-name-header").html(y.code+": "+y.name);var w=$(this).attr("data-date");$("#modal-setting :input[name=setting-from]").datepicker("setDate",new Date(moment(w,"YYYY-MM-DD"))),$("#modal-setting :input[name=setting-to]").datepicker("setDate",new Date(moment(w,"YYYY-MM-DD"))),$("#modal-setting .measures-container :input").prop("readonly",!0),$("#modal-setting .measures-container :input").prop("checked",""),$(this).parents("tr").find("td:first").attr("data-measure-code"),$("#modal-setting :input[name=contract-id]").val(C.hotel_contract.id),$("#modal-setting :input[name=contract-client-id]").val(C.id),$("#modal-setting :input[name=market-id]").val($(this).attr("data-market-id"));for(var M=N,o=0;o<M.length;o++){var w=$(this).attr("data-date"),x=M[o].id,S=$(this).parents("table").find('td[data-date="'+w+'"][data-measure-id="'+x+'"]'),T=S.attr("data");if("stop_sale"==M[o].code||"allotment"==M[o].code||"release"==M[o].code){var O=S.attr("data-from-provider");1==O?$("#modal-setting :input[name=unset-"+M[o].code+"]").click():$("#modal-setting :input[name=set-"+M[o].code+"]").click(),"stop_sale"==M[o].code?(T=""==T?0:T,$("#select-stop-sale").val(T).change()):$('#modal-setting :input[name="'+M[o].code+'"]').val(T)}}$("#modal-setting .range-optional").each(function(){$(this).remove()}),j(),$("#modal-setting").modal("show")}}),$(".measure-detail").on("click",function(){var e=$(this).attr("data");$(this).hasClass("closed")?($(this).removeClass("closed"),$(this).addClass("opened"),$(this).html("-"),$('tr[data-parent="'+e+'"]').removeClass("hidden")):($(this).removeClass("opened"),$(this).addClass("closed"),$(this).html("+"),$('tr[data-parent="'+e+'"]').addClass("hidden"))}),$(".row-expanded:checked").each(function(){$('.measure-detail[data-measure="'+$(this).val()+'"]').click()}),$(".complement").each(function(){var e=$(this).attr("data-measure-code"),t=$(this).attr("data");if("offer"==e&&""!=t){for(var a=JSON.parse("["+t+"]"),n='<table class="table table-striped table-complement" width="100%" cellspacing="0" style="margin-bottom: 0"><thead><tr><th> # </th><th> Denomination </th><th> Type </th></thead><tbody>',o=0;o<a.length;o++)for(var i=0;i<s.length;i++)if(a[o]==s[i].id){n+="<tr><td>"+(o+1)+"</td><td>"+s[i].name+"</td><td>"+s[i].offer_type.name+"</td></tr>";break}n+="</tbody></table>",$(this).popover({trigger:"hover",container:"body",placement:"top",title:'<i class="fa fa-gift"></i> Offers',content:n,delay:{show:500,hide:100},html:!0,template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title porlet-title-setting" style="height: unset;"></h3><div class="popover-content" style="padding: 5px;"></div></div>'})}})}else toastr.error(a.message,"Error")}var C,A,E}})}});var P=$("#form-setting");function i(e){var t=e.hotel_contract,o=t.room_types,n=t.board_types,i=t.measures,a=e.hotel_contract.hotel.hotel_chain,s=e.client,r=1==t.active?"Enabled":"Disabled",c=e.price_rate.market.name;1==e.price_rate.type?c+=" (+ "+e.price_rate.value+"%)":c+=" (+ $"+e.price_rate.value+")",$("#search-accomodation :input[name=hotel]").val(t.hotel.name),$("#search-accomodation :input[name=hotel-chain]").val(a.name),$("#search-accomodation :input[name=price-rate]").val(c),$("#search-accomodation :input[name=status]").val(r),$("#search-accomodation :input[name=client]").val(s.name),$("#search-accomodation :input[name=period]").val(moment(t.valid_from,"YYYY-MM-DD").format("DD.MM.YYYY")+" - "+moment(t.valid_to,"YYYY-MM-DD").format("DD.MM.YYYY")),$(".result-container").html(""),$(".measures-list").html(""),$.each(i,function(e,t){var a='<div class="row"><div class="col-md-5"><label class="mt-checkbox mt-checkbox-outline mt-checkbox-row"><input type="checkbox" class="row-selected" checked value="'+i[e].id+'"> '+i[e].name+"<span></span></label></div>";"cost"!=i[e].code&&"price"!=i[e].code&&"allotment"!=i[e].code||(a+='<div class="col-md-7"><label class="mt-checkbox mt-checkbox-outline mt-checkbox-row"><input type="checkbox" class="row-expanded" value="'+i[e].code+'"> Expand '+i[e].name+"<span></span></label></div>"),a+="</div>",$(".measures-list").append(a)}),$("#board-type").empty(),$.each(n,function(e,t){var a='<option value="'+n[e].id+'"> '+n[e].code+": "+n[e].name+"</option>";$("#board-type").append(a)}),$(".room-types-list").html(""),$.each(o,function(e,t){var a='<label class="mt-checkbox mt-checkbox-outline mt-checkbox-row"><input type="checkbox" class="room-selected" checked value="'+o[e].id+'"> '+o[e].code+": "+o[e].name+"<span></span></label>";$(".room-types-list").append(a);var n='<option value="'+o[e].id+'" data-name="'+o[e].name+'"> '+o[e].code+": "+o[e].name+" (Max Pax: "+o[e].max_pax+", Min Pax: "+o[e].min_pax+", Max AD: "+o[e].max_adult+", Min AD: "+o[e].min_adult+", Max CH: "+o[e].max_children+", Min CH: "+o[e].min_children+", Max INF: "+o[e].max_infant+", Min INF: "+o[e].min_infant+")</option>";$('#modal-change :input[name="change-room"]').append(n)}),$("input[name=from]").datepicker("destroy"),$("input[name=to]").datepicker("destroy"),$(".datepicker-from-container").html(""),$(".datepicker-to-container").html("");var l='<label>From</label><div class="form-group"><div class="input-icon"><i class="fa fa-calendar"></i><input class="form-control datepicker" name="from"> </div></div>';$(".datepicker-from-container").append(l),l='<label>To</label><div class="form-group"><div class="input-icon"><i class="fa fa-calendar"></i><input class="form-control datepicker" name="to"> </div></div>',$(".datepicker-to-container").append(l),$(".datepicker").datepicker({format:"MM yyyy",viewMode:"months",minViewMode:"months",autoclose:!0,orientation:"bottom"});var d=moment(t.valid_from,"YYYY-MM-DD"),m=moment(t.valid_to,"YYYY-MM-DD"),p=moment(),u=p,h=p;p.isSameOrBefore(m)&&p.isSameOrAfter(d)?(u=moment(p).startOf("month"),h=moment(p).endOf("month")):p.isBefore(d)?(u=moment(d).startOf("month"),h=moment(d).endOf("month")):p.isAfter(m)&&(u=moment(m).startOf("month"),h=moment(m).endOf("month")),u.isBefore(d)&&(u=d),h.isAfter(m)&&(h=m),$("input[name=from]").datepicker("setStartDate",new Date(d)),$("input[name=from]").datepicker("setEndDate",new Date(m)),$("input[name=to]").datepicker("setStartDate",new Date(d)),$("input[name=to]").datepicker("setEndDate",new Date(m)),$("input[name=from]").datepicker("setDate",new Date(u)),$("input[name=to]").datepicker("setDate",new Date(h)),$("#modal-setting :input[name=setting-from]").datepicker("setStartDate",new Date(d)),$("#modal-setting :input[name=setting-from]").datepicker("setEndDate",new Date(m)),$("#modal-setting :input[name=setting-to]").datepicker("setStartDate",new Date(d)),$("#modal-setting :input[name=setting-to]").datepicker("setEndDate",new Date(m)),App.reloadToolTips()}function j(){$(".share-rooms").hide();var e=l.hotel_contract.room_types;if(1<e.length){m.api().clear().draw();for(var t=0;t<e.length;t++)e[t].id!=$('input[name="room-type-id"]').val()&&(m.api().row.add(['<label class="mt-checkbox mt-checkbox-single mt-checkbox-outline"><input type="checkbox" class="checkboxes" value="1" /><span></span></label>',e[t].id,e[t].code,e[t].name]).draw(!1),m.api().columns.adjust().draw());$(".share-container").show()}else $(".share-container").hide()}P.validate({errorElement:"span",errorClass:"help-block help-block-error",focusInvalid:!1,ignore:"",rules:{"setting-from":{required:!0,validDate:!0},"setting-to":{required:!0,validDate:!0}},errorPlacement:function(e,t){0<t.parents(".mt-radio-list").size()||0<t.parents(".mt-checkbox-list").size()?(0<t.parents(".mt-radio-list").size()&&e.appendTo(t.parents(".mt-radio-list")[0]),0<t.parents(".mt-checkbox-list").size()&&e.appendTo(t.parents(".mt-checkbox-list")[0])):0<t.parents(".mt-radio-inline").size()||0<t.parents(".mt-checkbox-inline").size()?(0<t.parents(".mt-radio-inline").size()&&e.appendTo(t.parents(".mt-radio-inline")[0]),0<t.parents(".mt-checkbox-inline").size()&&e.appendTo(t.parents(".mt-checkbox-inline")[0])):0<t.parent(".input-group").size()?e.insertAfter(t.parent(".input-group")):t.attr("data-error-container")?e.appendTo(t.attr("data-error-container")):e.insertAfter(t)},invalidHandler:function(e,t){toastr.error("Please check the entry fields.","Error")},highlight:function(e){$(e).closest(".form-group").addClass("has-error")},unhighlight:function(e){$(e).closest(".form-group").removeClass("has-error")},success:function(e){e.closest(".form-group").removeClass("has-error")},submitHandler:function(n){var o=$(n).find("button[type=submit]:focus").attr("data"),t=0;if($('#modal-setting :input[name^="set-"]').each(function(e){1==$(this).prop("checked")&&t++}),$('#modal-setting :input[name^="unset-"]').each(function(e){1==$(this).prop("checked")&&t++}),0==t)$(n).find("button.cancel-form").click();else{var e=new FormData(P[0]),a=$("#market").val(),i=[];$("#modal-setting .range").each(function(){var e={from:$(this).find('input[name^="setting-from"]').val(),to:$(this).find('input[name^="setting-to"]').val()};i.push(e)});var s=function(e){for(var t=[],a=m.api().rows(".active").data(),n=0;n<a.length;n++)t.push(a[n][1]);return t}(),r=$('input[name="room-type-id"]').val();s.push(parseInt(r)),e.append("room-types",JSON.stringify(s)),e.append("ranges",JSON.stringify(i)),e.append("market",a),$.ajax({url:routeSave,type:"POST",data:e,contentType:!1,processData:!1,beforeSend:function(){App.showMask(!0,P)},complete:function(e,t){if(App.showMask(!1,P),"419"==e.status)location.reload(!0);else if("200"!=e.status)toastr.error("Please check your connection and try again.","Error on loading the content");else{var a=$.parseJSON(e.responseText);"success"==a.status?(toastr.success(a.message,"Success"),c=!0,"accept"==o&&($(n).find("button.cancel-form").click(),P[0].reset())):toastr.error(a.message,"Error")}}})}}}),$(".cancel-form").on("click",function(e){c&&($(".btn-search-submit").click(),c=!1)}),$(".check-all-rooms").on("click",function(e){e.preventDefault(),"check"==$(this).attr("data")?($(this).attr("data","uncheck"),$(".room-selected").each(function(){$(this).prop("checked",!1)})):($(this).attr("data","check"),$(".room-selected").each(function(){$(this).prop("checked",!0)}))})});