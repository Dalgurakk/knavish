$(document).ready(function(){var l=!1,d=!1,s=$("#search-accomodation"),m=null,D=null,c=!1;$("#modal-setting :input[name=setting-from]").datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0,format:"dd.mm.yyyy",orientation:"bottom"}).on("changeDate",function(e){var t=$(this).val(),a=$("#modal-setting :input[name=setting-to]").val(),o=moment(t,"DD.MM.YYYY"),n=moment(a,"DD.MM.YYYY");0!=t&&""!=t&&moment(n).isBefore(o)&&$("#modal-setting :input[name=setting-to]").datepicker("setDate",new Date(moment(t,"DD.MM.YYYY")))}),$("#modal-setting :input[name=setting-to]").datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0,format:"dd.mm.yyyy",orientation:"bottom"}).on("changeDate",function(e){var t=$(this).val(),a=$('#modal-setting :input[name="setting-from"]').val(),o=moment(a,"DD.MM.YYYY"),n=moment(t,"DD.MM.YYYY");0!=a&&""!=a&&moment(n).isBefore(o)&&$('#modal-setting :input[name="setting-from"]').datepicker("setDate",new Date(moment(t,"DD.MM.YYYY")))}),$("#modal-import :input[name=import-from]").datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0,format:"dd.mm.yyyy",orientation:"bottom"}).on("changeDate",function(e){var t=$(this).val(),a=$("#modal-import :input[name=import-to]").val(),o=moment(t,"DD.MM.YYYY"),n=moment(a,"DD.MM.YYYY");0!=t&&""!=t&&moment(n).isBefore(o)&&$("#modal-import :input[name=import-to]").datepicker("setDate",new Date(moment(t,"DD.MM.YYYY")))}),$("#modal-import :input[name=import-to]").datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0,format:"dd.mm.yyyy",orientation:"bottom"}).on("changeDate",function(e){var t=$(this).val(),a=$('#modal-import :input[name="import-from"]').val(),o=moment(a,"DD.MM.YYYY"),n=moment(t,"DD.MM.YYYY");0!=a&&""!=a&&moment(n).isBefore(o)&&$('#modal-import :input[name="import-from"]').datepicker("setDate",new Date(moment(t,"DD.MM.YYYY")))}),$("#search-accomodation :input[name=contract]").select2({width:"off",ajax:{url:routeSearch,type:"POST",dataType:"json",delay:250,data:function(e){return{q:e.term,page:e.page}},processResults:function(e,t){return{results:e}},complete:function(e,t){"419"==e.status&&location.reload(!0)},cache:!0},escapeMarkup:function(e){return e},minimumInputLength:3,templateResult:function(e){return e.loading?e.text:"<div class=''><div class=''>"+e.name+"</div></div>"},templateSelection:function(e){return e.name}}),$("#search-accomodation :input[name=contract]").on("select2:select select2:unselect",function(e){var t=e.params.data;if(t.selected){c=!1,n(m=t);var a=window.location.href;if(0<a.indexOf("?")){var o=a.substring(0,a.indexOf("?"));window.history.replaceState({},document.title,o)}}}),$.ajax({url:routeContract,type:"POST",data:{contractId:contractId},beforeSend:function(){App.showMask(!0,s)},complete:function(e,t){if(App.showMask(!1,s),"419"==e.status)location.reload(!0);else if("200"!=e.status)toastr.error("Please check your connection and try again.","Error on loading the content");else{var a=JSON.parse(e.responseText);null==(m=a.data)?toastr.warning(a.message,"Warning"):($("#search-accomodation :input[name=contract]").next().find(".select2-selection__rendered").html(m.name+'<span class="select2-selection__placeholder"></span>'),n(m),$(".filter-content").show())}}}),$(".btn-import").on("click",function(e){e.preventDefault(),m.markets.length<=1?toastr.info("There are no price rates available to import.","Information"):swal({title:"Confirmation",text:"Are you sure you want to import the costs from the "+$("#import-cost-from-rate option:selected").text()+" price rate to the "+$("#market option:selected").text()+" price rate?",type:null,allowOutsideClick:!1,showConfirmButton:!0,showCancelButton:!0,confirmButtonClass:"green",cancelButtonClass:"red",closeOnConfirm:!0,closeOnCancel:!0,confirmButtonText:"Accept",cancelButtonText:"Cancel"},function(e){e&&$.ajax({url:routeImportCostFromPriceRate,type:"POST",data:{"contract-id":m.id,"price-rate-from":$("#import-cost-from-rate").val(),"price-rate-to":$("#market").val()},beforeSend:function(){App.showMask(!0,s)},complete:function(e,t){if(App.showMask(!1,s),"419"==e.status)location.reload(!0);else if("200"!=e.status)toastr.error("Please check your connection and try again.","Error on loading the content");else{var a=$.parseJSON(e.responseText);"success"==a.status?($(".btn-search-submit").click(),toastr.success(a.message,"Success")):"warning"==a.status?toastr.warning(a.message,"Warning"):toastr.error(a.message,"Error")}}})})}),$(".btn-search-submit").on("click",function(e){if(e.preventDefault(),null==m)toastr.error("Invalid contract.","Error");else{var t=moment($("input[name=from]").datepicker("getDate")).format("DD.MM.YYYY"),a=moment($("input[name=to]").datepicker("getDate")).format("DD.MM.YYYY"),o=$("#market").val(),n=$("#board-type").val(),i=[];$(".room-selected:checked").each(function(){i.push($(this).val())});var r=[];$(".row-selected:checked").each(function(){r.push($(this).val())}),$.ajax({url:routeData,type:"POST",data:{id:m.id,from:t,to:a,market:o,boardType:n,rooms:JSON.stringify(i),rows:JSON.stringify(r)},beforeSend:function(){App.showMask(!0,s)},complete:function(e,t){if(App.showMask(!1,s),"419"==e.status)location.reload(!0);else if("200"!=e.status)toastr.error("Please check your connection and try again.","Error on loading the content");else{c=!0;var a=$.parseJSON(e.responseText);if("success"==a.status){var o=a.table;$(".result-container").html(""),$(".result-container").html('<div class="note note-info"><p>Costing and pricing are all per person per night.</p></div>'),$(".result-container").append(o),D=a.operateMeasures,a.from,a.to,y=(k=m).room_types,$(".item-setting").on("click",function(){if($(this).hasClass("complement"));else{$('input[name^="cost"]').each(function(e){$(this).rules("remove","required")}),$('input[name^="price"]').each(function(e){$(this).rules("remove","required")}),$('input[name^="allotment"]').each(function(e){$(this).rules("remove","required")}),$('input[name^="release"]').each(function(e){$(this).rules("remove","required")}),$('input[name^="stop_sale"]').each(function(e){$(this).rules("remove","required")}),$("#modal-setting .expand").each(function(){$(this).click()});var e=$(this).attr("data-room-type-id");$("#modal-setting :input[name=room-type-id]").val(e);for(var t=null,a=D,o=0;o<y.length;o++)if(y[o].id==e){t=y[o];break}$(".measures-container").html("");for(var n=0;n<a.length;n++)if("offer"!=a[n].code&&"supplement"!=a[n].code&&"restriction"!=a[n].code)if("cost"==a[n].code){var i='<div class="row"><div class="col-md-12"><div class="col-md-5 col-sm-5 col-xs-5"><div class="form-group"><label>'+a[n].name+' Adult</label><input type="text" class="form-control measure-input" name="'+a[n].code+'" readonly></div></div><div class="col-md-7 col-sm-7 col-xs-7"><div class="mt-checkbox-inline"><label class="mt-checkbox mt-checkbox-outline no-margin-bottom margin-top-15 margin-right-40"> Set<input type="checkbox" class="set" value="1" name="set-'+a[n].code+'" data-set="'+a[n].code+'" data-measure-id="'+a[n].id+'" /><span></span></label><label class="mt-checkbox mt-checkbox-outline no-margin-bottom margin-top-15 margin-right-40"> Unset<input type="checkbox" class="set" value="0" name="unset-cost" /><span></span></label><label class="mt-checkbox mt-checkbox-outline no-margin-bottom margin-top-15"> Import<input type="checkbox" class="set" value="0" name="import-cost" /><span></span></label></div></div></div></div>';if($(".measures-container").append(i),null!=t&&0<t.max_children&&t.max_children<=3)for(var o=1;o<=t.max_children;o++){var r='<div class="row"><div class="col-md-12"><div class="col-md-5 col-sm-5 col-xs-5"><div class="form-group"><label>'+a[n].name+" Children "+o+'</label><input type="text" class="form-control measure-input" name="'+a[n].code+"_children_"+o+'" readonly></div></div><div class="col-md-7 col-sm-7 col-xs-7 label_contentainer" style="display: none;"><div class="mt-checkbox-inline"><label class="mt-checkbox mt-checkbox-outline no-margin-bottom margin-top-15 margin-right-40"><p class="label_'+a[n].code+"_children_"+o+'">From Adult</p><input type="checkbox" class="set use-adult" value="1" name="use-adult-'+a[n].code+"_children_"+o+'" data-set="'+a[n].code+"_children_"+o+'"/><span></span></label><input type="hidden" value="" name="use-adult-rate-'+a[n].code+"_children_"+o+'" data-set="'+a[n].code+"_children_"+o+'" data-type="rate"/><input type="hidden" value="" name="use-adult-type-'+a[n].code+"_children_"+o+'" data-set="'+a[n].code+"_children_"+o+'" data-type="type"/></div></div></div></div>';$(".measures-container").append(r)}$("input[name=import-cost]").change(function(){if($(this).is(":checked")){$('input[name="set-cost"]').prop("checked",""),$('input[name="unset-cost"]').prop("checked",""),_.validate().resetForm(),_[0].reset();var e=k.valid_from,t=k.valid_to;$("#modal-import :input[name=import-from]").datepicker("setDate",new Date(moment(e,"YYYY-MM-DD"))),$("#modal-import :input[name=import-to]").datepicker("setDate",new Date(moment(t,"YYYY-MM-DD"))),$("input[name=add-value]").prop("checked",""),$('input[name="rate_fee_value"]').attr("disabled","disabled").val(""),$('input[name="rate_percent_value"]').attr("disabled","disabled").val(""),$('input[data-target="rate_fee_value"]').prop("checked",!0).attr("disabled","disabled"),$('input[data-target="rate_percent_value"]').attr("disabled","disabled"),$(".add-value-container").hide(),$("#modal-import .range-optional").each(function(){$(this).remove()}),$("#modal-import .expand").each(function(){$(this).click()}),$("#modal-import").modal("show")}}),$(".use-adult").on("click",function(e){e.preventDefault();var t=$(this).attr("data-set");$(".from-adult-content").html("");for(var a=$("#modal-setting :input[name=room-type-id]").val(),o=k.room_types,n=null,i=0;i<o.length;i++)if(a==o[i].id){n=o[i];break}for(var i=1;i<=n.max_children;i++){var r="";1<i&&(r="<hr>"),r+='<div class="children-setting" style="margin-bottom: 10px;margin-top: 10px;"><div class="row"><div class="col-md-12"><div class="row"><div class="col-md-12"><label class=""> Cost Children '+i+'</label></div></div></div><div class="col-md-12" style="margin-top: 10px;"><div class="row" style="margin-top: 5px;"><div class="col-md-4"><div class="form-group"><label>Rate</label><input type="text" class="form-control use-adult-input-rate" name="cost_children_'+i+'_rate"></div></div><div class="col-md-4"><label>Type</label><div class="form-group"><select class="form-control" name="cost_children_'+i+'_type" id="cost_children_'+i+'_type"><option value="1">Percent</option><option value="2">Fee</option></select></div></div><div class="col-md-4"><label class="mt-checkbox mt-checkbox-outline no-margin-bottom" style="width: 100%; margin-top: 24px;"> Enable<input class="active-use-adult" type="checkbox" value="1" name="cost_children_'+i+'_active" data-set="cost_children_'+i+'"/><span></span></label></div></div></div></div></div>',$(".from-adult-content").append(r),$('input[name="cost_children_'+i+'_active"]').on("click",function(){var e=$(this).attr("data-set");$(this).prop("checked")?$('input[name="'+e+'_rate"]').rules("add","required"):$('input[name="'+e+'_rate"]').rules("remove","required")})}$(".use-adult").each(function(){$(".active-use-adult").each(function(){var e=$(this).attr("data-set");$('input[name="'+e+'_rate"]').rules("remove","required"),$('input[name="'+e+'_active"]').rules("remove","required")});var e=$(this).attr("data-set"),t=$('[data-set="'+e+'"][data-type="rate"]').val(),a=$('[data-set="'+e+'"][data-type="type"]').val();""!=t&&""!=a&&($('input[name="'+e+'_rate"]').val(t),$("#"+e+"_type").val(a),$('input[name="'+e+'_active"]').prop("checked",!0))}),$('input[name="'+t+'_rate"]').rules("add","required"),$('input[name="'+t+'_active"]').prop("checked",!0),$("#modal-use-adult").modal("show")}),$(".cancel-import").on("click",function(e){$('input[name="import-cost"]').prop("checked",""),$('input[name="import-cost"]').val(0)})}else if("price"==a[n].code){var i='<div class="row"><div class="col-md-12"><div class="col-md-5 col-sm-5 col-xs-5"><div class="form-group"><label>'+a[n].name+' Adult</label><input type="text" class="form-control measure-input" name="'+a[n].code+'" readonly></div></div><div class="col-md-7 col-sm-7 col-xs-7"><div class="mt-checkbox-inline"><label class="mt-checkbox mt-checkbox-outline no-margin-bottom margin-top-15 margin-right-40"> Set<input type="checkbox" class="set" value="1" name="set-'+a[n].code+'" data-set="'+a[n].code+'" data-measure-id="'+a[n].id+'" /><span></span></label></div></div></div></div>';if($(".measures-container").append(i),null!=t&&0<t.max_children&&t.max_children<=3)for(var o=1;o<=t.max_children;o++){var r='<div class="row"><div class="col-md-12"><div class="col-md-5 col-sm-5 col-xs-5"><div class="form-group"><label>'+a[n].name+" Children "+o+'</label><input type="text" class="form-control measure-input" name="'+a[n].code+"_children_"+o+'" readonly></div></div></div></div>';$(".measures-container").append(r)}}else if("stop_sale"==a[n].code){var i='<div class="row"><div class="col-md-12"><div class="col-md-5 col-sm-5 col-xs-5"><div class="form-group"><label>'+a[n].name+'</label><select id="select-stop-sale" class="form-control measure-input" name="'+a[n].code+'" readonly="" disabled="disabled"><option value="0">Open Sales</option><option value="1">Stop Sales</option><option value="2">On Request</option></select></div></div><div class="col-md-7 col-sm-7 col-xs-7"><div class="mt-checkbox-inline"><label class="mt-checkbox mt-checkbox-outline no-margin-bottom margin-top-15 margin-right-40"> Set<input type="checkbox" class="set" value="" name="set-'+a[n].code+'" data-set="'+a[n].code+'" data-measure-id="'+a[n].id+'" /><span></span></label></div></div></div></div>';$(".measures-container").append(i),$("#select-stop-sale").val(0).change(),$('input[name="set-'+a[n].code+'"]').change(function(){var e=$(this).attr("data-set");$(this).is(":checked")?($("#select-stop-sale").removeAttr("readonly",""),$('input[name="unset-'+e+'"]').prop("checked",""),$("#select-stop-sale").removeAttr("disabled"),$(this).val(1)):($("#select-stop-sale").attr("readonly",!0),$("#select-stop-sale").attr("disabled","disabled"))}),$('input[name="unset-'+a[n].code+'"]').change(function(){var e=$(this).attr("data-unset");$(this).is(":checked")?($("input[name="+e+"]").prop("readonly",!0),$('input[name="set-'+e+'"]').prop("checked",""),$(this).val($(this).attr("data-measure-id")),$("#select-stop-sale").attr("disabled","disabled")):$(this).val("0")})}else{var d="allotment"==a[n].code?"Allotment Base":a[n].name,i='<div class="row"><div class="col-md-12"><div class="col-md-5 col-sm-5 col-xs-5"><div class="form-group"><label>'+d+'</label><input type="text" class="form-control measure-input" name="'+a[n].code+'" readonly></div></div><div class="col-md-7 col-sm-7 col-xs-7"><div class="mt-checkbox-inline"><label class="mt-checkbox mt-checkbox-outline no-margin-bottom margin-top-15 margin-right-40"> Set<input type="checkbox" class="set" value="" name="set-'+a[n].code+'" data-set="'+a[n].code+'" data-measure-id="'+a[n].id+'" /><span></span></label><label class="mt-checkbox mt-checkbox-outline no-margin-bottom margin-top-15 margin-right-30"> Unset<input type="checkbox" class="set" value="0" name="unset-'+a[n].code+'" data-unset="'+a[n].code+'" data-measure-id="'+a[n].id+'"/><span></span></label></div></div></div></div>';$(".measures-container").append(i),$('input[name="set-'+a[n].code+'"]').change(function(){var e=$(this).attr("data-set");$(this).is(":checked")?($("input[name="+e+"]").prop("readonly",""),$("input[name="+e+"]").rules("add","required"),$(this).val($(this).attr("data-measure-id")),$('input[name="unset-'+e+'"]').prop("checked",""),$(this).val(1)):($("input[name="+e+"]").prop("readonly",!0),$("input[name="+e+"]").rules("remove","required"))}),$('input[name="unset-'+a[n].code+'"]').change(function(){var e=$(this).attr("data-unset");$(this).is(":checked")?($("input[name="+e+"]").prop("readonly",!0),$("input[name="+e+"]").rules("remove","required"),$('input[name="set-'+e+'"]').prop("checked",""),$(this).val($(this).attr("data-measure-id"))):$(this).val("0")})}$('input[name="set-cost"]').change(function(){$(this).is(":checked")?($('input[name^="cost"]').each(function(e){$(this).rules("add","required");var t=$(this).attr("name");0!=$('.use-adult[data-set="'+t+'"]').prop("checked")&&"cost"!=t||$(this).prop("readonly","")}),$(".label_contentainer").show()):($('input[name^="cost"]').each(function(e){$(this).rules("remove","required"),$(this).prop("readonly",!0)}),$(".label_contentainer").hide()),$('input[name="unset-cost"]').prop("checked",""),$('input[name="import-cost"]').prop("checked","")}),$('input[name="unset-cost"]').change(function(){$(this).is(":checked")&&($('input[name^="cost"]').each(function(e){$(this).rules("remove","required"),$(this).prop("readonly",!0),$('input[name="set-price"]').prop("checked",""),$("input[name=set-cost]").prop("checked",""),$('input[name="import-cost"]').prop("checked","")}),$('input[name^="price"]').each(function(e){$(this).rules("remove","required"),$(this).prop("readonly",!0)}),$(".label_contentainer").hide())}),$('input[name="set-price"]').change(function(){$(this).is(":checked")?($('input[name^="cost"]').each(function(e){$(this).rules("add","required")}),$('input[name^="price"]').each(function(e){$(this).rules("add","required"),$(this).prop("readonly","")})):$('input[name^="price"]').each(function(e){$(this).rules("remove","required"),$(this).prop("readonly",!0)})}),w.validate(),w.validate().resetForm(),w[0].reset(),$("#modal-setting .room-name-header").html(t.code+": "+t.name),$("#modal-import .room-name-header").html(t.code+": "+t.name);var l=$(this).attr("data-date");$("#modal-setting :input[name=setting-from]").datepicker("setDate",new Date(moment(l,"YYYY-MM-DD"))),$("#modal-setting :input[name=setting-to]").datepicker("setDate",new Date(moment(l,"YYYY-MM-DD"))),$("#modal-setting .measures-container :input").prop("readonly",!0),$("#modal-setting .measures-container :input").prop("checked","");var s=$(this).parents("tr").find("td:first").attr("data-measure-code");"cost"==s.substr(0,4)?$("#modal-setting :input[data-set=cost]").click():"price"==s.substr(0,5)?$("#modal-setting :input[data-set=price]").click():"allotment"==s.substr(0,9)?$("#modal-setting :input[data-set=allotment]").click():$("#modal-setting :input[data-set="+s+"]").click(),$("#modal-setting :input[name=contract-id]").val(k.id),$("#modal-setting :input[name=market-id]").val($(this).attr("data-market-id")),$("#modal-setting :input[name=board-type-id]").val($("#board-type").val());var a=D;if(0<t.max_children&&t.max_children<3){var c=a;a=[];for(var n=0;n<c.length;n++)if(a.push(c[n]),"cost"==c[n].code)for(var o=1;o<=t.max_children;o++){var m={id:1e3+o,name:"Cost CH "+o,active:1,code:"cost_children_"+o};a.push(m)}else if("price"==c[n].code)for(var o=1;o<=t.max_children;o++){var m={id:2e3+o,name:"Price CH "+o,active:1,code:"price_children_"+o};a.push(m)}}for(var n=0;n<a.length;n++){var l=$(this).attr("data-date"),p=a[n].id,u=$(this).parents("table").find('td[data-date="'+l+'"][data-measure-id="'+p+'"]'),f=u.attr("data"),v=u.attr("data-measure-code");if("cost_children_1"==v||"cost_children_2"==v||"cost_children_3"==v){var h=u.attr("data-use-adult-type"),b=u.attr("data-use-adult-rate"),g="";g=1==h?"("+b+"%)":"($"+b+")",""!=h&&($('.use-adult[data-set="'+v+'"]').prop("checked",!0),$(".label_"+v).html("From Adult "+g),$('[data-set="'+v+'"][data-type="rate"]').val(b),$('[data-set="'+v+'"][data-type="type"]').val(h),$('input[name="'+v+'"]').prop("readonly",!0),$('input[name="'+v+'"]').rules("remove","required")),$('#modal-setting :input[name="'+a[n].code+'"]').val(f)}else"stop_sale"==a[n].code?(f=""==f?0:f,$("#select-stop-sale").val(f).change()):("allotment"==a[n].code&&(f=$(this).parents("table").find('td[data-date="'+l+'"][data-measure-id="3002"]').attr("data")),$('#modal-setting :input[name="'+a[n].code+'"]').val(f))}$("#modal-setting .range-optional").each(function(){$(this).remove()}),x(k.markets),Y(),M(k.room_types),$("#modal-setting").modal("show")}}),$(".measure-detail").on("click",function(){var e=$(this).attr("data");$(this).hasClass("closed")?($(this).removeClass("closed"),$(this).addClass("opened"),$(this).html("-"),$('tr[data-parent="'+e+'"]').removeClass("hidden")):($(this).removeClass("opened"),$(this).addClass("closed"),$(this).html("+"),$('tr[data-parent="'+e+'"]').addClass("hidden"))}),$(".row-expanded:checked").each(function(){$('.measure-detail[data-measure="'+$(this).val()+'"]').click()});var r=m.offers;$(".complement").each(function(){var e=$(this).attr("data-measure-code"),t=$(this).attr("data");if("offer"==e&&""!=t){for(var a=JSON.parse("["+t+"]"),o='<table class="table table-striped table-complement" width="100%" cellspacing="0" style="margin-bottom: 0"><thead><tr><th> # </th><th> Denomination </th><th> Type </th></thead><tbody>',n=0;n<a.length;n++)for(var i=0;i<r.length;i++)if(a[n]==r[i].id){o+="<tr><td>"+(n+1)+"</td><td>"+r[i].name+"</td><td>"+r[i].offer_type.name+"</td></tr>";break}o+="</tbody></table>",$(this).popover({trigger:"hover",container:"body",placement:"top",title:"Offers",content:o,delay:{show:500,hide:100},html:!0,template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title porlet-title-setting"></h3><div class="popover-content" style="padding: 5px;"></div></div>'})}})}else toastr.error(a.message,"Error")}var k,y}})}});var p=$("#modal-setting .table-room-type").dataTable({sDom:"tip",autoWidth:!1,columnDefs:[{orderable:!1,className:"dt-center",targets:[0],width:"20%"},{visible:!1,targets:[1]}],order:[[3,"asc"]],lengthMenu:[[-1],["All"]],pageLength:10});function n(e){var n=e.room_types,o=e.board_types,i=e.measures,r=e.markets,t=e,a=null!=t.hotel.hotel_chain?t.hotel.hotel_chain.name:"",d=1==t.active?"Enabled":"Disabled",l=[];$("#search-accomodation :input[name=hotel]").val(t.hotel.name),$("#search-accomodation :input[name=hotel-chain]").val(a),$("#search-accomodation :input[name=status]").val(d),$("#search-accomodation :input[name=period]").val(moment(t.valid_from,"YYYY-MM-DD").format("DD.MM.YYYY")+" - "+moment(t.valid_to,"YYYY-MM-DD").format("DD.MM.YYYY")),$(".result-container").html(""),$(".measures-list").html(""),$(".btn-complements").addClass("disabled"),$(".complement-link").each(function(){$(this).addClass("hide");var e=$(this).children("a").attr("href");$(e).addClass("hide")});var s=!0;$.each(i,function(e,t){"offer"!=i[e].code&&"supplement"!=i[e].code&&"restriction"!=i[e].code||(l.push(i[e]),$('.complement-link[data="'+i[e].code+'"]').removeClass("hide"),$('.tab-pane[data="'+i[e].code+'"]').removeClass("hide"),s&&($('.complement-link[data="'+i[e].code+'"]>a').click(),s=!1));var a='<div class="row"><div class="col-md-5"><label class="mt-checkbox mt-checkbox-outline mt-checkbox-row"><input type="checkbox" class="row-selected" checked value="'+i[e].id+'"> '+i[e].name+"<span></span></label></div>";"cost"!=i[e].code&&"price"!=i[e].code&&"allotment"!=i[e].code||(a+='<div class="col-md-7"><label class="mt-checkbox mt-checkbox-outline mt-checkbox-row"><input type="checkbox" class="row-expanded" value="'+i[e].code+'"> Expand '+i[e].name+"<span></span></label></div>"),a+="</div>",$(".measures-list").append(a)}),0<l.length&&$(".btn-complements").removeClass("disabled"),$("#market").empty(),$.each(r,function(e,t){var a='<option value="'+r[e].id+'"> '+r[e].name+"</option>";$("#market").append(a)}),$("#board-type").empty(),$.each(o,function(e,t){var a='<option value="'+o[e].id+'"> '+o[e].code+": "+o[e].name+"</option>";$("#board-type").append(a)}),x(r),$(".room-types-list").html(""),$('#modal-change :input[name="change-room"]').empty(),$.each(n,function(e,t){var a='<label class="mt-checkbox mt-checkbox-outline mt-checkbox-row"><input type="checkbox" class="room-selected" checked value="'+n[e].id+'"> '+n[e].code+": "+n[e].name+"<span></span></label>";$(".room-types-list").append(a);var o='<option value="'+n[e].id+'" data-name="'+n[e].name+'"> '+n[e].code+": "+n[e].name+" (Max Pax: "+n[e].max_pax+", Min Pax: "+n[e].min_pax+", Max AD: "+n[e].max_adult+", Min AD: "+n[e].min_adult+", Max CH: "+n[e].max_children+", Min CH: "+n[e].min_children+", Max INF: "+n[e].max_infant+", Min INF: "+n[e].min_infant+")</option>";$('#modal-change :input[name="change-room"]').append(o)}),$("input[name=from]").datepicker("destroy"),$("input[name=to]").datepicker("destroy"),$(".datepicker-from-container").html(""),$(".datepicker-to-container").html("");var c='<label>From</label><div class="form-group"><div class="input-icon"><i class="fa fa-calendar"></i><input class="form-control datepicker" name="from"> </div></div>';$(".datepicker-from-container").append(c),c='<label>To</label><div class="form-group"><div class="input-icon"><i class="fa fa-calendar"></i><input class="form-control datepicker" name="to"> </div></div>',$(".datepicker-to-container").append(c),$("input[name=from]").datepicker({format:"MM yyyy",viewMode:"months",minViewMode:"months",autoclose:!0,orientation:"bottom"}),$("input[name=to]").datepicker({format:"MM yyyy",viewMode:"months",minViewMode:"months",autoclose:!0,orientation:"bottom"});var m=moment(t.valid_from,"YYYY-MM-DD"),p=moment(t.valid_to,"YYYY-MM-DD"),u=moment(),f=u,v=u;u.isSameOrBefore(p)&&u.isSameOrAfter(m)?(f=moment(u).startOf("month"),v=moment(u).endOf("month")):u.isBefore(m)?(f=moment(m).startOf("month"),v=moment(m).endOf("month")):u.isAfter(p)&&(f=moment(p).startOf("month"),v=moment(p).endOf("month")),f.isBefore(m)&&(f=m),v.isAfter(p)&&(v=p),$("input[name=from]").datepicker("setStartDate",new Date(m)),$("input[name=from]").datepicker("setEndDate",new Date(p)),$("input[name=to]").datepicker("setStartDate",new Date(m)),$("input[name=to]").datepicker("setEndDate",new Date(p)),$("input[name=from]").datepicker("setDate",new Date(f)),$("input[name=to]").datepicker("setDate",new Date(v)),$("#modal-setting :input[name=setting-from]").datepicker("setStartDate",new Date(m)),$("#modal-setting :input[name=setting-from]").datepicker("setEndDate",new Date(p)),$("#modal-setting :input[name=setting-to]").datepicker("setStartDate",new Date(m)),$("#modal-setting :input[name=setting-to]").datepicker("setEndDate",new Date(p)),$("#modal-import :input[name=import-from]").datepicker("setStartDate",new Date(m)),$("#modal-import :input[name=import-from]").datepicker("setEndDate",new Date(p)),$("#modal-import :input[name=import-to]").datepicker("setStartDate",new Date(m)),$("#modal-import :input[name=import-to]").datepicker("setEndDate",new Date(p))}function Y(){$(".share-rooms").hide();var e=m.room_types;if(1<e.length){p.api().clear().draw();for(var t=0;t<e.length;t++)e[t].id!=$('input[name="room-type-id"]').val()&&(p.api().row.add(['<label class="mt-checkbox mt-checkbox-single mt-checkbox-outline"><input type="checkbox" class="checkboxes" value="1" /><span></span></label>',e[t].id,e[t].code,e[t].name]).draw(!1),p.api().columns.adjust().draw());$(".share-container").show()}else $(".share-container").hide()}function x(e){$("#import-cost-from-rate").empty(),$("#import-cost-from-rate").removeAttr("disabled"),$(".btn-import").removeAttr("disabled"),1<e.length?$("#market option:not(:selected)").each(function(e){var t='<option value="'+$(this).val()+'"> '+$(this).text()+"</option>";$("#import-cost-from-rate").append(t)}):($("#import-cost-from-rate").attr("disabled","disabled"),$(".btn-import").attr("disabled","disabled"))}function M(o){$('#modal-import :input[name="select-room"]').empty(),$.each(o,function(e,t){var a='<option value="'+o[e].id+'" data-name="'+o[e].name+'"> '+o[e].code+": "+o[e].name+" (Max Pax: "+o[e].max_pax+", Min Pax: "+o[e].min_pax+", Max AD: "+o[e].max_adult+", Min AD: "+o[e].min_adult+", Max CH: "+o[e].max_children+", Min CH: "+o[e].min_children+", Max INF: "+o[e].max_infant+", Min INF: "+o[e].min_infant+")</option>";$('#modal-import :input[name="select-room"]').append(a)})}function a(e){return e.api().rows(".active").data().length}function u(e){for(var t=[],a=e.api().rows(".active").data(),o=0;o<a.length;o++)t.push(a[o][1]);return t}p.find(".group-checkable").change(function(){var e=jQuery(this).attr("data-set"),t=jQuery(this).is(":checked");jQuery(e).each(function(){t?($(this).prop("checked",!0),$(this).parents("tr").addClass("active")):($(this).prop("checked",!1),$(this).parents("tr").removeClass("active"))})}),p.on("change","tbody tr .checkboxes",function(){$(this).parents("tr").toggleClass("active")}),$("input[name=search-code]").on("keyup",function(){p.api().columns(2).search($('input[name="search-code"]').val()).columns(3).search($('input[name="search-name"]').val()).draw()}),$("input[name=search-name]").on("keyup",function(){p.api().columns(2).search($('input[name="search-code"]').val()).columns(3).search($('input[name="search-name"]').val()).draw()}),$('#modal-change :input[name="change-room"]').select2({width:"off"}),$('#modal-import :input[name="select-room"]').select2({width:"off"}),$("#form-use-adult").validate({errorElement:"span",errorClass:"help-block help-block-error",focusInvalid:!1,ignore:"",errorPlacement:function(e,t){0<t.parents(".mt-radio-list").size()||0<t.parents(".mt-checkbox-list").size()?(0<t.parents(".mt-radio-list").size()&&e.appendTo(t.parents(".mt-radio-list")[0]),0<t.parents(".mt-checkbox-list").size()&&e.appendTo(t.parents(".mt-checkbox-list")[0])):0<t.parents(".mt-radio-inline").size()||0<t.parents(".mt-checkbox-inline").size()?(0<t.parents(".mt-radio-inline").size()&&e.appendTo(t.parents(".mt-radio-inline")[0]),0<t.parents(".mt-checkbox-inline").size()&&e.appendTo(t.parents(".mt-checkbox-inline")[0])):0<t.parent(".input-group").size()?e.insertAfter(t.parent(".input-group")):e.insertAfter(t)},invalidHandler:function(e,t){toastr.error("Please check the entry fields.","Error")},highlight:function(e){$(e).closest(".form-group").addClass("has-error")},unhighlight:function(e){$(e).closest(".form-group").removeClass("has-error")},success:function(e){e.closest(".form-group").removeClass("has-error")},submitHandler:function(e){return $(".active-use-adult").each(function(){var e=$(this).attr("data-set");if($(this).prop("checked")){var t=$('input[name="'+e+'_rate"]').val(),a=$("#"+e+"_type").val(),o="";o=1==a?"("+t+"%)":"($"+t+")",$('[data-set="'+e+'"][data-type="rate"]').val(t),$('[data-set="'+e+'"][data-type="type"]').val(a),$(".label_"+e).html("From Adult "+o),$('input[name="'+e+'"]').prop("readonly",!0),$('input[name="'+e+'"]').rules("remove","required"),$('input[name="use-adult-'+e+'"]').prop("checked",!0)}else $('[data-set="'+e+'"][data-type="rate"]').val(""),$('[data-set="'+e+'"][data-type="type"]').val(""),$(".label_"+e).html("From Adult"),$('input[name="'+e+'"]').prop("readonly",!1),$('input[name="'+e+'"]').rules("add","required"),$('input[name="use-adult-'+e+'"]').prop("checked",!1)}),$(".cancel-use-adult").click(),!1}});var w=$("#form-setting");w.validate({errorElement:"span",errorClass:"help-block help-block-error",focusInvalid:!1,ignore:"",rules:{"setting-from":{required:!0,validDate:!0},"setting-to":{required:!0,validDate:!0}},errorPlacement:function(e,t){0<t.parents(".mt-radio-list").size()||0<t.parents(".mt-checkbox-list").size()?(0<t.parents(".mt-radio-list").size()&&e.appendTo(t.parents(".mt-radio-list")[0]),0<t.parents(".mt-checkbox-list").size()&&e.appendTo(t.parents(".mt-checkbox-list")[0])):0<t.parents(".mt-radio-inline").size()||0<t.parents(".mt-checkbox-inline").size()?(0<t.parents(".mt-radio-inline").size()&&e.appendTo(t.parents(".mt-radio-inline")[0]),0<t.parents(".mt-checkbox-inline").size()&&e.appendTo(t.parents(".mt-checkbox-inline")[0])):0<t.parent(".input-group").size()?e.insertAfter(t.parent(".input-group")):t.attr("data-error-container")?e.appendTo(t.attr("data-error-container")):e.insertAfter(t)},invalidHandler:function(e,t){toastr.error("Please check the entry fields.","Error")},highlight:function(e){$(e).closest(".form-group").addClass("has-error")},unhighlight:function(e){$(e).closest(".form-group").removeClass("has-error")},success:function(e){e.closest(".form-group").removeClass("has-error")},submitHandler:function(o){var n=$(o).find("button[type=submit]:focus").attr("data"),t=0;if($('#modal-setting :input[name^="set-"]').each(function(e){1==$(this).prop("checked")&&t++}),$('#modal-setting :input[name^="unset-"]').each(function(e){1==$(this).prop("checked")&&t++}),0==t)$(o).find("button.cancel-form").click();else{var e=new FormData(w[0]),a=$("#market").val(),i=[];$("#modal-setting .range").each(function(){var e={from:$(this).find('input[name^="setting-from"]').val(),to:$(this).find('input[name^="setting-to"]').val()};i.push(e)});var r=u(p),d=$('input[name="room-type-id"]').val();r.push(parseInt(d)),e.append("room-types",JSON.stringify(r)),e.append("ranges",JSON.stringify(i)),e.append("market",a),$.ajax({url:routeSave,type:"POST",data:e,contentType:!1,processData:!1,beforeSend:function(){App.showMask(!0,w)},complete:function(e,t){if(App.showMask(!1,w),"419"==e.status)location.reload(!0);else if("200"!=e.status)toastr.error("Please check your connection and try again.","Error on loading the content");else{var a=$.parseJSON(e.responseText);"success"==a.status?(toastr.success(a.message,"Success"),l=!0,"accept"==n&&($(o).find("button.cancel-form").click(),w[0].reset())):toastr.error(a.message,"Error")}}})}}}),$(".add-row-setting").on("click",function(e){e.preventDefault();var i=$.now(),t='<div class="range range-optional" data="'+i+'"><div class="col-md-5 col-sm-5 col-xs-5"><div class="form-group"><label>From</label><div class="input-icon left"><i class="fa fa-calendar"></i><input type="text" class="form-control date-picker" name="setting-from-'+i+'"></div></div></div><div class="col-md-5 col-sm-5 col-xs-5"><div class="form-group"><label>To</label><div class="input-icon left"><i class="fa fa-calendar"></i><input type="text" class="form-control date-picker" name="setting-to-'+i+'"></div></div></div><div class="col-md-2 col-sm-2 col-xs-2"><div class="form-group"><a class="btn red btn-outline delete-row" href="#" data="'+i+'"><i class="fa fa-trash"></i></a></div></div></div>';$(".range-container").append(t),$('#modal-setting :input[name="setting-from-'+i+'"]').datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0,format:"dd.mm.yyyy",orientation:"bottom"}).on("changeDate",function(e){var t=$(this).val(),a=$('modal-setting :input[name="setting-to-'+i+'"]').val(),o=moment(t,"DD.MM.YYYY"),n=moment(a,"DD.MM.YYYY");0==t||""==t||0!=a&&""!=a&&!moment(n).isBefore(o)||$('modal-setting :input[name="setting-to-'+i+'"]').datepicker("setDate",new Date(moment(t,"DD.MM.YYYY")))}),$('#modal-setting :input[name="setting-to-'+i+'"]').datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0,format:"dd.mm.yyyy",orientation:"bottom"}).on("changeDate",function(e){var t=$(this).val(),a=$('#modal-setting :input[name="setting-from-'+i+'"]').val(),o=moment(a,"DD.MM.YYYY"),n=moment(t,"DD.MM.YYYY");0==t||""==t||0!=a&&""!=a&&!moment(n).isBefore(o)||$('#modal-setting :input[name="setting-from-'+i+'"]').datepicker("setDate",new Date(moment(t,"DD.MM.YYYY")))});var a=moment(m.valid_from,"YYYY-MM-DD"),o=moment(m.valid_to,"YYYY-MM-DD");$('#modal-setting :input[name="setting-from-'+i+'"]').datepicker("setStartDate",new Date(a)),$('#modal-setting :input[name="setting-from-'+i+'"]').datepicker("setEndDate",new Date(o)),$('#modal-setting :input[name="setting-to-'+i+'"]').datepicker("setStartDate",new Date(a)),$('#modal-setting :input[name="setting-to-'+i+'"]').datepicker("setEndDate",new Date(o)),w.validate(),$('#modal-setting :input[name="setting-from-'+i+'"]').rules("add","required"),$('#modal-setting :input[name="setting-to-'+i+'"]').rules("add","required"),$('.delete-row[data="'+i+'"]').on("click",function(e){$('.range[data="'+i+'"]').remove(),e.preventDefault()})}),$(".add-row-import").on("click",function(e){e.preventDefault();var i=$.now(),t='<div class="range range-optional" data="'+i+'"><div class="col-md-5 col-sm-5 col-xs-5"><div class="form-group"><label>From</label><div class="input-icon left"><i class="fa fa-calendar"></i><input type="text" class="form-control date-picker" name="import-from-'+i+'"></div></div></div><div class="col-md-5 col-sm-5 col-xs-5"><div class="form-group"><label>To</label><div class="input-icon left"><i class="fa fa-calendar"></i><input type="text" class="form-control date-picker" name="import-to-'+i+'"></div></div></div><div class="col-md-2 col-sm-2 col-xs-2"><div class="form-group"><a class="btn red btn-outline delete-row" href="#" data="'+i+'"><i class="fa fa-trash"></i></a></div></div></div>';$(".import-range-container").append(t),$('#modal-import :input[name="import-from-'+i+'"]').datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0,format:"dd.mm.yyyy",orientation:"bottom"}).on("changeDate",function(e){var t=$(this).val(),a=$('#modal-import :input[name="import-to-'+i+'"]').val(),o=moment(t,"DD.MM.YYYY"),n=moment(a,"DD.MM.YYYY");0==t||""==t||0!=a&&""!=a&&!moment(n).isBefore(o)||$('#modal-import :input[name="import-to-'+i+'"]').datepicker("setDate",new Date(moment(t,"DD.MM.YYYY")))}),$('#modal-import :input[name="import-to-'+i+'"]').datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0,format:"dd.mm.yyyy",orientation:"bottom"}).on("changeDate",function(e){var t=$(this).val(),a=$('#modal-import :input[name="import-from-'+i+'"]').val(),o=moment(a,"DD.MM.YYYY"),n=moment(t,"DD.MM.YYYY");0==t||""==t||0!=a&&""!=a&&!moment(n).isBefore(o)||$('#modal-import :input[name="import-from-'+i+'"]').datepicker("setDate",new Date(moment(t,"DD.MM.YYYY")))});var a=moment(m.valid_from,"YYYY-MM-DD"),o=moment(m.valid_to,"YYYY-MM-DD");$('#modal-import :input[name="import-from-'+i+'"]').datepicker("setStartDate",new Date(a)),$('#modal-import :input[name="import-from-'+i+'"]').datepicker("setEndDate",new Date(o)),$('#modal-import :input[name="import-to-'+i+'"]').datepicker("setStartDate",new Date(a)),$('#modal-import :input[name="import-to-'+i+'"]').datepicker("setEndDate",new Date(o)),_.validate(),$('#modal-import :input[name="import-from-'+i+'"]').rules("add","required"),$('#modal-import :input[name="import-to-'+i+'"]').rules("add","required"),$('.delete-row[data="'+i+'"]').on("click",function(e){$('.range[data="'+i+'"]').remove(),e.preventDefault()})}),$(".cancel-form").on("click",function(e){l&&($(".btn-search-submit").click(),l=!1)}),$("#market").change(function(){c&&$(".btn-search-submit").click(),x(m.markets)}),$("#board-type").change(function(){c&&$(".btn-search-submit").click()}),$("input[name=share]").change(function(){$(this).is(":checked")?$(".share-rooms").show():$(".share-rooms").hide()}),$("input[name=change]").change(function(){$(this).is(":checked")&&($('#modal-change :input[name="change-room"]').val($('#modal-setting :input[name="room-type-id"]').val()).trigger("change"),$("#modal-change").modal("show"))}),$(".cancel-change").on("click",function(e){$("#modal-setting :input[name=change]").prop("checked",""),$("#modal-setting :input[name=change]").val(0)}),$(".accept-change").on("click",function(e){for(var t=$('#modal-change :input[name="change-room"]').val(),a=m.room_types,o=null,n=0;n<a.length;n++)if(t==a[n].id){o=a[n];break}$('#modal-setting :input[name="room-type-id"]').val(t),$("#modal-setting .room-name-header").html(o.code+": "+o.name),$("#modal-import .room-name-header").html(o.code+": "+o.name),$(".cancel-change").click(),Y(),M(a),$("#modal-setting :input[name=share]").prop("checked",""),$("#modal-setting :input[name=share]").val(0)}),$("#modal-import [id=rate_fee_value]").TouchSpin({min:-1e9,max:1e9,stepinterval:50,step:.01,decimals:2,maxboostedstep:10,prefix:"$"}),$("#modal-import [id=rate_percent_value]").TouchSpin({min:-100,max:100,step:.01,decimals:2,boostat:5,maxboostedstep:10,postfix:"%"}),$("input[name=add-value]").on("click",function(e){$(this).is(":checked")?($('input[name="rate_fee_value"]').removeAttr("disabled"),$('input[data-target="rate_fee_value"]').removeAttr("disabled"),$('input[data-target="rate_percent_value"]').removeAttr("disabled"),$(".add-value-container").show()):($(".add-value-container").hide(),$('input[name="rate_fee_value"]').attr("disabled","disabled").val(""),$('input[name="rate_percent_value"]').attr("disabled","disabled").val(""),$('input[data-target="rate_fee_value"]').attr("disabled","disabled").prop("checked",!0),$('input[data-target="rate_percent_value"]').attr("disabled","disabled"))}),$('input[name="rate_type"]').change(function(){1==$(this).val()?($('input[name="rate_fee_value"]').attr("disabled","disabled").val(""),$('input[name="rate_percent_value"]').removeAttr("disabled")):($('input[name="rate_percent_value"]').attr("disabled","disabled").val(""),$('input[name="rate_fee_value"]').removeAttr("disabled"))}),$(".cancel-use-adult").on("click",function(e){$(".use-adult-input-rate").each(function(){$(this).rules("remove","required")})});var _=$("#form-import");_.validate({errorElement:"span",errorClass:"help-block help-block-error",focusInvalid:!1,ignore:"",rules:{"import-from":{required:!0,validDate:!0},"import-to":{required:!0,validDate:!0}},errorPlacement:function(e,t){0<t.parents(".mt-radio-list").size()||0<t.parents(".mt-checkbox-list").size()?(0<t.parents(".mt-radio-list").size()&&e.appendTo(t.parents(".mt-radio-list")[0]),0<t.parents(".mt-checkbox-list").size()&&e.appendTo(t.parents(".mt-checkbox-list")[0])):0<t.parents(".mt-radio-inline").size()||0<t.parents(".mt-checkbox-inline").size()?(0<t.parents(".mt-radio-inline").size()&&e.appendTo(t.parents(".mt-radio-inline")[0]),0<t.parents(".mt-checkbox-inline").size()&&e.appendTo(t.parents(".mt-checkbox-inline")[0])):0<t.parent(".input-group").size()?e.insertAfter(t.parent(".input-group")):t.attr("data-error-container")?e.appendTo(t.attr("data-error-container")):e.insertAfter(t)},invalidHandler:function(e,t){toastr.error("Please check the entry fields.","Error")},highlight:function(e){$(e).closest(".form-group").addClass("has-error")},unhighlight:function(e){$(e).closest(".form-group").removeClass("has-error")},success:function(e){e.closest(".form-group").removeClass("has-error")},submitHandler:function(o){var e=$('#modal-setting :input[name="contract-id"]').val(),t=$('#modal-setting :input[name="room-type-id"]').val(),a=$('#modal-setting :input[name="market-id"]').val(),n=$('#modal-setting :input[name="board-type-id"]').val(),i=new FormData(_[0]),r=[];$("#modal-import .range").each(function(){var e={from:$(this).find('input[name^="import-from"]').val(),to:$(this).find('input[name^="import-to"]').val()};r.push(e)}),i.append("ranges",JSON.stringify(r)),i.append("contract-id",e),i.append("room-type-id",t),i.append("market-id",a),i.append("board-type-id",n),$.ajax({url:routeImportCostFromRoomtype,type:"POST",data:i,contentType:!1,processData:!1,beforeSend:function(){App.showMask(!0,_)},complete:function(e,t){if(App.showMask(!1,_),"419"==e.status)location.reload(!0);else if("200"!=e.status)toastr.error("Please check your connection and try again.","Error on loading the content");else{var a=$.parseJSON(e.responseText);"success"==a.status?(toastr.success(a.message,"Success"),l=!0,$(o).find("button.cancel-import").click(),_[0].reset()):toastr.error(a.message,"Error")}}})}}),$("#modal-add-offer :input[name=valid-from]").datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0,format:"dd.mm.yyyy",orientation:"bottom"}).on("changeDate",function(e){var t=$(this).val(),a=$("#modal-add-offer :input[name=valid-to]").val(),o=moment(t,"DD.MM.YYYY"),n=moment(a,"DD.MM.YYYY");(""==a||0!=t&&""!=t&&moment(n).isBefore(o))&&$("#modal-add-offer :input[name=valid-to]").datepicker("setDate",new Date(moment(t,"DD.MM.YYYY")))}),$("#modal-add-offer :input[name=valid-to]").datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0,format:"dd.mm.yyyy",orientation:"bottom"}).on("changeDate",function(e){var t=$(this).val(),a=$('#modal-add-offer :input[name="valid-from"]').val(),o=moment(a,"DD.MM.YYYY"),n=moment(t,"DD.MM.YYYY");(""==a||0!=a&&""!=a&&moment(n).isBefore(o))&&$('#modal-add-offer :input[name="valid-from"]').datepicker("setDate",new Date(moment(t,"DD.MM.YYYY")))}),$("#modal-edit-offer :input[name=valid-from]").datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0,format:"dd.mm.yyyy",orientation:"bottom"}).on("changeDate",function(e){var t=$(this).val(),a=$("#modal-edit-offer :input[name=valid-to]").val(),o=moment(t,"DD.MM.YYYY"),n=moment(a,"DD.MM.YYYY");(""==a||0!=t&&""!=t&&moment(n).isBefore(o))&&$("#modal-edit-offer :input[name=valid-to]").datepicker("setDate",new Date(moment(t,"DD.MM.YYYY")))}),$("#modal-edit-offer :input[name=valid-to]").datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0,format:"dd.mm.yyyy",orientation:"bottom"}).on("changeDate",function(e){var t=$(this).val(),a=$('#modal-edit-offer :input[name="valid-from"]').val(),o=moment(a,"DD.MM.YYYY"),n=moment(t,"DD.MM.YYYY");(""==a||0!=a&&""!=a&&moment(n).isBefore(o))&&$('#modal-edit-offer :input[name="valid-from"]').datepicker("setDate",new Date(moment(t,"DD.MM.YYYY")))}),jQuery.validator.addMethod("requireFiled",function(e,t,a){return""==$(a).val()||""!=e},"This field is required."),$("#modal-add-offer :input[name=offer-type]").change(function(){if($("#modal-add-offer .offer-input-container").html(""),"early_booking"==$("#modal-add-offer :input[name=offer-type] option:selected").attr("data-code")){$("#modal-add-offer .offer-input-container").append('<div class="row"><div class="col-md-6"><div class="form-group"><div class="mt-checkbox-list /*margin-top-15*/"><label class="mt-checkbox mt-checkbox-outline no-margin-bottom"> Non Refundable<input type="checkbox" value="1" name="non-refundable"/><span></span></label></div></div></div><div class="col-md-6"><div class="form-group"><div class="mt-checkbox-list /*margin-top-15*/"><label class="mt-checkbox mt-checkbox-outline no-margin-bottom"> Apply with other offers<input type="checkbox" value="1" name="apply-with-other-offers"/><span></span></label></div></div></div></div><div class="row"><div class="col-md-6"><div class="form-group"><label>Minimum Stay</label><input type="text" class="form-control" placeholder="Minimum Stay" name="minimum-stay"></div></div><div class="col-md-6"><div class="form-group"><label>Booking Type</label><select class="form-control" name="booking-type"><option value="1">Date range</option><option value="2">Days prior to the check-in</option></select></div></div></div><div class="row booking-date-range"><div class="col-md-6"><div class="form-group"><label>Booking Date From</label><input type="text" class="form-control" placeholder="Booking Date From" name="booking-date-from"></div></div><div class="col-md-6"><div class="form-group"><label>Booking Date To</label><input type="text" class="form-control" placeholder="Booking Date To" name="booking-date-to"></div></div></div><div class="row booking-days-prior"><div class="col-md-6"><div class="form-group"><label>Days From</label><input type="text" class="form-control" placeholder="Days From" name="days-from"></div></div><div class="col-md-6"><div class="form-group"><label>Days To</label><input type="text" class="form-control" placeholder="Days To" name="days-to"></div></div></div><div class="row"><div class="col-md-6"><div class="form-group"><label>Payment Date</label><input type="text" class="form-control" placeholder="Payment Date" name="payment-date"></div></div><div class="col-md-6"><div class="form-group"><label>Percentage Due</label><input type="text" class="form-control" placeholder="Percentage Due" name="percentage-due"></div></div></div><div class="row"><div class="col-md-6"><div class="form-group"><label>Discount</label><input type="text" class="form-control" placeholder="Discount" name="discount"></div></div><div class="col-md-6"><div class="form-group"><label>Discount Type</label><select class="form-control" name="discount-type"><option value="1">Percent</option><option value="2">Fee</option></select></div></div></div>'),$("#modal-add-offer :input[name=booking-date-from]").datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0,format:"dd.mm.yyyy",orientation:"bottom"}).on("changeDate",function(e){var t=$(this).val(),a=$("#modal-add-offer :input[name=booking-date-to]").val(),o=moment(t,"DD.MM.YYYY"),n=moment(a,"DD.MM.YYYY");(""==a||0!=t&&""!=t&&moment(n).isBefore(o))&&$("#modal-add-offer :input[name=booking-date-to]").datepicker("setDate",new Date(moment(t,"DD.MM.YYYY")))}),$("#modal-add-offer :input[name=booking-date-to]").datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0,format:"dd.mm.yyyy",orientation:"bottom"}).on("changeDate",function(e){var t=$(this).val(),a=$('#modal-add-offer :input[name="booking-date-from"]').val(),o=moment(a,"DD.MM.YYYY"),n=moment(t,"DD.MM.YYYY");(""==a||0!=a&&""!=a&&moment(n).isBefore(o))&&$('#modal-add-offer :input[name="booking-date-from"]').datepicker("setDate",new Date(moment(t,"DD.MM.YYYY")))}),$("#modal-add-offer :input[name=payment-date]").datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0,format:"dd.mm.yyyy",orientation:"bottom"}).on("changeDate",function(e){}),$("#modal-add-offer :input[name=payment-date]").rules("add","validDate"),$("#modal-add-offer :input[name=discount]").rules("add","required"),$("#modal-add-offer :input[name=discount-type]").rules("add","required"),$("#modal-add-offer :input[name=booking-type]").rules("add","required"),$("#modal-add-offer :input[name=percentage-due]").rules("add",{requireFiled:"#modal-add-offer :input[name=payment-date]"}),$("#modal-add-offer :input[name=payment-date]").rules("add",{requireFiled:"#modal-add-offer :input[name=percentage-due]"}),$("#modal-add-offer :input[name=booking-type]").change(function(){$("#modal-add-offer :input[name=days-from]").each(function(){$(this).rules("remove")}),$("#modal-add-offer :input[name=days-to]").each(function(){$(this).rules("remove")}),$("#modal-add-offer :input[name=booking-date-from]").each(function(){$(this).rules("remove")}),$("#modal-add-offer :input[name=booking-date-to]").each(function(){$(this).rules("remove")}),$("#modal-add-offer :input[name=booking-date-from]").parent().removeClass("has-error"),$("#modal-add-offer :input[name=booking-date-to]").parent().removeClass("has-error"),$("#modal-add-offer :input[name=days-from]").parent().removeClass("has-error"),$("#modal-add-offer :input[name=days-to]").parent().removeClass("has-error"),$("#modal-add-offer :input[name=booking-date-from]").next(".help-block-error").hide(),$("#modal-add-offer :input[name=booking-date-to]").next(".help-block-error").hide(),$("#modal-add-offer :input[name=days-from]").next(".help-block-error").hide(),$("#modal-add-offer :input[name=days-to]").next(".help-block-error").hide(),$("#modal-add-offer :input[name=days-from]").val(""),$("#modal-add-offer :input[name=days-to]").val(""),$("#modal-add-offer :input[name=booking-date-from]").val(""),$("#modal-add-offer :input[name=booking-date-to]").val(""),1==$(this).val()?($("#modal-add-offer :input[name=booking-date-from]").rules("add",{required:!0,validDate:!0}),$("#modal-add-offer :input[name=booking-date-to]").rules("add",{required:!0,validDate:!0}),$("#modal-add-offer .booking-date-range ").show(),$("#modal-add-offer .booking-days-prior ").hide()):($("#modal-add-offer :input[name=days-to]").rules("add",{required:!0,notLessThan:"#modal-add-offer :input[name=days-from]",messages:{notLessThan:"Please enter a value greater than or equal to Days To field."}}),$("#modal-add-offer :input[name=days-from]").rules("add","required"),$("#modal-add-offer .booking-date-range ").hide(),$("#modal-add-offer .booking-days-prior ").show())}),$("#modal-add-offer :input[name=booking-type]").val(1).change()}}),$("#modal-edit-offer :input[name=offer-type]").change(function(){if($("#modal-edit-offer .offer-input-container").html(""),"early_booking"==$("#modal-edit-offer :input[name=offer-type] option:selected").attr("data-code")){$("#modal-edit-offer .offer-input-container").append('<div class="row"><div class="col-md-6"><div class="form-group"><div class="mt-checkbox-list /*margin-top-15*/"><label class="mt-checkbox mt-checkbox-outline no-margin-bottom"> Non Refundable<input type="checkbox" value="1" name="non-refundable"/><span></span></label></div></div></div><div class="col-md-6"><div class="form-group"><div class="mt-checkbox-list /*margin-top-15*/"><label class="mt-checkbox mt-checkbox-outline no-margin-bottom"> Apply with other offers<input type="checkbox" value="1" name="apply-with-other-offers"/><span></span></label></div></div></div></div><div class="row"><div class="col-md-6"><div class="form-group"><label>Minimum Stay</label><input type="text" class="form-control" placeholder="Minimum Stay" name="minimum-stay"></div></div><div class="col-md-6"><div class="form-group"><label>Booking Type</label><select class="form-control" name="booking-type"><option value="1">Date range</option><option value="2">Days prior to the check-in</option></select></div></div></div><div class="row booking-date-range"><div class="col-md-6"><div class="form-group"><label>Booking Date From</label><input type="text" class="form-control" placeholder="Booking Date From" name="booking-date-from"></div></div><div class="col-md-6"><div class="form-group"><label>Booking Date To</label><input type="text" class="form-control" placeholder="Booking Date To" name="booking-date-to"></div></div></div><div class="row booking-days-prior"><div class="col-md-6"><div class="form-group"><label>Days From</label><input type="text" class="form-control" placeholder="Days From" name="days-from"></div></div><div class="col-md-6"><div class="form-group"><label>Days To</label><input type="text" class="form-control" placeholder="Days To" name="days-to"></div></div></div><div class="row"><div class="col-md-6"><div class="form-group"><label>Payment Date</label><input type="text" class="form-control" placeholder="Payment Date" name="payment-date"></div></div><div class="col-md-6"><div class="form-group"><label>Percentage Due</label><input type="text" class="form-control" placeholder="Percentage Due" name="percentage-due"></div></div></div><div class="row"><div class="col-md-6"><div class="form-group"><label>Discount</label><input type="text" class="form-control" placeholder="Discount" name="discount"></div></div><div class="col-md-6"><div class="form-group"><label>Discount Type</label><select class="form-control" name="discount-type"><option value="1">Percent</option><option value="2">Fee</option></select></div></div></div>'),$("#modal-edit-offer :input[name=booking-date-from]").datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0,format:"dd.mm.yyyy",orientation:"bottom"}).on("changeDate",function(e){var t=$(this).val(),a=$("#modal-edit-offer :input[name=booking-date-to]").val(),o=moment(t,"DD.MM.YYYY"),n=moment(a,"DD.MM.YYYY");(""==a||0!=t&&""!=t&&moment(n).isBefore(o))&&$("#modal-edit-offer :input[name=booking-date-to]").datepicker("setDate",new Date(moment(t,"DD.MM.YYYY")))}),$("#modal-edit-offer :input[name=booking-date-to]").datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0,format:"dd.mm.yyyy",orientation:"bottom"}).on("changeDate",function(e){var t=$(this).val(),a=$('#modal-edit-offer :input[name="booking-date-from"]').val(),o=moment(a,"DD.MM.YYYY"),n=moment(t,"DD.MM.YYYY");(""==a||0!=a&&""!=a&&moment(n).isBefore(o))&&$('#modal-edit-offer :input[name="booking-date-from"]').datepicker("setDate",new Date(moment(t,"DD.MM.YYYY")))}),$("#modal-edit-offer :input[name=payment-date]").datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0,format:"dd.mm.yyyy",orientation:"bottom"}),$("#modal-edit-offer :input[name=payment-date]").rules("add","validDate"),$("#modal-edit-offer :input[name=discount]").rules("add","required"),$("#modal-edit-offer :input[name=discount-type]").rules("add","required"),$("#modal-edit-offer :input[name=booking-type]").rules("add","required"),$("#modal-edit-offer :input[name=percentage-due]").rules("add",{requireFiled:"#modal-edit-offer :input[name=payment-date]"}),$("#modal-edit-offer :input[name=payment-date]").rules("add",{requireFiled:"#modal-edit-offer :input[name=percentage-due]"}),$("#modal-edit-offer :input[name=booking-type]").change(function(){$("#modal-edit-offer :input[name=days-from]").each(function(){$(this).rules("remove")}),$("#modal-edit-offer :input[name=days-to]").each(function(){$(this).rules("remove")}),$("#modal-edit-offer :input[name=booking-date-from]").each(function(){$(this).rules("remove")}),$("#modal-edit-offer :input[name=booking-date-to]").each(function(){$(this).rules("remove")}),$("#modal-edit-offer :input[name=booking-date-from]").parent().removeClass("has-error"),$("#modal-edit-offer :input[name=booking-date-to]").parent().removeClass("has-error"),$("#modal-edit-offer :input[name=days-from]").parent().removeClass("has-error"),$("#modal-edit-offer :input[name=days-to]").parent().removeClass("has-error"),$("#modal-edit-offer :input[name=booking-date-from]").next(".help-block-error").hide(),$("#modal-edit-offer :input[name=booking-date-to]").next(".help-block-error").hide(),$("#modal-edit-offer :input[name=days-from]").next(".help-block-error").hide(),$("#modal-edit-offer :input[name=days-to]").next(".help-block-error").hide(),$("#modal-edit-offer :input[name=days-from]").val(""),$("#modal-edit-offer :input[name=days-to]").val(""),$("#modal-edit-offer :input[name=booking-date-from]").val(""),$("#modal-edit-offer :input[name=booking-date-to]").val(""),1==$(this).val()?($("#modal-edit-offer :input[name=booking-date-from]").rules("add",{required:!0,validDate:!0}),$("#modal-edit-offer :input[name=booking-date-to]").rules("add",{required:!0,validDate:!0}),$("#modal-edit-offer .booking-date-range ").show(),$("#modal-edit-offer .booking-days-prior ").hide()):($("#modal-edit-offer :input[name=days-to]").rules("add",{required:!0,notLessThan:"#modal-edit-offer :input[name=days-from]",messages:{notLessThan:"Please enter a value greater than or equal to Days To field."}}),$("#modal-edit-offer :input[name=days-from]").rules("add","required"),$("#modal-edit-offer .booking-date-range ").hide(),$("#modal-edit-offer .booking-days-prior ").show())})}});var f=$("#form-add-offer");f.validate({errorElement:"span",errorClass:"help-block help-block-error",focusInvalid:!1,ignore:"",rules:{"valid-from":{required:!0,validDate:!0},"valid-to":{required:!0,validDate:!0},"count-offer-room-type":{greaterThanZero:!0},"count-offer-board-type":{greaterThanZero:!0},name:{required:!0},"offer-type":{required:!0},priority:{required:!0}},errorPlacement:function(e,t){0<t.parents(".mt-radio-list").size()||0<t.parents(".mt-checkbox-list").size()?(0<t.parents(".mt-radio-list").size()&&e.appendTo(t.parents(".mt-radio-list")[0]),0<t.parents(".mt-checkbox-list").size()&&e.appendTo(t.parents(".mt-checkbox-list")[0])):0<t.parents(".mt-radio-inline").size()||0<t.parents(".mt-checkbox-inline").size()?(0<t.parents(".mt-radio-inline").size()&&e.appendTo(t.parents(".mt-radio-inline")[0]),0<t.parents(".mt-checkbox-inline").size()&&e.appendTo(t.parents(".mt-checkbox-inline")[0])):0<t.parent(".input-group").size()?e.insertAfter(t.parent(".input-group")):t.attr("data-error-container")?e.appendTo(t.attr("data-error-container")):t.hasClass("add-offer")?e.insertAfter(t.next()):t.hasClass("hotel-type")?(e.insertAfter(t.next().next()),$("#modal-add-offer :input[name=search-code]").css("border","1px solid #c2cad8"),$("#modal-add-offer :input[name=search-name]").css("border","1px solid #c2cad8")):t.hasClass("select-hotel")?e.insertAfter(t.next()):t.hasClass("market-rate-price-type")?(e.appendTo(".market-rate-container-error"),$(".market-rate-container-error > span").css("color","#e73d4a")):e.insertAfter(t)},invalidHandler:function(e,t){toastr.error("Please check the entry fields.","Error")},highlight:function(e){$(e).closest(".form-group").addClass("has-error")},unhighlight:function(e){$(e).closest(".form-group").removeClass("has-error")},success:function(e){e.closest(".form-group").removeClass("has-error")},submitHandler:function(o){var n=$(o).find("button[type=submit]:focus").attr("data"),e=new FormData(f[0]),t=m.id,a=[];$("#modal-add-offer .range").each(function(){var e={from:$(this).find('input[name^="valid-from"]').val(),to:$(this).find('input[name^="valid-to"]').val()};a.push(e)});var i=u(h),r=u(k);e.append("room-types",JSON.stringify(i)),e.append("board-types",JSON.stringify(r)),e.append("ranges",JSON.stringify(a)),e.append("contractId",t),$.ajax({url:routeSaveOffer,type:"POST",data:e,contentType:!1,processData:!1,beforeSend:function(){App.showMask(!0,f)},complete:function(e,t){if(App.showMask(!1,f),"419"==e.status)location.reload(!0);else if("200"!=e.status)toastr.error("Please check your connection and try again.","Error on loading the content");else{var a=$.parseJSON(e.responseText);"success"==a.status?(toastr.success(a.message,"Success"),d=!0,c&&(l=!0),"accept"==n&&($(o).find("button.cancel-form-offer").click(),f[0].reset())):toastr.error(a.message,"Error")}}})}});var v=$("#form-edit-offer");v.validate({errorElement:"span",errorClass:"help-block help-block-error",focusInvalid:!1,ignore:"",rules:{"valid-from":{required:!0,validDate:!0},"valid-to":{required:!0,validDate:!0},"count-offer-room-type":{greaterThanZero:!0},"count-offer-board-type":{greaterThanZero:!0},name:{required:!0},"offer-type":{required:!0},priority:{required:!0}},errorPlacement:function(e,t){0<t.parents(".mt-radio-list").size()||0<t.parents(".mt-checkbox-list").size()?(0<t.parents(".mt-radio-list").size()&&e.appendTo(t.parents(".mt-radio-list")[0]),0<t.parents(".mt-checkbox-list").size()&&e.appendTo(t.parents(".mt-checkbox-list")[0])):0<t.parents(".mt-radio-inline").size()||0<t.parents(".mt-checkbox-inline").size()?(0<t.parents(".mt-radio-inline").size()&&e.appendTo(t.parents(".mt-radio-inline")[0]),0<t.parents(".mt-checkbox-inline").size()&&e.appendTo(t.parents(".mt-checkbox-inline")[0])):0<t.parent(".input-group").size()?e.insertAfter(t.parent(".input-group")):t.attr("data-error-container")?e.appendTo(t.attr("data-error-container")):t.hasClass("hotel-type")?(e.insertAfter(t.next().next()),$("#modal-edit-offer :input[name=search-code]").css("border","1px solid #c2cad8"),$("#modal-edit-offer :input[name=search-name]").css("border","1px solid #c2cad8")):t.hasClass("edit-offer")?e.insertAfter(t.next()):t.hasClass("select-hotel")?e.insertAfter(t.next()):t.hasClass("market-rate-price-type")?(e.appendTo(".market-rate-container-error"),$(".market-rate-container-error > span").css("color","#e73d4a")):e.insertAfter(t)},invalidHandler:function(e,t){toastr.error("Please check the entry fields.","Error")},highlight:function(e){$(e).closest(".form-group").addClass("has-error")},unhighlight:function(e){$(e).closest(".form-group").removeClass("has-error")},success:function(e){e.closest(".form-group").removeClass("has-error")},submitHandler:function(o){var n=$(o).find("button[type=submit]:focus").attr("data"),e=new FormData(v[0]),t=$("#modal-edit-offer :input[name=id]").val(),a=[];$("#modal-edit-offer .range").each(function(){var e={from:$(this).find('input[name^="valid-from"]').val(),to:$(this).find('input[name^="valid-to"]').val()};a.push(e)});var i=u(g),r=u(T);e.append("room-types",JSON.stringify(i)),e.append("board-types",JSON.stringify(r)),e.append("ranges",JSON.stringify(a)),e.append("id",t),$.ajax({url:routeUpdateOffer,type:"POST",data:e,contentType:!1,processData:!1,beforeSend:function(){App.showMask(!0,v)},complete:function(e,t){if(App.showMask(!1,v),"419"==e.status)location.reload(!0);else if("200"!=e.status)toastr.error("Please check your connection and try again.","Error on loading the content");else{var a=$.parseJSON(e.responseText);"success"==a.status?(toastr.success(a.message,"Success"),d=!0,c&&(l=!0),"accept"==n&&($(o).find("button.cancel-form-offer").click(),v[0].reset())):toastr.error(a.message,"Error")}}})}}),$("#modal-add-offer .add-row-offer").on("click",function(e){e.preventDefault();var i=$.now(),t='<div class="range range-optional" data="'+i+'"><div class="col-md-5 col-sm-5 col-xs-5"><div class="form-group"><label>From</label><div class="input-icon left"><i class="fa fa-calendar"></i><input type="text" class="form-control date-picker" name="valid-from-'+i+'"></div></div></div><div class="col-md-5 col-sm-5 col-xs-5"><div class="form-group"><label>To</label><div class="input-icon left"><i class="fa fa-calendar"></i><input type="text" class="form-control date-picker" name="valid-to-'+i+'"></div></div></div><div class="col-md-2 col-sm-2 col-xs-2"><div class="form-group"><a class="btn red btn-outline delete-row delete-row-offer" href="#" data="'+i+'"><i class="fa fa-trash"></i></a></div></div></div>';$("#modal-add-offer .range-container").append(t),$('#modal-add-offer :input[name="valid-from-'+i+'"]').datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0,format:"dd.mm.yyyy",orientation:"bottom"}).on("changeDate",function(e){var t=$(this).val(),a=$('#modal-add-offer :input[name="valid-to-'+i+'"]').val(),o=moment(t,"DD.MM.YYYY"),n=moment(a,"DD.MM.YYYY");0==t||""==t||0!=a&&""!=a&&!moment(n).isBefore(o)||$('#modal-add-offer :input[name="valid-to-'+i+'"]').datepicker("setDate",new Date(moment(t,"DD.MM.YYYY")))}),$('#modal-add-offer :input[name="valid-to-'+i+'"]').datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0,format:"dd.mm.yyyy",orientation:"bottom"}).on("changeDate",function(e){var t=$(this).val(),a=$('#modal-add-offer :input[name="valid-from-'+i+'"]').val(),o=moment(a,"DD.MM.YYYY"),n=moment(t,"DD.MM.YYYY");0==t||""==t||0!=a&&""!=a&&!moment(n).isBefore(o)||$('#modal-add-offer :input[name="valid-from-'+i+'"]').datepicker("setDate",new Date(moment(t,"DD.MM.YYYY")))});var a=moment(m.valid_from,"YYYY-MM-DD"),o=moment(m.valid_to,"YYYY-MM-DD");$('#modal-add-offer :input[name="valid-from-'+i+'"]').datepicker("setStartDate",new Date(a)),$('#modal-add-offer :input[name="valid-from-'+i+'"]').datepicker("setEndDate",new Date(o)),$('#modal-add-offer :input[name="valid-to-'+i+'"]').datepicker("setStartDate",new Date(a)),$('#modal-add-offer :input[name="valid-to-'+i+'"]').datepicker("setEndDate",new Date(o)),f.validate(),$('#modal-add-offer :input[name="valid-from-'+i+'"]').rules("add","required"),$('#modal-add-offer :input[name="valid-to-'+i+'"]').rules("add","required"),$('#modal-add-offer .delete-row-offer[data="'+i+'"]').on("click",function(e){$('#modal-add-offer .range[data="'+i+'"]').remove(),e.preventDefault()})}),$("#modal-edit-offer .add-row-offer").on("click",function(e){e.preventDefault();var i=$.now(),t='<div class="range range-optional" data="'+i+'"><div class="col-md-5 col-sm-5 col-xs-5"><div class="form-group"><label>From</label><div class="input-icon left"><i class="fa fa-calendar"></i><input type="text" class="form-control date-picker" name="valid-from-'+i+'"></div></div></div><div class="col-md-5 col-sm-5 col-xs-5"><div class="form-group"><label>To</label><div class="input-icon left"><i class="fa fa-calendar"></i><input type="text" class="form-control date-picker" name="valid-to-'+i+'"></div></div></div><div class="col-md-2 col-sm-2 col-xs-2"><div class="form-group"><a class="btn red btn-outline delete-row delete-row-offer" href="#" data="'+i+'"><i class="fa fa-trash"></i></a></div></div></div>';$("#modal-edit-offer .range-container").append(t),$('#modal-edit-offer :input[name="valid-from-'+i+'"]').datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0,format:"dd.mm.yyyy",orientation:"bottom"}).on("changeDate",function(e){var t=$(this).val(),a=$('#modal-edit-offer :input[name="valid-to-'+i+'"]').val(),o=moment(t,"DD.MM.YYYY"),n=moment(a,"DD.MM.YYYY");0==t||""==t||0!=a&&""!=a&&!moment(n).isBefore(o)||$('#modal-edit-offer :input[name="valid-to-'+i+'"]').datepicker("setDate",new Date(moment(t,"DD.MM.YYYY")))}),$('#modal-edit-offer :input[name="valid-to-'+i+'"]').datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0,format:"dd.mm.yyyy",orientation:"bottom"}).on("changeDate",function(e){var t=$(this).val(),a=$('#modal-edit-offer :input[name="valid-from-'+i+'"]').val(),o=moment(a,"DD.MM.YYYY"),n=moment(t,"DD.MM.YYYY");0==t||""==t||0!=a&&""!=a&&!moment(n).isBefore(o)||$('#modal-edit-offer :input[name="valid-from-'+i+'"]').datepicker("setDate",new Date(moment(t,"DD.MM.YYYY")))});var a=moment(m.valid_from,"YYYY-MM-DD"),o=moment(m.valid_to,"YYYY-MM-DD");$('#modal-edit-offer :input[name="valid-from-'+i+'"]').datepicker("setStartDate",new Date(a)),$('#modal-edit-offer :input[name="valid-from-'+i+'"]').datepicker("setEndDate",new Date(o)),$('#modal-edit-offer :input[name="valid-to-'+i+'"]').datepicker("setStartDate",new Date(a)),$('#modal-edit-offer :input[name="valid-to-'+i+'"]').datepicker("setEndDate",new Date(o)),v.validate(),$('#modal-edit-offer :input[name="valid-from-'+i+'"]').rules("add","required"),$('#modal-edit-offer :input[name="valid-to-'+i+'"]').rules("add","required"),$('#modal-edit-offer .delete-row-offer[data="'+i+'"]').on("click",function(e){$('#modal-edit-offer .range[data="'+i+'"]').remove(),e.preventDefault()})}),$(".reload-offer").on("click",function(e){A.draw()}),$("#table-offer tbody").on("click",".dt-edit",function(e){$("#modal-edit-offer .delete-row-offer").each(function(){$(this).click()});for(var t=A.row($(this).parents("tr")).data().object,a=m.room_types,o=m.board_types,n=t.rooms,i=t.boards,r=t.ranges,d=t.offer_type,l=0;l<r.length;l++)0==l?($("#modal-edit-offer :input[name=valid-from]").datepicker("setDate",new Date(moment(r[l].from,"YYYY-MM-DD"))),$("#modal-edit-offer :input[name=valid-to]").datepicker("setDate",new Date(moment(r[l].to,"YYYY-MM-DD")))):($("#modal-edit-offer .add-row-offer").click(),$("#modal-edit-offer :input[name^=valid-from-]").last().datepicker("setDate",new Date(moment(r[l].from,"YYYY-MM-DD"))),$("#modal-edit-offer :input[name^=valid-to-]").last().datepicker("setDate",new Date(moment(r[l].to,"YYYY-MM-DD"))));g.api().clear();for(l=0;l<a.length;l++){for(var s=!1,c=0;c<n.length;c++)if(a[l].id==n[c].hotel_room_type_id){s=!0;break}s?g.api().row.add(['<label class="mt-checkbox mt-checkbox-single mt-checkbox-outline"> <input type="checkbox" class="checkboxes" value="1" checked /><span></span></label>',a[l].id,a[l].code,a[l].name]).draw().nodes().to$().addClass("active"):g.api().row.add(['<label class="mt-checkbox mt-checkbox-single mt-checkbox-outline"> <input type="checkbox" class="checkboxes" value="1"/><span></span></label>',a[l].id,a[l].code,a[l].name]).draw()}$("#modal-edit-offer :input[name=count-offer-room-type]").val(n.length),g.api().columns.adjust().draw(),T.api().clear();for(l=0;l<o.length;l++){for(s=!1,c=0;c<i.length;c++)if(o[l].id==i[c].hotel_board_type_id){s=!0;break}s?T.api().row.add(['<label class="mt-checkbox mt-checkbox-single mt-checkbox-outline"> <input type="checkbox" class="checkboxes" value="1" checked /><span></span></label>',o[l].id,o[l].code,o[l].name]).draw().nodes().to$().addClass("active"):T.api().row.add(['<label class="mt-checkbox mt-checkbox-single mt-checkbox-outline"> <input type="checkbox" class="checkboxes" value="1"/><span></span></label>',o[l].id,o[l].code,o[l].name]).draw()}$("#modal-edit-offer :input[name=count-offer-board-type]").val(i.length),T.api().columns.adjust().draw(),$("#modal-edit-offer :input[name=id]").val(t.id),$("#modal-edit-offer :input[name=name]").val(t.name),$("#modal-edit-offer :input[name=priority]").val(t.priority),1==t.active?$("#modal-edit-offer :input[name=active]").prop("checked","checked"):$("#modal-edit-offer :input[name=active]").prop("checked",""),$("#modal-edit-offer :input[name=active]").val(1),$("#modal-edit-offer :input[name=offer-type]").val(d.id).change(),"early_booking"==$("#modal-edit-offer :input[name=offer-type] option:selected").attr("data-code")&&(1==t.apply_with_other_offers?$('#modal-edit-offer :input[name="apply-with-other-offers"]').prop("checked","checked"):$('#modal-edit-offer :input[name="apply-with-other-offers"]').prop("checked",""),$('#modal-edit-offer :input[name="apply-with-other-offers"]').val(1),1==t.non_refundable?$('#modal-edit-offer :input[name="non-refundable"]').prop("checked","checked"):$('#modal-edit-offer :input[name="non-refundable"]').prop("checked",""),$('#modal-edit-offer :input[name="non-refundable"]').val(1),$("#modal-edit-offer :input[name=booking-type]").val(t.booking_type).change(),$("#modal-edit-offer :input[name=days-from]").val(t.days_prior_from),$("#modal-edit-offer :input[name=days-to]").val(t.days_prior_to),$("#modal-edit-offer :input[name=booking-date-from]").datepicker("update",new Date(moment(t.booking_date_from,"YYYY-MM-DD"))),$("#modal-edit-offer :input[name=booking-date-to]").datepicker("update",new Date(moment(t.booking_date_to,"YYYY-MM-DD"))),$("#modal-edit-offer :input[name=payment-date]").datepicker("setDate",new Date(moment(t.payment_date,"YYYY-MM-DD"))),$("#modal-edit-offer :input[name=percentage-due]").val(t.percentage_due),$("#modal-edit-offer :input[name=discount]").val(t.discount),$("#modal-edit-offer :input[name=discount-type]").val(t.discount_type),$("#modal-edit-offer :input[name=minimum-stay]").val(t.minimum_stay))}),$("#table-offer tbody").on("click",".dt-view",function(e){var t=A.row($(this).parents("tr")).data().object,a=t.rooms,o=t.boards,n=t.ranges,i=t.offer_type;$("#modal-info-offer .range-container").html("");for(var r=0;r<n.length;r++){var d='<div class="range"><div class="col-md-6 col-sm-6 col-xs-6"><div class="form-group"><label>From</label><div class="input-icon left"><i class="fa fa-calendar"></i><input type="text" class="form-control date-picker" name="valid-from" value="'+moment(n[r].from,"YYYY-MM-DD").format("DD.MM.YYYY")+'" readonly></div></div></div><div class="col-md-6 col-sm-6 col-xs-6"><div class="form-group"><label>To</label><div class="input-icon left"><i class="fa fa-calendar"></i><input type="text" class="form-control date-picker" name="valid-to" value="'+moment(n[r].to,"YYYY-MM-DD").format("DD.MM.YYYY")+'" readonly></div></div></div></div>';$("#modal-info-offer .range-container").append(d)}b.api().clear();for(r=0;r<a.length;r++)b.api().row.add([a[r].room_type.code,a[r].room_type.name]).draw(!1);b.api().columns.adjust().draw(),y.api().clear();for(r=0;r<o.length;r++)y.api().row.add([o[r].board_type.code,o[r].board_type.name]).draw(!1);if(y.api().columns.adjust().draw(),$("#modal-info-offer :input[name=name]").val(t.name),$("#modal-info-offer :input[name=priority]").val(t.priority),1==t.active?($("#modal-info-offer :input[name=active]").prop("checked","checked"),$("#modal-info-offer :input[name=active]").val(1)):($("#modal-info-offer :input[name=active]").prop("checked",""),$("#modal-info-offer :input[name=active]").val(0)),$("#modal-info-offer :input[name=offer-type]").val(i.name),$("#modal-info-offer .offer-input-container").html(""),"early_booking"==i.code){var l="",s=""!=t.payment_date&&null!=t.payment_date?moment(t.payment_date,"YYYY-MM-DD").format("DD.MM.YYYY"):"",c=""!=t.percentage_due&&null!=t.percentage_due?t.percentage_due:"",m=""!=t.discount&&null!=t.discount?t.discount:"",p=1==t.booking_type?"Date Range":"Days prior to the check-in";l=1==t.booking_type?'<div class="row"><div class="col-md-6"><div class="form-group"><label>Booking Date From</label><input type="text" class="form-control" name="booking-date-from" value="'+(""!=t.booking_date_from&&null!=t.booking_date_from?moment(t.booking_date_from,"YYYY-MM-DD").format("DD.MM.YYYY"):"")+'" readonly></div></div><div class="col-md-6"><div class="form-group"><label>Booking Date To</label><input type="text" class="form-control" name="booking-date-to" value="'+(""!=t.booking_date_to&&null!=t.booking_date_to?moment(t.booking_date_to,"YYYY-MM-DD").format("DD.MM.YYYY"):"")+'" readonly></div></div></div>':'<div class="row"><div class="col-md-6"><div class="form-group"><label>Days From</label><input type="text" class="form-control" name="days-prior-from" value="'+(""!=t.days_prior_from&&null!=t.days_prior_from?t.days_prior_from:"")+'" readonly></div></div><div class="col-md-6"><div class="form-group"><label>Days To</label><input type="text" class="form-control" name="days-prior-to" value="'+(""!=t.days_prior_to&&null!=t.days_prior_to?t.days_prior_to:"")+'" readonly></div></div></div>';var u=1==t.discount_type?"Percent":"Fee",f=""!=t.minimum_stay&&null!=t.minimum_stay?t.minimum_stay:"";d='<div class="row"><div class="col-md-6"><div class="form-group"><div class="mt-checkbox-list /*margin-top-15*/"><label class="mt-checkbox mt-checkbox-outline no-margin-bottom"> Non Refundable<input type="checkbox" value="1" name="non-refundable" onclick="return false;" '+(1==t.non_refundable?"checked":"")+'/><span></span></label></div></div></div><div class="col-md-6"><div class="form-group"><div class="mt-checkbox-list /*margin-top-15*/"><label class="mt-checkbox mt-checkbox-outline no-margin-bottom"> Apply with other offers<input type="checkbox" value="1" name="apply-with-other-offers" onclick="return false;" '+(1==t.apply_with_other_offers?"checked":"")+'/><span></span></label></div></div></div></div><div class="row"><div class="col-md-6"><div class="form-group"><label>Minimum Stay</label><input type="text" class="form-control" name="minimum-stay" value="'+f+'" readonly></div></div><div class="col-md-6"><div class="form-group"><label>Booking Type</label><input type="text" class="form-control" name="booking-type" value="'+p+'" readonly></div></div></div>'+l+'<div class="row"><div class="col-md-6"><div class="form-group"><label>Payment Date</label><input type="text" class="form-control" name="payment-date" value="'+s+'" readonly></div></div><div class="col-md-6"><div class="form-group"><label>Percentage Due</label><input type="text" class="form-control" name="percentage-due" value="'+c+'" readonly></div></div></div><div class="row"><div class="col-md-6"><div class="form-group"><label>Discount</label><input type="text" class="form-control" name="discount" value="'+m+'" readonly></div></div><div class="col-md-6"><div class="form-group"><label>Discount Type</label><input type="text" class="form-control" name="discount-type" value="'+u+'" readonly></div></div></div>';$("#modal-info-offer .offer-input-container").append(d)}});var h=$("#modal-add-offer .table-room-type").dataTable({sDom:"tip",autoWidth:!1,columnDefs:[{orderable:!1,className:"dt-center",targets:[0],width:"20%"},{visible:!1,targets:[1]}],order:[[3,"asc"]],lengthMenu:[[-1],["All"]],pageLength:10});h.find(".group-checkable").change(function(){var e=jQuery(this).attr("data-set"),t=jQuery(this).is(":checked");jQuery(e).each(function(){t?($(this).prop("checked",!0),$(this).parents("tr").addClass("active")):($(this).prop("checked",!1),$(this).parents("tr").removeClass("active"))}),$("#modal-add-offer :input[name=count-offer-room-type]").val(a(h))}),h.on("change","tbody tr .checkboxes",function(){$(this).parents("tr").toggleClass("active"),$("#modal-add-offer :input[name=count-offer-room-type]").val(a(h))}),$("#modal-add-offer :input[name=search-code]").on("keyup",function(){h.api().columns(2).search($('#modal-add-offer :input[name="search-code"]').val()).columns(3).search($('#modal-add-offer :input[name="search-name"]').val()).draw()}),$("#modal-add-offer :input[name=search-name]").on("keyup",function(){h.api().columns(2).search($('#modal-add-offer :input[name="search-code"]').val()).columns(3).search($('#modal-add-offer :input[name="search-name"]').val()).draw()});var b=$("#modal-info-offer .table-room-type").dataTable({sDom:"tip",autoWidth:!1,order:[[1,"asc"]],lengthMenu:[[-1],["All"]],pageLength:10}),g=$("#modal-edit-offer .table-room-type").dataTable({sDom:"tip",autoWidth:!1,columnDefs:[{orderable:!1,className:"dt-center",targets:[0],width:"20%"},{visible:!1,targets:[1]}],order:[[3,"asc"]],lengthMenu:[[-1],["All"]],pageLength:10});g.find(".group-checkable").change(function(){var e=jQuery(this).attr("data-set"),t=jQuery(this).is(":checked");jQuery(e).each(function(){t?($(this).prop("checked",!0),$(this).parents("tr").addClass("active")):($(this).prop("checked",!1),$(this).parents("tr").removeClass("active"))}),$("#modal-edit-offer :input[name=count-offer-room-type]").val(a(g))}),g.on("change","tbody tr .checkboxes",function(){$(this).parents("tr").toggleClass("active"),$("#modal-edit-offer :input[name=count-offer-room-type]").val(a(g))}),$("#modal-edit-offer :input[name=search-code]").on("keyup",function(){g.api().columns(2).search($('#modal-edit-offer :input[name="search-code"]').val()).columns(3).search($('#modal-edit-offer :input[name="search-name"]').val()).draw()}),$("#modal-edit-offer :input[name=search-name]").on("keyup",function(){g.api().columns(2).search($('#modal-edit-offer :input[name="search-code"]').val()).columns(3).search($('#modal-edit-offer :input[name="search-name"]').val()).draw()});var k=$("#modal-add-offer .table-board-type").dataTable({sDom:"tip",autoWidth:!1,columnDefs:[{orderable:!1,className:"dt-center",targets:[0],width:"20%"},{visible:!1,targets:[1]}],order:[[3,"asc"]],lengthMenu:[[-1],["All"]],pageLength:10});k.find(".group-checkable").change(function(){var e=jQuery(this).attr("data-set"),t=jQuery(this).is(":checked");jQuery(e).each(function(){t?($(this).prop("checked",!0),$(this).parents("tr").addClass("active")):($(this).prop("checked",!1),$(this).parents("tr").removeClass("active"))}),$("#modal-add-offer :input[name=count-offer-board-type]").val(a(k))}),k.on("change","tbody tr .checkboxes",function(){$(this).parents("tr").toggleClass("active"),$("#modal-add-offer :input[name=count-offer-board-type]").val(a(k))});var y=$("#modal-info-offer .table-board-type").dataTable({sDom:"tip",autoWidth:!1,order:[[1,"asc"]],lengthMenu:[[-1],["All"]],pageLength:10}),T=$("#modal-edit-offer .table-board-type").dataTable({sDom:"tip",autoWidth:!1,columnDefs:[{orderable:!1,className:"dt-center",targets:[0],width:"20%"},{visible:!1,targets:[1]}],order:[[3,"asc"]],lengthMenu:[[-1],["All"]],pageLength:10});T.find(".group-checkable").change(function(){var e=jQuery(this).attr("data-set"),t=jQuery(this).is(":checked");jQuery(e).each(function(){t?($(this).prop("checked",!0),$(this).parents("tr").addClass("active")):($(this).prop("checked",!1),$(this).parents("tr").removeClass("active"))}),$("#modal-edit-offer :input[name=count-offer-board-type]").val(a(T))}),T.on("change","tbody tr .checkboxes",function(){$(this).parents("tr").toggleClass("active"),$("#modal-edit-offer :input[name=count-offer-board-type]").val(a(T))}),$(".add-offer").on("click",function(e){f.validate().resetForm(),f[0].reset(),$("#modal-add-offer .range-optional").each(function(){$(this).remove()}),$("#modal-add-offer :input[name=offer-type]").val("").change();var t=m.room_types;h.api().clear();for(var a=0;a<t.length;a++)h.api().row.add(['<label class="mt-checkbox mt-checkbox-single mt-checkbox-outline"><input type="checkbox" class="checkboxes" value="1" /><span></span></label>',t[a].id,t[a].code,t[a].name]).draw(!1);$("#modal-complements :input[name=count-offer-room-type]").val(0),h.api().columns.adjust().draw();var o=m.board_types;k.api().clear();for(a=0;a<o.length;a++)k.api().row.add(['<label class="mt-checkbox mt-checkbox-single mt-checkbox-outline"><input type="checkbox" class="checkboxes" value="1" /><span></span></label>',o[a].id,o[a].code,o[a].name]).draw(!1);$("#modal-complements :input[name=count-offer-board-type]").val(0),k.api().columns.adjust().draw()});var o=!1;$("#table-offer tbody").on("click",".dt-delete",function(e){if(!o){var t=A.row($(this).parents("tr")).data();$(this).confirmation("show"),$(this).on("confirmed.bs.confirmation",function(){o=!0,$.ajax({url:routeDeleteOffer,type:"POST",data:{id:t.id},beforeSend:function(){App.showMask(!0,$("#table-offer"))},complete:function(e,t){if(o=!1,App.showMask(!1,$("#table-offer")),"419"==e.status)location.reload(!0);else if("200"!=e.status)toastr.error("Please check your connection and try again.","Error on loading the content");else{var a=$.parseJSON(e.responseText);"success"==a.status?(toastr.success(a.message,"Success"),A.draw(),c&&(l=!0)):toastr.error(a.message,"Error")}}})})}e.preventDefault()}),$(".cancel-form-offer").on("click",function(e){d&&(A.draw(),d=!1)}),$.fn.dataTable.ext.errMode="none";var A=$("#table-offer").on("error.dt",function(e,t,a,o){}).on("processing.dt",function(e,t,a){App.showMask(a,$(this)),App.reloadToolTips()}).on("init.dt",function(){}).DataTable({processing:!0,serverSide:!0,sDom:"tip",iDisplayLength:10,ajax:{url:routeReadOffer,type:"POST",data:function(e){return e.contractId=null==m?0:m.id,e},complete:function(e,t){"419"==e.status?location.reload(!0):"200"!=e.status&&toastr.error("Please check your connection and try again.","Error on loading the content"),$(".br-readonly").on("click",function(e){e.preventDefault()})}},order:[[1,"asc"]],columns:[{data:"id",name:"id",visible:!1},{data:"name",name:"name",width:"35%"},{data:"type",name:"type",orderable:!1,width:"30%"},{data:"active",name:"active",className:"dt-center",data:function(e,t,a,o){var n='<span><i class="fa fa-close dt-active dt-active-0"></i></span>';return 1==e.active&&(n='<span><i class="fa fa-check dt-active dt-active-1"></i></span>'),n}},{targets:"actions",orderable:!1,name:"actions",className:"dt-center",data:function(e,t,a,o){return'<div class="dt-actions"><a class="btn btn-default btn-circle btn-icon-only btn-action dt-view" data-toggle="modal" href="#modal-info-offer"><i class="glyphicon glyphicon-eye-open btn-action-icon"></i></a><a class="btn btn-default btn-circle btn-icon-only btn-action dt-edit" data-toggle="modal" href="#modal-edit-offer"><i class="icon-pencil btn-action-icon"></i></a><a class="btn btn-default btn-circle btn-icon-only btn-action dt-delete" href="javascript:;" data-popout="true" data-placement="left"data-btn-ok-label="Yes" data-btn-ok-class="btn-sm btn-success"  data-btn-ok-icon-content="check" data-btn-cancel-label="No" data-btn-cancel-class="btn-sm btn-danger" data-btn-cancel-icon-content="close" data-title="Are you sure?" data-content=""><i class="icon-trash btn-action-icon"></i></a></div>'}}]});$(".btn-complements").on("click",function(){$("#modal-complements .contract-name").html(m.name),A.draw(),$("#modal-complements").modal("show")}),$(".check-all-rooms").on("click",function(e){e.preventDefault(),"check"==$(this).attr("data")?($(this).attr("data","uncheck"),$(".room-selected").each(function(){$(this).prop("checked",!1)})):($(this).attr("data","check"),$(".room-selected").each(function(){$(this).prop("checked",!0)}))})});