$(document).ready(function(){var r=!1,d=!1,y=null;$("#modal-add [id=rate_fee_value_1_add]").TouchSpin({min:-1e9,max:1e9,stepinterval:50,step:.01,decimals:2,maxboostedstep:10,prefix:"$"}),$("#modal-add [id=rate_percent_value_1_add]").TouchSpin({min:-100,max:100,step:.01,decimals:2,boostat:5,maxboostedstep:10,postfix:"%"}),$("#modal-add [id=rate_type_percent_1_add]").change(function(){$("#modal-add [id=rate_fee_value_1_add]").val(""),$("#modal-add [id=rate_fee_value_1_add]").attr("disabled","disabled"),$("#modal-add [id=rate_percent_value_1_add]").removeAttr("disabled")}),$("#modal-add [id=rate_type_fee_1_add]").change(function(){$("#modal-add [id=rate_percent_value_1_add]").val(""),$("#modal-add [id=rate_percent_value_1_add]").attr("disabled","disabled"),$("#modal-add [id=rate_fee_value_1_add]").removeAttr("disabled")}),$("#modal-add :input[name=select-markets]").multiSelect({afterSelect:function(e){var a='<li data-tab="'+e+'">',t='<div class="tab-pane" id="tab_'+e+'_add" data-tab="'+e+'">';a+='<a href="#tab_'+e+'_add" data-toggle="tab"> '+$("#modal-add :input[name=select-markets] option[value="+e+"]").html()+" </a></li>",t+='<div class="row" style="margin-top:15px;"><div class="col-md-6 col-sm-6 col-xs-12"><div class="mt-radio-list" style="padding: 0;"><label class="mt-radio mt-radio-outline custom-radio"><input type="radio" name="rate_type_'+e+'" id="rate_type_percent_'+e+'_add" value="1" data-target="rate_percent_value_'+e+'_add" data-market="'+e+'" checked><div class="form-group"><input class="form-control percent" placeholder="Percent" type="text" value="" name="rate_percent_value_'+e+'" id="rate_percent_value_'+e+'_add"/></div><span style="margin-top: 8px;"></span></label><label class="mt-radio mt-radio-outline custom-radio"><input type="radio" name="rate_type_'+e+'" id="rate_type_fee_'+e+'_add" value="2" data-target="rate_fee_value_'+e+'_add" data-market="'+e+'"><div class="form-group"><input class="form-control fee" placeholder="Fee" type="text" value="" name="rate_fee_value_'+e+'" id="rate_fee_value_'+e+'_add" disabled/></div><span style="margin-top: 8px;"></span></label></div></div><div class="col-md-6 col-sm-6 col-xs-12"><div class="mt-radio-list" style="padding: 0;"><label class="mt-radio mt-radio-outline custom-radio"><input type="radio" name="round_method_'+e+'_add" id="round_method_1_'+e+'" value="1" data-market="'+e+'" checked> Default Round<span></span></label><label class="mt-radio mt-radio-outline custom-radio"><input type="radio" name="round_method_'+e+'_add" id="round_method_2_'+e+'" value="2" data-market="'+e+'"> Integer Round<span></span></label><label class="mt-radio mt-radio-outline custom-radio"><input type="radio" name="round_method_'+e+'_add" id="round_method_3_'+e+'" value="3" data-market="'+e+'"> Integer Round Up<span></span></label></div></div></div>',t+="</div>",$("#modal-add .market-rate-container .custom-tab").append(a),$("#modal-add .market-rate-container .custom-content").append(t),$("#modal-add .market-rate-container").show(),$("#rate_fee_value_"+e+"_add").TouchSpin({min:-1e9,max:1e9,stepinterval:50,step:.01,decimals:2,maxboostedstep:10,prefix:"$"}),$("#rate_percent_value_"+e+"_add").TouchSpin({min:-100,max:100,step:.01,decimals:2,boostat:5,maxboostedstep:10,postfix:"%"}),$("#rate_type_percent_"+e+"_add").change(function(){$("#rate_fee_value_"+e+"_add").val(""),$("#rate_fee_value_"+e+"_add").attr("disabled","disabled"),$("#rate_percent_value_"+e+"_add").removeAttr("disabled")}),$("#rate_type_fee_"+e+"_add").change(function(){$("#rate_percent_value_"+e+"_add").val(""),$("#rate_percent_value_"+e+"_add").attr("disabled","disabled"),$("#rate_fee_value_"+e+"_add").removeAttr("disabled")})},afterDeselect:function(e){$('#modal-add [data-tab="'+e+'"]').remove(),$("#modal-add .nav-tabs li").children("a").first().click()},keepOrder:!0}),$("#search-section :input[name=valid-from]").datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0,format:"dd.mm.yyyy",orientation:"bottom"}),$("#search-section :input[name=valid-to]").datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0,format:"dd.mm.yyyy",orientation:"bottom"}),$("#modal-add :input[name=valid-from]").datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0,format:"dd.mm.yyyy",orientation:"bottom"}).on("changeDate",function(e){var a=$(this).val(),t=$("#modal-add :input[name=valid-to]").val(),o=moment(a,"DD.MM.YYYY"),n=moment(t,"DD.MM.YYYY");(""==t||0!=a&&""!=a&&moment(n).isBefore(o))&&$("#modal-add :input[name=valid-to]").datepicker("setDate",new Date(moment(a,"DD.MM.YYYY")))}),$("#modal-add :input[name=valid-to]").datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0,format:"dd.mm.yyyy",orientation:"bottom"}).on("changeDate",function(e){var a=$(this).val(),t=$('#modal-add :input[name="valid-from"]').val(),o=moment(t,"DD.MM.YYYY"),n=moment(a,"DD.MM.YYYY");(""==t||0!=t&&""!=t&&moment(n).isBefore(o))&&$('#modal-add :input[name="valid-from"]').datepicker("setDate",new Date(moment(a,"DD.MM.YYYY")))}),$("#modal-edit :input[name=valid-from]").datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0,format:"dd.mm.yyyy",orientation:"bottom"}).on("changeDate",function(e){var a=$(this).val(),t=$("#modal-edit :input[name=valid-to]").val(),o=moment(a,"DD.MM.YYYY"),n=moment(t,"DD.MM.YYYY");(""==t||0!=a&&""!=a&&moment(n).isBefore(o))&&$("#modal-edit :input[name=valid-to]").datepicker("setDate",new Date(moment(a,"DD.MM.YYYY")))}),$("#modal-edit :input[name=valid-to]").datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0,format:"dd.mm.yyyy",orientation:"bottom"}).on("changeDate",function(e){var a=$(this).val(),t=$('#modal-edit :input[name="valid-from"]').val(),o=moment(t,"DD.MM.YYYY"),n=moment(a,"DD.MM.YYYY");(""==t||0!=t&&""!=t&&moment(n).isBefore(o))&&$('#modal-edit :input[name="valid-from"]').datepicker("setDate",new Date(moment(a,"DD.MM.YYYY")))}),$("#modal-add-offer :input[name=valid-from]").datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0,format:"dd.mm.yyyy",orientation:"bottom"}).on("changeDate",function(e){var a=$(this).val(),t=$("#modal-add-offer :input[name=valid-to]").val(),o=moment(a,"DD.MM.YYYY"),n=moment(t,"DD.MM.YYYY");(""==t||0!=a&&""!=a&&moment(n).isBefore(o))&&$("#modal-add-offer :input[name=valid-to]").datepicker("setDate",new Date(moment(a,"DD.MM.YYYY")))}),$("#modal-add-offer :input[name=valid-to]").datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0,format:"dd.mm.yyyy",orientation:"bottom"}).on("changeDate",function(e){var a=$(this).val(),t=$('#modal-add-offer :input[name="valid-from"]').val(),o=moment(t,"DD.MM.YYYY"),n=moment(a,"DD.MM.YYYY");(""==t||0!=t&&""!=t&&moment(n).isBefore(o))&&$('#modal-add-offer :input[name="valid-from"]').datepicker("setDate",new Date(moment(a,"DD.MM.YYYY")))}),$("#modal-edit-offer :input[name=valid-from]").datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0,format:"dd.mm.yyyy",orientation:"bottom"}).on("changeDate",function(e){var a=$(this).val(),t=$("#modal-edit-offer :input[name=valid-to]").val(),o=moment(a,"DD.MM.YYYY"),n=moment(t,"DD.MM.YYYY");(""==t||0!=a&&""!=a&&moment(n).isBefore(o))&&$("#modal-edit-offer :input[name=valid-to]").datepicker("setDate",new Date(moment(a,"DD.MM.YYYY")))}),$("#modal-edit-offer :input[name=valid-to]").datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0,format:"dd.mm.yyyy",orientation:"bottom"}).on("changeDate",function(e){var a=$(this).val(),t=$('#modal-edit-offer :input[name="valid-from"]').val(),o=moment(t,"DD.MM.YYYY"),n=moment(a,"DD.MM.YYYY");(""==t||0!=t&&""!=t&&moment(n).isBefore(o))&&$('#modal-edit-offer :input[name="valid-from"]').datepicker("setDate",new Date(moment(a,"DD.MM.YYYY")))}),$("#modal-add-offer :input[name=offer-type]").change(function(){if($("#modal-add-offer .offer-input-container").html(""),"early_booking"==$("#modal-add-offer :input[name=offer-type] option:selected").attr("data-code")){$("#modal-add-offer .offer-input-container").append('<div class="row"><div class="col-md-6"><div class="form-group"><div class="mt-checkbox-list /*margin-top-15*/"><label class="mt-checkbox mt-checkbox-outline no-margin-bottom"> Non Refundable<input type="checkbox" value="1" name="non-refundable"/><span></span></label></div></div></div><div class="col-md-6"><div class="form-group"><div class="mt-checkbox-list /*margin-top-15*/"><label class="mt-checkbox mt-checkbox-outline no-margin-bottom"> Apply with other offers<input type="checkbox" value="1" name="apply-with-other-offers"/><span></span></label></div></div></div></div><div class="row"><div class="col-md-6"><div class="form-group"><label>Booking Date From</label><input type="text" class="form-control" placeholder="Booking Date From" name="booking-date-from"></div></div><div class="col-md-6"><div class="form-group"><label>Booking Date To</label><input type="text" class="form-control" placeholder="Booking Date To" name="booking-date-to"></div></div></div><div class="row"><div class="col-md-6"><div class="form-group"><label>Payment Date</label><input type="text" class="form-control" placeholder="Payment Date" name="payment-date"></div></div><div class="col-md-6"><div class="form-group"><label>Percentage Due</label><input type="text" class="form-control" placeholder="Percentage Due" name="percentage-due"></div></div></div><div class="row"><div class="col-md-6"><div class="form-group"><label>Discount</label><input type="text" class="form-control" placeholder="Discount" name="discount"></div></div><div class="col-md-6"><div class="form-group"><label>Discount Type</label><select class="form-control" name="discount-type"><option value="1">Percent</option><option value="2">Fee</option></select></div></div></div><div class="row"><div class="col-md-6"><div class="form-group"><label>Minimum Stay</label><input type="text" class="form-control" placeholder="Minimum Stay" name="minimum-stay"></div></div></div>'),$("#modal-add-offer :input[name=booking-date-from]").datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0,format:"dd.mm.yyyy",orientation:"bottom"}).on("changeDate",function(e){var a=$(this).val(),t=$("#modal-add-offer :input[name=booking-date-to]").val(),o=moment(a,"DD.MM.YYYY"),n=moment(t,"DD.MM.YYYY");(""==t||0!=a&&""!=a&&moment(n).isBefore(o))&&$("#modal-add-offer :input[name=booking-date-to]").datepicker("setDate",new Date(moment(a,"DD.MM.YYYY")))}),$("#modal-add-offer :input[name=booking-date-to]").datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0,format:"dd.mm.yyyy",orientation:"bottom"}).on("changeDate",function(e){var a=$(this).val(),t=$('#modal-add-offer :input[name="booking-date-from"]').val(),o=moment(t,"DD.MM.YYYY"),n=moment(a,"DD.MM.YYYY");(""==t||0!=t&&""!=t&&moment(n).isBefore(o))&&$('#modal-add-offer :input[name="booking-date-from"]').datepicker("setDate",new Date(moment(a,"DD.MM.YYYY")))}),$("#modal-add-offer :input[name=payment-date]").datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0,format:"dd.mm.yyyy",orientation:"bottom"})}}),$("#modal-edit-offer :input[name=offer-type]").change(function(){if($("#modal-edit-offer .offer-input-container").html(""),"early_booking"==$("#modal-edit-offer :input[name=offer-type] option:selected").attr("data-code")){$("#modal-edit-offer .offer-input-container").append('<div class="row"><div class="col-md-6"><div class="form-group"><div class="mt-checkbox-list /*margin-top-15*/"><label class="mt-checkbox mt-checkbox-outline no-margin-bottom"> Non Refundable<input type="checkbox" value="1" name="non-refundable"/><span></span></label></div></div></div><div class="col-md-6"><div class="form-group"><div class="mt-checkbox-list /*margin-top-15*/"><label class="mt-checkbox mt-checkbox-outline no-margin-bottom"> Apply with other offers<input type="checkbox" value="1" name="apply-with-other-offers"/><span></span></label></div></div></div></div><div class="row"><div class="col-md-6"><div class="form-group"><label>Booking Date From</label><input type="text" class="form-control" placeholder="Booking Date From" name="booking-date-from"></div></div><div class="col-md-6"><div class="form-group"><label>Booking Date To</label><input type="text" class="form-control" placeholder="Booking Date To" name="booking-date-to"></div></div></div><div class="row"><div class="col-md-6"><div class="form-group"><label>Payment Date</label><input type="text" class="form-control" placeholder="Payment Date" name="payment-date"></div></div><div class="col-md-6"><div class="form-group"><label>Percentage Due</label><input type="text" class="form-control" placeholder="Percentage Due" name="percentage-due"></div></div></div><div class="row"><div class="col-md-6"><div class="form-group"><label>Discount</label><input type="text" class="form-control" placeholder="Discount" name="discount"></div></div><div class="col-md-6"><div class="form-group"><label>Discount Type</label><select class="form-control" name="discount-type"><option value="1">Percent</option><option value="2">Fee</option></select></div></div></div><div class="row"><div class="col-md-6"><div class="form-group"><label>Minimum Stay</label><input type="text" class="form-control" placeholder="Minimum Stay" name="minimum-stay"></div></div></div>'),$("#modal-edit-offer :input[name=booking-date-from]").datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0,format:"dd.mm.yyyy",orientation:"bottom"}).on("changeDate",function(e){var a=$(this).val(),t=$("#modal-edit-offer :input[name=booking-date-to]").val(),o=moment(a,"DD.MM.YYYY"),n=moment(t,"DD.MM.YYYY");(""==t||0!=a&&""!=a&&moment(n).isBefore(o))&&$("#modal-edit-offer :input[name=booking-date-to]").datepicker("setDate",new Date(moment(a,"DD.MM.YYYY")))}),$("#modal-edit-offer :input[name=booking-date-to]").datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0,format:"dd.mm.yyyy",orientation:"bottom"}).on("changeDate",function(e){var a=$(this).val(),t=$('#modal-edit-offer :input[name="booking-date-from"]').val(),o=moment(t,"DD.MM.YYYY"),n=moment(a,"DD.MM.YYYY");(""==t||0!=t&&""!=t&&moment(n).isBefore(o))&&$('#modal-edit-offer :input[name="booking-date-from"]').datepicker("setDate",new Date(moment(a,"DD.MM.YYYY")))}),$("#modal-edit-offer :input[name=payment-date]").datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0,format:"dd.mm.yyyy",orientation:"bottom"})}}),jQuery.validator.addMethod("validDate",function(e,a){return this.optional(a)||moment(e,"DD.MM.YYYY",!0).isValid()},"Invalid date, use dd.mm.yyyy.");var l=$("#form-add-offer");l.validate({errorElement:"span",errorClass:"help-block help-block-error",focusInvalid:!1,ignore:"",rules:{"valid-from":{required:!0,validDate:!0},"valid-to":{required:!0,validDate:!0},"count-offer-room-type":{greaterThanZero:!0},name:{required:!0},"offer-type":{required:!0},priority:{required:!0}},errorPlacement:function(e,a){0<a.parents(".mt-radio-list").size()||0<a.parents(".mt-checkbox-list").size()?(0<a.parents(".mt-radio-list").size()&&e.appendTo(a.parents(".mt-radio-list")[0]),0<a.parents(".mt-checkbox-list").size()&&e.appendTo(a.parents(".mt-checkbox-list")[0])):0<a.parents(".mt-radio-inline").size()||0<a.parents(".mt-checkbox-inline").size()?(0<a.parents(".mt-radio-inline").size()&&e.appendTo(a.parents(".mt-radio-inline")[0]),0<a.parents(".mt-checkbox-inline").size()&&e.appendTo(a.parents(".mt-checkbox-inline")[0])):0<a.parent(".input-group").size()?e.insertAfter(a.parent(".input-group")):a.attr("data-error-container")?e.appendTo(a.attr("data-error-container")):a.hasClass("hotel-category")?e.insertAfter(a.next()):a.hasClass("hotel-type")?(e.insertAfter(a.next().next()),$("#modal-add-offer :input[name=search-code]").css("border","1px solid #c2cad8"),$("#modal-add-offer :input[name=search-name]").css("border","1px solid #c2cad8")):a.hasClass("select-hotel")?e.insertAfter(a.next()):a.hasClass("market-rate-price-type")?(e.appendTo(".market-rate-container-error"),$(".market-rate-container-error > span").css("color","#e73d4a")):e.insertAfter(a)},invalidHandler:function(e,a){toastr.error("Please check the entry fields.","Error")},highlight:function(e){$(e).closest(".form-group").addClass("has-error")},unhighlight:function(e){$(e).closest(".form-group").removeClass("has-error")},success:function(e){e.closest(".form-group").removeClass("has-error")},submitHandler:function(o){var n=$(o).find("button[type=submit]:focus").attr("data"),e=new FormData(l[0]),a=y.id,t=[];$("#modal-add-offer .range").each(function(){var e={from:$(this).find('input[name^="valid-from"]').val(),to:$(this).find('input[name^="valid-to"]').val()};t.push(e)});var i=c(p);e.append("room-types",JSON.stringify(i)),e.append("ranges",JSON.stringify(t)),e.append("contractId",a),$.ajax({url:routeSaveOffer,type:"POST",data:e,contentType:!1,processData:!1,beforeSend:function(){App.showMask(!0,l)},complete:function(e,a){if(App.showMask(!1,l),"419"==e.status)location.reload(!0);else if("200"!=e.status)toastr.error("Please check your connection and try again.","Error on loading the content");else{var t=$.parseJSON(e.responseText);"success"==t.status?(toastr.success(t.message,"Success"),d=!0,"accept"==n&&($(o).find("button.cancel-form-offer").click(),l[0].reset())):toastr.error(t.message,"Error")}}})}});var s=$("#form-edit-offer");function g(e){return $('tbody > tr > td:nth-child(1) input[type="checkbox"]:checked',e).size()}function c(a){var t=[];return $('tbody > tr > td:nth-child(1) input[type="checkbox"]:checked',a).each(function(){var e=a.api().row($(this).parents("tr")).data();t.push(e[1])}),t}function k(e){$("tbody > tr",e).each(function(){$(this).removeClass("active")})}s.validate({errorElement:"span",errorClass:"help-block help-block-error",focusInvalid:!1,ignore:"",rules:{"valid-from":{required:!0,validDate:!0},"valid-to":{required:!0,validDate:!0},"count-offer-room-type":{greaterThanZero:!0},name:{required:!0},"offer-type":{required:!0},priority:{required:!0}},errorPlacement:function(e,a){0<a.parents(".mt-radio-list").size()||0<a.parents(".mt-checkbox-list").size()?(0<a.parents(".mt-radio-list").size()&&e.appendTo(a.parents(".mt-radio-list")[0]),0<a.parents(".mt-checkbox-list").size()&&e.appendTo(a.parents(".mt-checkbox-list")[0])):0<a.parents(".mt-radio-inline").size()||0<a.parents(".mt-checkbox-inline").size()?(0<a.parents(".mt-radio-inline").size()&&e.appendTo(a.parents(".mt-radio-inline")[0]),0<a.parents(".mt-checkbox-inline").size()&&e.appendTo(a.parents(".mt-checkbox-inline")[0])):0<a.parent(".input-group").size()?e.insertAfter(a.parent(".input-group")):a.attr("data-error-container")?e.appendTo(a.attr("data-error-container")):a.hasClass("hotel-category")?e.insertAfter(a.next()):a.hasClass("hotel-type")?(e.insertAfter(a.next().next()),$("#modal-edit-offer :input[name=search-code]").css("border","1px solid #c2cad8"),$("#modal-edit-offer :input[name=search-name]").css("border","1px solid #c2cad8")):a.hasClass("select-hotel")?e.insertAfter(a.next()):a.hasClass("market-rate-price-type")?(e.appendTo(".market-rate-container-error"),$(".market-rate-container-error > span").css("color","#e73d4a")):e.insertAfter(a)},invalidHandler:function(e,a){toastr.error("Please check the entry fields.","Error")},highlight:function(e){$(e).closest(".form-group").addClass("has-error")},unhighlight:function(e){$(e).closest(".form-group").removeClass("has-error")},success:function(e){e.closest(".form-group").removeClass("has-error")},submitHandler:function(o){var n=$(o).find("button[type=submit]:focus").attr("data"),e=new FormData(s[0]),a=$("#modal-edit-offer :input[name=id]").val(),t=[];$("#modal-edit-offer .range").each(function(){var e={from:$(this).find('input[name^="valid-from"]').val(),to:$(this).find('input[name^="valid-to"]').val()};t.push(e)});var i=c(u);e.append("room-types",JSON.stringify(i)),e.append("ranges",JSON.stringify(t)),e.append("id",a),$.ajax({url:routeUpdateOffer,type:"POST",data:e,contentType:!1,processData:!1,beforeSend:function(){App.showMask(!0,s)},complete:function(e,a){if(App.showMask(!1,s),"419"==e.status)location.reload(!0);else if("200"!=e.status)toastr.error("Please check your connection and try again.","Error on loading the content");else{var t=$.parseJSON(e.responseText);"success"==t.status?(toastr.success(t.message,"Success"),d=!0,"accept"==n&&($(o).find("button.cancel-form-offer").click(),s[0].reset())):toastr.error(t.message,"Error")}}})}}),$("#modal-add-offer .add-row-offer").on("click",function(e){e.preventDefault();var i=$.now(),a='<div class="range range-optional" data="'+i+'"><div class="col-md-5 col-sm-5 col-xs-5"><div class="form-group"><label>From</label><div class="input-icon left"><i class="fa fa-calendar"></i><input type="text" class="form-control date-picker" name="valid-from-'+i+'"></div></div></div><div class="col-md-5 col-sm-5 col-xs-5"><div class="form-group"><label>To</label><div class="input-icon left"><i class="fa fa-calendar"></i><input type="text" class="form-control date-picker" name="valid-to-'+i+'"></div></div></div><div class="col-md-2 col-sm-2 col-xs-2"><div class="form-group"><a class="btn red btn-outline delete-row delete-row-offer" href="#" data="'+i+'"><i class="fa fa-trash"></i></a></div></div></div>';$("#modal-add-offer .range-container").append(a),$('#modal-add-offer :input[name="valid-from-'+i+'"]').datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0,format:"dd.mm.yyyy",orientation:"bottom"}).on("changeDate",function(e){var a=$(this).val(),t=$('#modal-add-offer :input[name="valid-to-'+i+'"]').val(),o=moment(a,"DD.MM.YYYY"),n=moment(t,"DD.MM.YYYY");0==a||""==a||0!=t&&""!=t&&!moment(n).isBefore(o)||$('#modal-add-offer :input[name="valid-to-'+i+'"]').datepicker("setDate",new Date(moment(a,"DD.MM.YYYY")))}),$('#modal-add-offer :input[name="valid-to-'+i+'"]').datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0,format:"dd.mm.yyyy",orientation:"bottom"}).on("changeDate",function(e){var a=$(this).val(),t=$('#modal-add-offer :input[name="valid-from-'+i+'"]').val(),o=moment(t,"DD.MM.YYYY"),n=moment(a,"DD.MM.YYYY");0==a||""==a||0!=t&&""!=t&&!moment(n).isBefore(o)||$('#modal-add-offer :input[name="valid-from-'+i+'"]').datepicker("setDate",new Date(moment(a,"DD.MM.YYYY")))});var t=moment(y.valid_from,"YYYY-MM-DD"),o=moment(y.valid_to,"YYYY-MM-DD");$('#modal-add-offer :input[name="valid-from-'+i+'"]').datepicker("setStartDate",new Date(t)),$('#modal-add-offer :input[name="valid-from-'+i+'"]').datepicker("setEndDate",new Date(o)),$('#modal-add-offer :input[name="valid-to-'+i+'"]').datepicker("setStartDate",new Date(t)),$('#modal-add-offer :input[name="valid-to-'+i+'"]').datepicker("setEndDate",new Date(o)),l.validate(),$('#modal-add-offer :input[name="valid-from-'+i+'"]').rules("add","required"),$('#modal-add-offer :input[name="valid-to-'+i+'"]').rules("add","required"),$('#modal-add-offer .delete-row-offer[data="'+i+'"]').on("click",function(e){$('#modal-add-offer .range[data="'+i+'"]').remove(),e.preventDefault()})}),$("#modal-edit-offer .add-row-offer").on("click",function(e){e.preventDefault();var i=$.now(),a='<div class="range range-optional" data="'+i+'"><div class="col-md-5 col-sm-5 col-xs-5"><div class="form-group"><label>From</label><div class="input-icon left"><i class="fa fa-calendar"></i><input type="text" class="form-control date-picker" name="valid-from-'+i+'"></div></div></div><div class="col-md-5 col-sm-5 col-xs-5"><div class="form-group"><label>To</label><div class="input-icon left"><i class="fa fa-calendar"></i><input type="text" class="form-control date-picker" name="valid-to-'+i+'"></div></div></div><div class="col-md-2 col-sm-2 col-xs-2"><div class="form-group"><a class="btn red btn-outline delete-row delete-row-offer" href="#" data="'+i+'"><i class="fa fa-trash"></i></a></div></div></div>';$("#modal-edit-offer .range-container").append(a),$('#modal-edit-offer :input[name="valid-from-'+i+'"]').datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0,format:"dd.mm.yyyy",orientation:"bottom"}).on("changeDate",function(e){var a=$(this).val(),t=$('#modal-edit-offer :input[name="valid-to-'+i+'"]').val(),o=moment(a,"DD.MM.YYYY"),n=moment(t,"DD.MM.YYYY");0==a||""==a||0!=t&&""!=t&&!moment(n).isBefore(o)||$('#modal-edit-offer :input[name="valid-to-'+i+'"]').datepicker("setDate",new Date(moment(a,"DD.MM.YYYY")))}),$('#modal-edit-offer :input[name="valid-to-'+i+'"]').datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0,format:"dd.mm.yyyy",orientation:"bottom"}).on("changeDate",function(e){var a=$(this).val(),t=$('#modal-edit-offer :input[name="valid-from-'+i+'"]').val(),o=moment(t,"DD.MM.YYYY"),n=moment(a,"DD.MM.YYYY");0==a||""==a||0!=t&&""!=t&&!moment(n).isBefore(o)||$('#modal-edit-offer :input[name="valid-from-'+i+'"]').datepicker("setDate",new Date(moment(a,"DD.MM.YYYY")))});var t=moment(y.valid_from,"YYYY-MM-DD"),o=moment(y.valid_to,"YYYY-MM-DD");$('#modal-edit-offer :input[name="valid-from-'+i+'"]').datepicker("setStartDate",new Date(t)),$('#modal-edit-offer :input[name="valid-from-'+i+'"]').datepicker("setEndDate",new Date(o)),$('#modal-edit-offer :input[name="valid-to-'+i+'"]').datepicker("setStartDate",new Date(t)),$('#modal-edit-offer :input[name="valid-to-'+i+'"]').datepicker("setEndDate",new Date(o)),s.validate(),$('#modal-edit-offer :input[name="valid-from-'+i+'"]').rules("add","required"),$('#modal-edit-offer :input[name="valid-to-'+i+'"]').rules("add","required"),$('#modal-edit-offer .delete-row-offer[data="'+i+'"]').on("click",function(e){$('#modal-edit-offer .range[data="'+i+'"]').remove(),e.preventDefault()})}),$(".hotel-category").barrating({theme:"fontawesome-stars"}),$("#modal-add .toggle-hotel").on("click",function(){$("#modal-add .show-hotel").slideToggle()}),$("#modal-add :input[name=category]").barrating("readonly",!0),$("#modal-info :input[name=category]").barrating("readonly",!0),$("#modal-edit :input[name=category]").barrating("readonly",!0),$.fn.dataTable.ext.errMode="none";var D=$("#table").on("error.dt",function(e,a,t,o){}).on("processing.dt",function(e,a,t){App.showMask(t,$(this)),App.reloadToolTips()}).on("init.dt",function(){}).DataTable({processing:!0,serverSide:!0,sDom:"ltip",iDisplayLength:25,ajax:{url:routeRead,type:"POST",complete:function(e,a){"419"==e.status?location.reload(!0):"200"!=e.status&&toastr.error("Please check your connection and try again.","Error on loading the content"),$(".br-readonly").on("click",function(e){e.preventDefault()})}},order:[[1,"asc"]],columns:[{data:"id",name:"id",visible:!1},{data:"name",name:"name"},{data:"hotel",name:"hotel",orderable:!1},{data:"location",name:"location",orderable:!1},{data:"valid_from",name:"valid_from"},{data:"valid_to",name:"valid_to"},{data:"status",name:"status",orderable:!1,data:function(e,a,t,o){var n="";return"3"==e.status?n='<span class="label label-sm label-danger"> Finished </span>':"2"==e.status?n='<span class="label label-sm label-success"> In Progress </span>':"1"==e.status&&(n='<span class="label label-sm label-warning"> Pending </span>'),n}},{data:"active",name:"active",className:"dt-center",data:function(e,a,t,o){var n='<span><i class="fa fa-close dt-active dt-active-0"></i></span>';return 1==e.active&&(n='<span><i class="fa fa-check dt-active dt-active-1"></i></span>'),n}},{targets:"actions",orderable:!1,name:"actions",className:"dt-center nobreakline",data:function(e,a,t,o){for(var n=e.object.measures,i="disabled",d=0;d<n.length;d++)if("offer"==n[d].code||"supplement"==n[d].code||"restriction"==n[d].code){i="";break}return'<form method="get" action="'+routeSetting+'"><input type="hidden" name="id" value="'+e.id+'"><div class="dt-actions"><a class="btn btn-default btn-circle btn-icon-only btn-action dt-view" data-toggle="modal" href="#modal-info"><i class="glyphicon glyphicon-eye-open btn-action-icon"></i></a><a class="btn btn-default btn-circle btn-icon-only btn-action dt-edit" data-toggle="modal" href="#modal-edit"><i class="icon-pencil btn-action-icon"></i></a><a class="btn btn-default btn-circle btn-icon-only btn-action dt-delete" href="javascript:;" data-popout="true" data-placement="left"data-btn-ok-label="Yes" data-btn-ok-class="btn-sm btn-success"  data-btn-ok-icon-content="check" data-btn-cancel-label="No" data-btn-cancel-class="btn-sm btn-danger" data-btn-cancel-icon-content="close" data-title="Are you sure?" data-content=""><i class="icon-trash btn-action-icon"></i></a><a class="btn btn-default btn-circle btn-icon-only btn-action dt-duplicate" href="javascript:;" data-popout="true" data-placement="left"data-btn-ok-label="Yes" data-btn-ok-class="btn-sm btn-success btn-confirmation"  data-btn-ok-icon-content="check" data-btn-cancel-label="No" data-btn-cancel-class="btn-sm btn-danger btn-confirmation" data-btn-cancel-icon-content="close" data-title="Are you sure?" data-content=""><i class="icon-docs btn-action-icon"></i></a><a class="btn btn-default btn-circle btn-icon-only btn-action dt-complements '+i+'" data-toggle="modal" href="#modal-complements"><i class="icon-briefcase btn-action-icon"></i></a><button type="submit" class="btn btn-default btn-circle btn-icon-only btn-action dt-setting"><i class="icon-settings btn-action-icon"></i></button></div></form>'}}]});$("#table_length").hide(),$(".search").on("click",function(e){$("#search-section").slideToggle()}),$(".reload").on("click",function(e){D.draw()}),$(".reload-offer").on("click",function(e){R.draw()}),$(".add").on("click",function(){m.validate().resetForm(),m[0].reset(),$("#modal-add :input[name=category]").barrating("set",""),$("#modal-add .date-picker").datepicker("clearDates"),b.api().clear().draw(),$("#modal-add .js-data-ajax").val(null).trigger("change"),$("#modal-add .select-hotel").val(null).trigger("change"),k(h),k(v),k(_),$("#modal-add :input[name=select-markets]").multiSelect("deselect_all"),$("#modal-add [data-tab]").each(function(){"1"!=$(this).attr("data-tab")&&$(this).remove()}),$("#modal-add .ms-elem-selectable").removeClass("ms-hover")}),$(".lenght-option").on("click",function(){var e=$(this).attr("data");$(this).parent().parent().prev("a").text(e);var a=$("select[name=table_length]");a.val(e),a.change()}),$.validator.addMethod("greaterThanZero",function(e,a,t){return this.optional(a)||0<parseInt(e)},"At least one element is required."),jQuery.validator.addMethod("validDate",function(e,a){return this.optional(a)||moment(e,"DD.MM.YYYY",!0).isValid()},"Invalid date, use dd.mm.yyyy."),$.validator.addMethod("validMarketPriceRate",function(e,a,t){var o=!0;return $('#modal-add [name^="rate_type_"]').each(function(){if($(this).prop("checked")){var e=$(this).attr("data-target"),a=$("#"+e).val();if(""==a||null==a)return o=!1}}),o},"Some market rate price is invalid.");var m=$("#form-add");m.validate({errorElement:"span",errorClass:"help-block help-block-error",focusInvalid:!1,ignore:"",rules:{name:{required:!0},hotel:{required:!0},status:{required:!0},"valid-from":{required:!0,validDate:!0},"valid-to":{required:!0,validDate:!0},"count-board-type":{greaterThanZero:!0},"count-pax-type":{greaterThanZero:!0},"count-room-type":{greaterThanZero:!0},"market-rate-price":{validMarketPriceRate:!0}},errorPlacement:function(e,a){0<a.parents(".mt-radio-list").size()||0<a.parents(".mt-checkbox-list").size()?(0<a.parents(".mt-radio-list").size()&&e.appendTo(a.parents(".mt-radio-list")[0]),0<a.parents(".mt-checkbox-list").size()&&e.appendTo(a.parents(".mt-checkbox-list")[0])):0<a.parents(".mt-radio-inline").size()||0<a.parents(".mt-checkbox-inline").size()?(0<a.parents(".mt-radio-inline").size()&&e.appendTo(a.parents(".mt-radio-inline")[0]),0<a.parents(".mt-checkbox-inline").size()&&e.appendTo(a.parents(".mt-checkbox-inline")[0])):0<a.parent(".input-group").size()?e.insertAfter(a.parent(".input-group")):a.attr("data-error-container")?e.appendTo(a.attr("data-error-container")):a.hasClass("hotel-category")?e.insertAfter(a.next()):a.hasClass("hotel-type")?e.insertAfter(a.next()):a.hasClass("select-hotel")?e.insertAfter(a.next()):a.hasClass("market-rate-price-type")?(e.appendTo(".market-rate-container-error"),$(".market-rate-container-error > span").css("color","#e73d4a")):e.insertAfter(a)},invalidHandler:function(e,a){toastr.error("Please check the entry fields.","Error")},highlight:function(e){$(e).closest(".form-group").addClass("has-error")},unhighlight:function(e){$(e).closest(".form-group").removeClass("has-error")},success:function(e){e.closest(".form-group").removeClass("has-error")},submitHandler:function(o){var n=$(o).find("button[type=submit]:focus").attr("data"),e=new FormData(m[0]),a=[];$('#modal-add [name="check-measures[]"]').each(function(){$(this).prop("checked")&&a.push($(this).attr("data"))});var i=[];$('#modal-add [name^="rate_type_"]:checked').each(function(){var e=$(this).attr("data-target"),a=$(this).attr("data-market"),t=$("#"+e).val(),o=$('#modal-add :input[name="round_method_'+a+'_add"]:checked').val(),n={market_id:a,rate_type:$(this).val(),value:t,round_type:o};i.push(n)}),e.append("paxTypes",JSON.stringify(c(v))),e.append("boardTypes",JSON.stringify(c(h))),e.append("markets",JSON.stringify(c(_))),e.append("roomTypes",JSON.stringify($("#modal-add .js-data-ajax").val())),e.append("measures",JSON.stringify(a)),e.append("markets",JSON.stringify(i)),$.ajax({url:routeCreate,type:"POST",data:e,contentType:!1,processData:!1,beforeSend:function(){App.showMask(!0,m)},complete:function(e,a){if(App.showMask(!1,m),"419"==e.status)location.reload(!0);else if("200"!=e.status)toastr.error("Please check your connection and try again.","Error on loading the content");else{var t=$.parseJSON(e.responseText);"success"==t.status?(toastr.success(t.message,"Success"),m[0].reset(),r=!0,"accept"==n&&$(o).find("button.cancel-form").click(),b.api().clear().draw(),$("#modal-add .js-data-ajax").val(null).trigger("change"),$("#modal-add .select-hotel").val(null).trigger("change"),k(h),k(v),k(_)):toastr.error(t.message,"Error")}}})}}),$(".mt-checkbox").change(function(){$(".mt-checkbox > input[type=checkbox]").is(":checked")?$(".mt-checkbox > input[type=checkbox]").val(1):$(".mt-checkbox > input[type=checkbox]").val(0)}),$.validator.addMethod("validMarketPriceRate2",function(e,a,t){var o=!0;return $('#modal-edit [name^="rate_type_"]').each(function(){if($(this).prop("checked")){var e=$(this).attr("data-target"),a=$("#"+e).val();if(""==a||null==a)return o=!1}}),o},"Some market rate price is invalid.");var x=$("#form-edit");x.validate({errorElement:"span",errorClass:"help-block help-block-error",focusInvalid:!1,ignore:"",rules:{name:{required:!0},"hotel-id":{required:!0},status:{required:!0},"valid-from":{required:!0,validDate:!0},"valid-to":{required:!0,validDate:!0},"count-board-type":{greaterThanZero:!0},"count-pax-type":{greaterThanZero:!0},"count-room-type":{greaterThanZero:!0},"market-rate-price":{validMarketPriceRate2:!0}},errorPlacement:function(e,a){0<a.parents(".mt-radio-list").size()||0<a.parents(".mt-checkbox-list").size()?(0<a.parents(".mt-radio-list").size()&&e.appendTo(a.parents(".mt-radio-list")[0]),0<a.parents(".mt-checkbox-list").size()&&e.appendTo(a.parents(".mt-checkbox-list")[0])):0<a.parents(".mt-radio-inline").size()||0<a.parents(".mt-checkbox-inline").size()?(0<a.parents(".mt-radio-inline").size()&&e.appendTo(a.parents(".mt-radio-inline")[0]),0<a.parents(".mt-checkbox-inline").size()&&e.appendTo(a.parents(".mt-checkbox-inline")[0])):0<a.parent(".input-group").size()?e.insertAfter(a.parent(".input-group")):a.attr("data-error-container")?e.appendTo(a.attr("data-error-container")):a.hasClass("hotel-category")?e.insertAfter(a.next()):a.hasClass("hotel-type")?e.insertAfter(a.next()):a.hasClass("market-rate-price-type")?(e.appendTo(".market-rate-container-error"),$(".market-rate-container-error > span").css("color","#e73d4a")):e.insertAfter(a)},invalidHandler:function(e,a){toastr.error("Please check the entry fields.","Error")},highlight:function(e){$(e).closest(".form-group").addClass("has-error")},unhighlight:function(e){$(e).closest(".form-group").removeClass("has-error")},success:function(e){e.closest(".form-group").removeClass("has-error")},submitHandler:function(o){var e=new FormData(x[0]),a=[];$('#modal-edit [name="check-measures[]"]').each(function(){$(this).prop("checked")&&a.push($(this).attr("data"))});var d=[];$('#modal-edit [name^="rate_type_"]:checked').each(function(){var e=$(this).attr("data-target"),a=$(this).attr("data-market"),t=$("#"+e).val(),o=$('#modal-edit :input[name="round_method_'+a+'_edit"]:checked').val(),n=$('#modal-edit :input[name="update_prices_'+a+'_edit"]:checked').val(),i={market_id:a,rate_type:$(this).val(),value:t,round_type:o,update_price:null==n?"0":n};d.push(i)});var t=c(T),n=c(A),i=$("#modal-edit .js-data-ajax").val();e.get("active");e.append("paxTypes",JSON.stringify(t)),e.append("boardTypes",JSON.stringify(n)),e.append("roomTypes",JSON.stringify(i)),e.append("measures",JSON.stringify(a)),e.append("markets",JSON.stringify(d)),$.ajax({url:routeUpdate,type:"POST",data:e,contentType:!1,processData:!1,beforeSend:function(){App.showMask(!0,x)},complete:function(e,a){if(App.showMask(!1,x),"419"==e.status)location.reload(!0);else if("200"!=e.status)toastr.error("Please check your connection and try again.","Error on loading the content");else{var t=$.parseJSON(e.responseText);"419"==e.status?location.reload(!0):"success"==t.status?(toastr.success(t.message,"Success"),r=!0,$(o).find("button.cancel-form").click()):toastr.error(t.message,"Error"),k(A),k(T)}}})}}),$("#rate_fee_value_1_info").TouchSpin({min:-1e9,max:1e9,stepinterval:50,step:.01,decimals:2,maxboostedstep:10,prefix:"$"}),$("#rate_percent_value_1_info").TouchSpin({min:-100,max:100,step:.01,decimals:2,boostat:5,maxboostedstep:10,postfix:"%"}),$("#table tbody").on("click",".dt-view",function(e){var a=D.row($(this).parents("tr")).data(),t=a.object,o=t.hotel,n=t.pax_types,i=t.board_types,d=t.room_types,r=t.measures,l=t.markets,s=null!=o.country?o.country.name:"",c=null!=o.state?o.state.name:"",m=null!=o.city?o.city.name:"",p=null!=o.hotel_chain?o.hotel_chain.name:"";$("#modal-info :input[name=name]").val(t.name),$("#modal-info :input[name=valid-from]").val(moment(t.valid_from,"YYYY-MM-DD").format("DD.MM.YYYY")),$("#modal-info :input[name=valid-to]").val(moment(t.valid_to,"YYYY-MM-DD").format("DD.MM.YYYY")),$("#modal-info :input[name=hotel]").val(o.name),$("#modal-info :input[name=country-text]").val(s),$("#modal-info :input[name=state-text]").val(c),$("#modal-info :input[name=city-text]").val(m),$("#modal-info :input[name=postal-code]").val(o.postal_code),$("#modal-info :input[name=address]").val(o.address),$("#modal-info :input[name=category]").barrating("set",o.category),$("#modal-info :input[name=hotel-chain]").val(p),$("#modal-info :input[name=admin-phone]").val(o.admin_phone),$("#modal-info :input[name=admin-fax]").val(o.admin_fax),$("#modal-info :input[name=web-site]").val(o.web_site),$("#modal-info :input[name=turistic-licence]").val(o.turistic_licence),$("#modal-info :input[name=email]").val(o.email),1==a.active?($("#modal-info :input[name=active]").prop("checked","checked"),$("#modal-info :input[name=active]").val(1)):($("#modal-info :input[name=active]").prop("checked",""),$("#modal-info :input[name=active]").val(0)),$('#modal-info [name="check-measures[]"]').prop("checked","");for(var u=0;u<r.length;u++)$('#modal-info [name="check-measures[]"][data="'+r[u].id+'"]').prop("checked","checked");$("#modal-info [data-tab]").each(function(){"1"!=$(this).attr("data-tab")&&$(this).remove()}),$("#modal-info .nav-tabs li").children("a").first().click(),$("#modal-info [id=rate_fee_value_1_info]").val(""),$("#modal-info [id=rate_fee_value_1_info]").attr("disabled","disabled"),$("#modal-info [id=rate_percent_value_1_info]").val(""),$("#modal-info [id=rate_percent_value_1_info]").attr("disabled","disabled");for(u=0;u<l.length;u++){var f=l[u].pivot;if(1==l[u].id)"1"==f.type?($("#modal-info [id=rate_percent_value_1_info]").val(f.value),$("#modal-info [id=rate_type_percent_1_info]").prop("checked","checked")):"2"==f.type&&($("#modal-info [id=rate_fee_value_1_info]").val(f.value),$("#modal-info [id=rate_type_fee_1_info]").prop("checked","checked")),"1"==f.round?$("#modal-info [id=round_method_1_1_info]").prop("checked","checked"):"2"==f.round?$("#modal-info [id=round_method_2_1_info]").prop("checked","checked"):"3"==f.round&&$("#modal-info [id=round_method_3_1_info]").prop("checked","checked");else{var v='<li data-tab="'+l[u].id+'">',h='<div class="tab-pane" id="tab_'+l[u].id+'_info" data-tab="'+l[u].id+'">';v+='<a href="#tab_'+l[u].id+'_info" data-toggle="tab"> '+l[u].name+" </a></li>",h+='<div class="row" style="margin-top:15px;"><div class="col-md-6 col-sm-6 col-xs-12"><div class="mt-radio-list" style="padding: 0;"><label class="mt-radio mt-radio-outline custom-radio">',"1"==f.type?h+='<input type="radio" name="rate_type_'+l[u].id+'" id="rate_type_percent_'+l[u].id+'_info" value="1" data-target="rate_percent_value_'+l[u].id+'_info" data-market="'+l[u].id+'" checked onclick="return false;"><div class="form-group"><input class="form-control percent" placeholder="Percent" type="text" value="'+f.value+'" name="rate_percent_value_'+l[u].id+'" id="rate_percent_value_'+l[u].id+'_info" disabled/></div>':h+='<input type="radio" name="rate_type_'+l[u].id+'" id="rate_type_percent_'+l[u].id+'_info" value="1" data-target="rate_percent_value_'+l[u].id+'_info" data-market="'+l[u].id+'" onclick="return false;"><div class="form-group"><input class="form-control percent" placeholder="Percent" type="text" value="" name="rate_percent_value_'+l[u].id+'" id="rate_percent_value_'+l[u].id+'_info" disabled/></div>',h+='<span style="margin-top: 8px;"></span></label><label class="mt-radio mt-radio-outline custom-radio">',"2"==f.type?h+='<input type="radio" name="rate_type_'+l[u].id+'" id="rate_type_fee_'+l[u].id+'_info" value="2" data-target="rate_fee_value_'+l[u].id+'_info" data-market="'+l[u].id+'" checked onclick="return false;"><div class="form-group"><input class="form-control fee" placeholder="Fee" type="text" value="'+f.value+'" name="rate_fee_value_'+l[u].id+'" id="rate_fee_value_'+l[u].id+'_info" disabled/></div>':h+='<input type="radio" name="rate_type_'+l[u].id+'" id="rate_type_fee_'+l[u].id+'_info" value="2" data-target="rate_fee_value_'+l[u].id+'_info" data-market="'+l[u].id+'" onclick="return false;"><div class="form-group"><input class="form-control fee" placeholder="Fee" type="text" value="" name="rate_fee_value_'+l[u].id+'" id="rate_fee_value_'+l[u].id+'_info" disabled/></div>',h+='<span style="margin-top: 8px;"></span></label></div></div><div class="col-md-6 col-sm-6 col-xs-12"><div class="mt-radio-list" style="padding: 0;"><label class="mt-radio mt-radio-outline custom-radio">',"1"==f.round?h+='<input type="radio" name="round_method_'+l[u].id+'" id="round_method_1_'+l[u].id+'_info" value="1" data-market="'+l[u].id+'" checked onclick="return false;"> Default Round':h+='<input type="radio" name="round_method_'+l[u].id+'" id="round_method_1_'+l[u].id+'_info" value="1" data-market="'+l[u].id+'" onclick="return false;"> Default Round',h+='<span></span></label><label class="mt-radio mt-radio-outline custom-radio">',"2"==f.round?h+='<input type="radio" name="round_method_'+l[u].id+'" id="round_method_2_'+l[u].id+'_info" value="2" data-market="'+l[u].id+'" checked onclick="return false;"> Integer Round':h+='<input type="radio" name="round_method_'+l[u].id+'" id="round_method_2_'+l[u].id+'_info" value="2" data-market="'+l[u].id+'" onclick="return false;"> Integer Round',h+='<span></span></label><label class="mt-radio mt-radio-outline custom-radio">',"3"==f.round?h+='<input type="radio" name="round_method_'+l[u].id+'" id="round_method_3_'+l[u].id+'_info" value="3" data-market="'+l[u].id+'" checked onclick="return false;"> Integer Round Up':h+='<input type="radio" name="round_method_'+l[u].id+'" id="round_method_3_'+l[u].id+'_info" value="3" data-market="'+l[u].id+'" onclick="return false;"> Integer Round Up',h+="<span></span></label></div></div></div>",h+="</div>",$("#modal-info .market-rate-container .custom-tab").append(v),$("#modal-info .market-rate-container .custom-content").append(h),$("#rate_fee_value_"+l[u].id+"_info").TouchSpin({min:-1e9,max:1e9,stepinterval:50,step:.01,decimals:2,maxboostedstep:10,prefix:"$"}),$("#rate_percent_value_"+l[u].id+"_info").TouchSpin({min:-100,max:100,step:.01,decimals:2,boostat:5,maxboostedstep:10,postfix:"%"})}}Y.api().clear();for(u=0;u<n.length;u++)Y.api().row.add([n[u].id,n[u].code+": "+n[u].name,n[u].agefrom,n[u].ageto]).draw(!1);Y.api().columns.adjust().draw(),w.api().clear();for(u=0;u<i.length;u++)w.api().row.add([i[u].id,i[u].code+": "+i[u].name]).draw(!1);w.api().columns.adjust().draw(),M.api().clear();for(u=0;u<d.length;u++)M.api().row.add([d[u].id,d[u].code+": "+d[u].name,d[u].max_pax,d[u].min_pax,d[u].max_adult,d[u].min_adult,d[u].max_children,d[u].min_children,d[u].max_infant,d[u].min_infant]).draw(!1);M.api().columns.adjust().draw(),e.preventDefault()}),$("#modal-edit :input[name=hotel]").select2({width:"off",ajax:{url:routeHotelSearchActive,type:"POST",dataType:"json",delay:250,data:function(e){return{q:e.term,page:e.page}},processResults:function(e,a){return{results:e}},complete:function(e,a){"419"==e.status&&location.reload(!0)},cache:!0},escapeMarkup:function(e){return e},minimumInputLength:3,templateResult:e,templateSelection:a}),$("#modal-edit :input[name=hotel]").on("select2:select select2:unselect",function(e){var a=e.params.data;if(a.selected){var t=null!=a.country?a.country.name:"",o=null!=a.state?a.state.name:"",n=null!=a.city?a.city.name:"",i=null!=a.hotel_chain?a.hotel_chain.name:"";$("#modal-edit .show-hotel :input[name=hotel-id]").val(a.id),$("#modal-edit .show-hotel :input[name=name]").val(a.name),$("#modal-edit .show-hotel :input[name=country-text]").val(t),$("#modal-edit .show-hotel :input[name=state-text]").val(o),$("#modal-edit .show-hotel :input[name=city-text]").val(n),$("#modal-edit .show-hotel :input[name=postal-code]").val(a.postal_code),$("#modal-edit .show-hotel :input[name=address]").val(a.address),$("#modal-edit .show-hotel :input[name=category]").barrating("readonly",!0);var d=null!=a.category?a.category:"";$("#modal-edit .show-hotel :input[name=category]").barrating("set",d),$("#modal-edit .show-hotel :input[name=hotel-chain]").val(i),$("#modal-edit .show-hotel :input[name=admin-phone]").val(a.admin_phone),$("#modal-edit .show-hotel :input[name=admin-fax]").val(a.admin_fax),$("#modal-edit .show-hotel :input[name=web-site]").val(a.web_site),$("#modal-edit .show-hotel :input[name=turistic-licence]").val(a.turistic_licence),$("#modal-edit .show-hotel :input[name=email]").val(a.email)}}),$("#rate_fee_value_1_edit").TouchSpin({min:-1e9,max:1e9,stepinterval:50,step:.01,decimals:2,maxboostedstep:10,prefix:"$"}),$("#rate_percent_value_1_edit").TouchSpin({min:-100,max:100,step:.01,decimals:2,boostat:5,maxboostedstep:10,postfix:"%"}),$("#modal-edit :input[name=select-markets]").multiSelect({afterSelect:function(e){var a='<li data-tab="'+e+'">',t='<div class="tab-pane" id="tab_'+e+'_edit" data-tab="'+e+'">';a+='<a href="#tab_'+e+'_edit" data-toggle="tab"> '+$("#modal-edit :input[name=select-markets] option[value="+e+"]").html()+" </a></li>",t+='<div class="row" style="margin-top:15px;"><div class="col-md-5 col-sm-5 col-xs-12"><div class="mt-radio-list" style="padding: 0;"><label class="mt-radio mt-radio-outline custom-radio"><input type="radio" name="rate_type_'+e+'" id="rate_type_percent_'+e+'_edit" value="1" data-target="rate_percent_value_'+e+'_edit" data-market="'+e+'" checked><div class="form-group"><input class="form-control percent" placeholder="Percent" type="text" value="" name="rate_percent_value_'+e+'" id="rate_percent_value_'+e+'_edit"/></div><span style="margin-top: 8px;"></span></label><label class="mt-radio mt-radio-outline custom-radio"><input type="radio" name="rate_type_'+e+'" id="rate_type_fee_'+e+'_edit" value="2" data-target="rate_fee_value_'+e+'_edit" data-market="'+e+'"><div class="form-group"><input class="form-control fee" placeholder="Fee" type="text" value="" name="rate_fee_value_'+e+'" id="rate_fee_value_'+e+'_edit" disabled/></div><span style="margin-top: 8px;"></span></label></div></div><div class="col-md-3 col-sm-3 col-xs-12"><div class="mt-radio-list" style="padding: 0;"><label class="mt-radio mt-radio-outline custom-radio"><input type="radio" name="round_method_'+e+'_edit" id="round_method_1_'+e+'" value="1" data-market="'+e+'" checked> Default Round<span></span></label><label class="mt-radio mt-radio-outline custom-radio"><input type="radio" name="round_method_'+e+'_edit" id="round_method_2_'+e+'" value="2" data-market="'+e+'"> Integer Round<span></span></label><label class="mt-radio mt-radio-outline custom-radio"><input type="radio" name="round_method_'+e+'_edit" id="round_method_3_'+e+'" value="3" data-market="'+e+'"> Integer Round Up<span></span></label></div></div><div class="col-md-4 col-sm-4 col-xs-12"><div class="mt-checkbox-list" style="padding: 0"><label class="mt-checkbox mt-checkbox-outline"><input type="checkbox" name="update_prices_'+e+'_edit" value="1"> Update related prices<span></span></label></div></div></div>',t+="</div>",$("#modal-edit .market-rate-container .custom-tab").append(a),$("#modal-edit .market-rate-container .custom-content").append(t),$("#modal-edit .market-rate-container").show(),$("#rate_fee_value_"+e+"_edit").TouchSpin({min:-1e9,max:1e9,stepinterval:50,step:.01,decimals:2,maxboostedstep:10,prefix:"$"}),$("#rate_percent_value_"+e+"_edit").TouchSpin({min:-100,max:100,step:.01,decimals:2,boostat:5,maxboostedstep:10,postfix:"%"}),$("#rate_type_percent_"+e+"_edit").change(function(){$("#rate_fee_value_"+e+"_edit").val(""),$("#rate_fee_value_"+e+"_edit").attr("disabled","disabled"),$("#rate_percent_value_"+e+"_edit").removeAttr("disabled")}),$("#rate_type_fee_"+e+"_edit").change(function(){$("#rate_percent_value_"+e+"_edit").val(""),$("#rate_percent_value_"+e+"_edit").attr("disabled","disabled"),$("#rate_fee_value_"+e+"_edit").removeAttr("disabled")})},afterDeselect:function(e){$('#modal-edit [data-tab="'+e+'"]').remove(),$("#modal-edit .nav-tabs li").children("a").first().click()},keepOrder:!0}),$("#table tbody").on("click",".dt-edit",function(e){$("#modal-edit .parent-select-room").html(""),k(A),k(T),x.validate().resetForm(),x[0].reset();var a=D.row($(this).parents("tr")).data();y=a.object;var t=a.object,o=t.hotel,n=t.pax_types,i=t.board_types,d=t.room_types,r=t.measures,l=t.markets,s=null!=o.country?o.country.name:"",c=null!=o.state?o.state.name:"",m=null!=o.city?o.city.name:"",p=null!=o.hotel_chain?o.hotel_chain.name:"";$("#modal-edit :input[name=id]").val(t.id),$("#modal-edit :input[name=hotel-id]").val(o.id),$("#modal-edit .select2-selection__rendered").html(o.name+'<span class="select2-selection__placeholder"></span>'),$("#modal-edit :input[name=name]").val(t.name),$("#modal-edit :input[name=valid-from]").datepicker("setDate",new Date(moment(t.valid_from,"YYYY-MM-DD"))),$("#modal-edit :input[name=valid-to]").datepicker("setDate",new Date(moment(t.valid_to,"YYYY-MM-DD"))),$("#modal-edit :input[name=country-text]").val(s),$("#modal-edit :input[name=state-text]").val(c),$("#modal-edit :input[name=city-text]").val(m),$("#modal-edit :input[name=postal-code]").val(o.postal_code),$("#modal-edit :input[name=address]").val(o.address),$("#modal-edit :input[name=category]").barrating("set",o.category),$("#modal-edit :input[name=hotel-chain]").val(p),$("#modal-edit :input[name=admin-phone]").val(o.admin_phone),$("#modal-edit :input[name=admin-fax]").val(o.admin_fax),$("#modal-edit :input[name=web-site]").val(o.web_site),$("#modal-edit :input[name=turistic-licence]").val(o.turistic_licence),$("#modal-edit :input[name=email]").val(o.email),1==a.active?($("#modal-edit :input[name=active]").prop("checked","checked"),$("#modal-edit :input[name=active]").val(1)):($("#modal-edit :input[name=active]").prop("checked",""),$("#modal-edit :input[name=active]").val(0));for(var u=0;u<r.length;u++)$('#modal-edit [name="check-measures[]"][data="'+r[u].id+'"]').prop("checked","checked");$("#modal-edit :input[name=select-markets]").multiSelect("deselect_all"),$("#modal-edit .ms-elem-selectable").removeClass("ms-hover"),$("#modal-edit [id=rate_fee_value_1_edit]").val(""),$("#modal-edit [id=rate_percent_value_1_edit]").val(""),$("#modal-edit [data-tab]").each(function(){"1"!=$(this).attr("data-tab")&&$(this).remove()}),$("#modal-edit .nav-tabs li").children("a").first().click(),$("#modal-edit [id=rate_type_percent_1_edit]").change(function(){$("#modal-edit [id=rate_fee_value_1_edit]").val(""),$("#modal-edit [id=rate_fee_value_1_edit]").attr("disabled","disabled"),$("#modal-edit [id=rate_percent_value_1_edit]").removeAttr("disabled")}),$("#modal-edit [id=rate_type_fee_1_edit]").change(function(){$("#modal-edit [id=rate_percent_value_1_edit]").val(""),$("#modal-edit [id=rate_percent_value_1_edit]").attr("disabled","disabled"),$("#modal-edit [id=rate_fee_value_1_edit]").removeAttr("disabled")});for(u=0;u<l.length;u++){var f=l[u].pivot;if(1==l[u].id)"1"==f.type?($("#modal-edit [id=rate_percent_value_1_edit]").val(f.value),$("#modal-edit [id=rate_type_percent_1_edit]").prop("checked","checked"),$("#modal-edit [id=rate_fee_value_1_edit]").attr("disabled","disabled"),$("#modal-edit [id=rate_percent_value_1_edit]").removeAttr("disabled")):"2"==f.type&&($("#modal-edit [id=rate_fee_value_1_edit]").val(f.value),$("#modal-edit [id=rate_type_fee_1_edit]").prop("checked","checked"),$("#modal-edit [id=rate_percent_value_1_edit]").attr("disabled","disabled"),$("#modal-edit [id=rate_fee_value_1_edit]").removeAttr("disabled")),"1"==f.round?$("#modal-edit [id=round_method_1_1_edit]").prop("checked","checked"):"2"==f.round?$("#modal-edit [id=round_method_2_1_edit]").prop("checked","checked"):"3"==f.round&&$("#modal-edit [id=round_method_3_1_edit]").prop("checked","checked");else{$("#modal-edit :input[name=select-markets]").find("option[value="+l[u].id+"]").prop("selected","selected");var v='<li data-tab="'+l[u].id+'">',h='<div class="tab-pane" id="tab_'+l[u].id+'_edit" data-tab="'+l[u].id+'">';v+='<a href="#tab_'+l[u].id+'_edit" data-toggle="tab"> '+l[u].name+" </a></li>",h+='<div class="row" style="margin-top:15px;"><div class="col-md-5 col-sm-5 col-xs-12"><div class="mt-radio-list" style="padding: 0;"><label class="mt-radio mt-radio-outline custom-radio">',"1"==f.type?h+='<input type="radio" name="rate_type_'+l[u].id+'" id="rate_type_percent_'+l[u].id+'_edit" value="1" data-target="rate_percent_value_'+l[u].id+'_edit" data-market="'+l[u].id+'" checked><div class="form-group"><input class="form-control percent" placeholder="Percent" type="text" value="'+f.value+'" name="rate_percent_value_'+l[u].id+'" id="rate_percent_value_'+l[u].id+'_edit"/></div>':h+='<input type="radio" name="rate_type_'+l[u].id+'" id="rate_type_percent_'+l[u].id+'_edit" value="1" data-target="rate_percent_value_'+l[u].id+'_edit" data-market="'+l[u].id+'"><div class="form-group"><input class="form-control percent" placeholder="Percent" type="text" value="" name="rate_percent_value_'+l[u].id+'" id="rate_percent_value_'+l[u].id+'_edit" disabled/></div>',h+='<span style="margin-top: 8px;"></span></label><label class="mt-radio mt-radio-outline custom-radio">',"2"==f.type?h+='<input type="radio" name="rate_type_'+l[u].id+'" id="rate_type_fee_'+l[u].id+'_edit" value="2" data-target="rate_fee_value_'+l[u].id+'_edit" data-market="'+l[u].id+'" checked><div class="form-group"><input class="form-control fee" placeholder="Fee" type="text" value="'+f.value+'" name="rate_fee_value_'+l[u].id+'" id="rate_fee_value_'+l[u].id+'_edit"/></div>':h+='<input type="radio" name="rate_type_'+l[u].id+'" id="rate_type_fee_'+l[u].id+'_edit" value="2" data-target="rate_fee_value_'+l[u].id+'_edit" data-market="'+l[u].id+'"><div class="form-group"><input class="form-control fee" placeholder="Fee" type="text" value="" name="rate_fee_value_'+l[u].id+'" id="rate_fee_value_'+l[u].id+'_edit" disabled/></div>',h+='<span style="margin-top: 8px;"></span></label></div></div><div class="col-md-3 col-sm-3 col-xs-12"><div class="mt-radio-list" style="padding: 0;"><label class="mt-radio mt-radio-outline custom-radio">',"1"==f.round?h+='<input type="radio" name="round_method_'+l[u].id+'_edit" id="round_method_1_'+l[u].id+'_edit" value="1" data-market="'+l[u].id+'" checked> Default Round':h+='<input type="radio" name="round_method_'+l[u].id+'_edit" id="round_method_1_'+l[u].id+'_edit" value="1" data-market="'+l[u].id+'"> Default Round',h+='<span></span></label><label class="mt-radio mt-radio-outline custom-radio">',"2"==f.round?h+='<input type="radio" name="round_method_'+l[u].id+'_edit" id="round_method_2_'+l[u].id+'_edit" value="2" data-market="'+l[u].id+'" checked> Integer Round':h+='<input type="radio" name="round_method_'+l[u].id+'_edit" id="round_method_2_'+l[u].id+'_edit" value="2" data-market="'+l[u].id+'"> Integer Round',h+='<span></span></label><label class="mt-radio mt-radio-outline custom-radio">',"3"==f.round?h+='<input type="radio" name="round_method_'+l[u].id+'_edit" id="round_method_3_'+l[u].id+'_edit" value="3" data-market="'+l[u].id+'" checked> Integer Round Up':h+='<input type="radio" name="round_method_'+l[u].id+'_edit" id="round_method_3_'+l[u].id+'_edit" value="3" data-market="'+l[u].id+'"> Integer Round Up',h+='<span></span></label></div></div><div class="col-md-4 col-sm-4 col-xs-12"><div class="mt-checkbox-list" style="padding: 0"><label class="mt-checkbox mt-checkbox-outline"><input type="checkbox" name="update_prices_'+l[u].id+'_edit" value="1"> Update related prices<span></span></label></div></div></div>',h+="</div>",$("#modal-edit .market-rate-container .custom-tab").append(v),$("#modal-edit .market-rate-container .custom-content").append(h),$("#rate_fee_value_"+l[u].id+"_edit").TouchSpin({min:-1e9,max:1e9,stepinterval:50,step:.01,decimals:2,maxboostedstep:10,prefix:"$"}),$("#rate_percent_value_"+l[u].id+"_edit").TouchSpin({min:-100,max:100,step:.01,decimals:2,boostat:5,maxboostedstep:10,postfix:"%"}),$("#modal-edit [id=rate_type_percent_"+l[u].id+"_edit]").change(function(){var e=$(this).attr("data-market");$("#modal-edit [id=rate_fee_value_"+e+"_edit]").val(""),$("#modal-edit [id=rate_fee_value_"+e+"_edit]").attr("disabled","disabled"),$("#modal-edit [id=rate_percent_value_"+e+"_edit]").removeAttr("disabled")}),$("#modal-edit [id=rate_type_fee_"+l[u].id+"_edit]").change(function(){var e=$(this).attr("data-market");$("#modal-edit [id=rate_percent_value_"+e+"_edit]").val(""),$("#modal-edit [id=rate_percent_value_"+e+"_edit]").attr("disabled","disabled"),$("#modal-edit [id=rate_fee_value_"+e+"_edit]").removeAttr("disabled")})}}$("#modal-edit :input[name=select-markets]").multiSelect("refresh");for(u=0;u<n.length;u++)$('tbody > tr > td:nth-child(1) input[type="checkbox"]',T).each(function(){T.api().row($(this).parents("tr")).data()[1]==n[u].id&&$(this).prop("checked","checked")});$("#modal-edit :input[name=count-pax-type]").val(g(T)),T.api().columns.adjust().draw();for(u=0;u<i.length;u++)$('tbody > tr > td:nth-child(1) input[type="checkbox"]',A).each(function(){A.api().row($(this).parents("tr")).data()[1]==i[u].id&&$(this).prop("checked","checked")});$("#modal-edit :input[name=count-board-type]").val(g(A)),A.api().columns.adjust().draw();var _=[],b=[];S.api().clear();for(u=0;u<d.length;u++)S.api().row.add([d[u].id,d[u].code+": "+d[u].name,d[u].max_pax,d[u].min_pax,d[u].max_adult,d[u].min_adult,d[u].max_children,d[u].min_children,d[u].max_infant,d[u].min_infant]).draw(!1),b.push({id:d[u].id,code:d[u].code,name:d[u].name}),_.push(d[u].id);$("#modal-edit :input[name=count-room-type]").val(d.length),S.api().columns.adjust().draw();$("#modal-edit .parent-select-room").append('<label class="control-label">Search Room Type</label><div class="input-group input-group-md select2-bootstrap-append"><select class="form-control js-data-ajax" multiple></select></div>'),$("#modal-edit .js-data-ajax").select2({data:b,width:"off",ajax:{url:routeRoomTypeSearchActive,type:"POST",dataType:"json",delay:250,data:function(e){return{q:e.term,page:e.page}},processResults:function(e,a){return{results:e}},complete:function(e,a){"419"==e.status&&location.reload(!0)},cache:!0},escapeMarkup:function(e){return e},minimumInputLength:3,templateResult:j,templateSelection:C}),$("#modal-edit .js-data-ajax").on("select2:select select2:unselect",function(e){var o=e.params.data;if(o.selected)S.api().row.add([o.id,o.code+": "+o.name,o.max_pax,o.min_pax,o.max_adult,o.min_adult,o.max_children,o.min_children,o.max_infant,o.min_infant]).draw(!1),S.api().columns.adjust().draw();else{var a=!1,t=$(this).val();if(null!=t)for(var n=0;n<t.length;n++)if(t[n]==o.id){a=!0;break}a||S.api().rows(function(e,a,t){return a[0]==o.id}).remove().draw()}$("#modal-edit :input[name=count-room-type]").val(S.api().rows().count())}),$("#modal-edit .js-data-ajax").val(_).trigger("change"),e.preventDefault()}),$("#table-offer tbody").on("click",".dt-edit",function(e){$("#modal-edit-offer .delete-row-offer").each(function(){$(this).click()});for(var a=R.row($(this).parents("tr")).data().object,t=y.room_types,o=a.rooms,n=a.ranges,i=a.offer_type,d=0;d<n.length;d++)0==d?($("#modal-edit-offer :input[name=valid-from]").datepicker("setDate",new Date(moment(n[d].from,"YYYY-MM-DD"))),$("#modal-edit-offer :input[name=valid-to]").datepicker("setDate",new Date(moment(n[d].to,"YYYY-MM-DD")))):($("#modal-edit-offer .add-row-offer").click(),$("#modal-edit-offer :input[name^=valid-from-]").last().datepicker("setDate",new Date(moment(n[d].from,"YYYY-MM-DD"))),$("#modal-edit-offer :input[name^=valid-to-]").last().datepicker("setDate",new Date(moment(n[d].to,"YYYY-MM-DD"))));u.api().clear();for(d=0;d<t.length;d++)u.api().row.add(['<label class="mt-checkbox mt-checkbox-single mt-checkbox-outline"> <input type="checkbox" class="checkboxes" value="1" /><span></span></label>',t[d].id,t[d].code,t[d].name]).draw(!1);$("#modal-edit-offer :input[name=count-offer-room-type]").val(o.length),u.api().columns.adjust().draw();for(d=0;d<o.length;d++)$('tbody > tr > td:nth-child(1) input[type="checkbox"]',u).each(function(){u.api().row($(this).parents("tr")).data()[1]==o[d].hotel_room_type_id&&$(this).prop("checked","checked")});$("#modal-edit-offer :input[name=id]").val(a.id),$("#modal-edit-offer :input[name=name]").val(a.name),$("#modal-edit-offer :input[name=priority]").val(a.priority),1==a.active?($("#modal-edit-offer :input[name=active]").prop("checked","checked"),$("#modal-edit-offer :input[name=active]").val(1)):($("#modal-edit-offer :input[name=active]").prop("checked",""),$("#modal-edit-offer :input[name=active]").val(0)),$("#modal-edit-offer :input[name=offer-type]").val(i.id).change(),"early_booking"==$("#modal-edit-offer :input[name=offer-type] option:selected").attr("data-code")&&(1==a.apply_with_other_offers?($('#modal-edit-offer :input[name="apply-with-other-offers"]').prop("checked","checked"),$('#modal-edit-offer :input[name="apply-with-other-offers"]').val(1)):($('#modal-edit-offer :input[name="apply-with-other-offers"]').prop("checked",""),$('#modal-edit-offer :input[name="apply-with-other-offers"]').val(0)),1==a.non_refundable?($('#modal-edit-offer :input[name="non-refundable"]').prop("checked","checked"),$('#modal-edit-offer :input[name="non-refundable"]').val(1)):($('#modal-edit-offer :input[name="non-refundable"]').prop("checked",""),$('#modal-edit-offer :input[name="non-refundable"]').val(0)),$("#modal-edit-offer :input[name=booking-date-from]").datepicker("setDate",new Date(moment(a.booking_date_from,"YYYY-MM-DD"))),$("#modal-edit-offer :input[name=booking-date-to]").datepicker("setDate",new Date(moment(a.booking_date_to,"YYYY-MM-DD"))),$("#modal-edit-offer :input[name=payment-date]").datepicker("setDate",new Date(moment(a.payment_date,"YYYY-MM-DD"))),$("#modal-edit-offer :input[name=percentage-due]").val(a.percentage_due),$("#modal-edit-offer :input[name=discount]").val(a.discount),$("#modal-edit-offer :input[name=discount-type]").val(a.discount_type),$("#modal-edit-offer :input[name=minimum-stay]").val(a.minimum_stay))}),$("#table-offer tbody").on("click",".dt-view",function(e){var a=R.row($(this).parents("tr")).data().object,t=a.rooms,o=a.ranges,n=a.offer_type;$("#modal-info-offer .range-container").html("");for(var i=0;i<o.length;i++){var d='<div class="range"><div class="col-md-6 col-sm-6 col-xs-6"><div class="form-group"><label>From</label><div class="input-icon left"><i class="fa fa-calendar"></i><input type="text" class="form-control date-picker" name="valid-from" value="'+moment(o[i].from,"YYYY-MM-DD").format("DD.MM.YYYY")+'" readonly></div></div></div><div class="col-md-6 col-sm-6 col-xs-6"><div class="form-group"><label>To</label><div class="input-icon left"><i class="fa fa-calendar"></i><input type="text" class="form-control date-picker" name="valid-to" value="'+moment(o[i].to,"YYYY-MM-DD").format("DD.MM.YYYY")+'" readonly></div></div></div></div>';$("#modal-info-offer .range-container").append(d)}f.api().clear();for(i=0;i<t.length;i++)f.api().row.add([t[i].room_type.code,t[i].room_type.name]).draw(!1);if(f.api().columns.adjust().draw(),$("#modal-info-offer :input[name=name]").val(a.name),$("#modal-info-offer :input[name=priority]").val(a.priority),1==a.active?($("#modal-info-offer :input[name=active]").prop("checked","checked"),$("#modal-info-offer :input[name=active]").val(1)):($("#modal-info-offer :input[name=active]").prop("checked",""),$("#modal-info-offer :input[name=active]").val(0)),$("#modal-info-offer :input[name=offer-type]").val(n.name),$("#modal-info-offer .offer-input-container").html(""),"early_booking"==n.code){var r=""!=a.booking_date_from&&null!=a.booking_date_from?moment(a.booking_date_from,"YYYY-MM-DD").format("DD.MM.YYYY"):"",l=""!=a.booking_date_to&&null!=a.booking_date_to?moment(a.booking_date_to,"YYYY-MM-DD").format("DD.MM.YYYY"):"",s=""!=a.payment_date&&null!=a.payment_date?moment(a.payment_date,"YYYY-MM-DD").format("DD.MM.YYYY"):"",c=""!=a.percentage_due&&null!=a.percentage_due?a.percentage_due:"",m=""!=a.discount&&null!=a.discount?a.discount:"",p=1==a.discount_type?"Percent":"Fee",u=""!=a.minimum_stay&&null!=a.minimum_stay?a.minimum_stay:"";d='<div class="row"><div class="col-md-6"><div class="form-group"><div class="mt-checkbox-list /*margin-top-15*/"><label class="mt-checkbox mt-checkbox-outline no-margin-bottom"> Non Refundable<input type="checkbox" value="1" name="non-refundable" onclick="return false;" '+(1==a.non_refundable?"checked":"")+'/><span></span></label></div></div></div><div class="col-md-6"><div class="form-group"><div class="mt-checkbox-list /*margin-top-15*/"><label class="mt-checkbox mt-checkbox-outline no-margin-bottom"> Apply with other offers<input type="checkbox" value="1" name="apply-with-other-offers" onclick="return false;" '+(1==a.apply_with_other_offers?"checked":"")+'/><span></span></label></div></div></div></div><div class="row"><div class="col-md-6"><div class="form-group"><label>Booking Date From</label><input type="text" class="form-control" name="booking-date-from" value="'+r+'" readonly></div></div><div class="col-md-6"><div class="form-group"><label>Booking Date To</label><input type="text" class="form-control" name="booking-date-to" value="'+l+'" readonly></div></div></div><div class="row"><div class="col-md-6"><div class="form-group"><label>Payment Date</label><input type="text" class="form-control" name="payment-date" value="'+s+'" readonly></div></div><div class="col-md-6"><div class="form-group"><label>Percentage Due</label><input type="text" class="form-control" name="percentage-due" value="'+c+'" readonly></div></div></div><div class="row"><div class="col-md-6"><div class="form-group"><label>Discount</label><input type="text" class="form-control" name="discount" value="'+m+'" readonly></div></div><div class="col-md-6"><div class="form-group"><label>Discount Type</label><input type="text" class="form-control" name="discount-type" value="'+p+'" readonly></div></div></div><div class="row"><div class="col-md-6"><div class="form-group"><label>Minimum Stay</label><input type="text" class="form-control" name="minimum-stay" value="'+u+'" readonly></div></div></div>';$("#modal-info-offer .offer-input-container").append(d)}});var p=$("#modal-add-offer .table-room-type").dataTable({sDom:"tip",autoWidth:!1,columnDefs:[{orderable:!1,className:"dt-center",targets:[0],width:"20%"},{visible:!1,targets:[1]}],order:[[3,"asc"]],lengthMenu:[[-1],["All"]],pageLength:10});p.find(".group-checkable").change(function(){var e=jQuery(this).attr("data-set"),a=jQuery(this).is(":checked");jQuery(e).each(function(){a?($(this).prop("checked",!0),$(this).parents("tr").addClass("active")):($(this).prop("checked",!1),$(this).parents("tr").removeClass("active"))}),$("#modal-add-offer :input[name=count-offer-room-type]").val(g(p))}),p.on("change","tbody tr .checkboxes",function(){$(this).parents("tr").toggleClass("active"),$("#modal-add-offer :input[name=count-offer-room-type]").val(g(p))}),$("#modal-add-offer :input[name=search-code]").on("keyup",function(){p.api().columns(2).search($('#modal-add-offer :input[name="search-code"]').val()).columns(3).search($('#modal-add-offer :input[name="search-name"]').val()).draw()}),$("#modal-add-offer :input[name=search-name]").on("keyup",function(){p.api().columns(2).search($('#modal-add-offer :input[name="search-code"]').val()).columns(3).search($('#modal-add-offer :input[name="search-name"]').val()).draw()});var f=$("#modal-info-offer .table-room-type").dataTable({sDom:"tip",autoWidth:!1,order:[[1,"asc"]],lengthMenu:[[-1],["All"]],pageLength:10}),u=$("#modal-edit-offer .table-room-type").dataTable({sDom:"tip",autoWidth:!1,columnDefs:[{orderable:!1,className:"dt-center",targets:[0],width:"20%"},{visible:!1,targets:[1]}],order:[[3,"asc"]],lengthMenu:[[-1],["All"]],pageLength:10});u.find(".group-checkable").change(function(){var e=jQuery(this).attr("data-set"),a=jQuery(this).is(":checked");jQuery(e).each(function(){a?($(this).prop("checked",!0),$(this).parents("tr").addClass("active")):($(this).prop("checked",!1),$(this).parents("tr").removeClass("active"))}),$("#modal-edit-offer :input[name=count-offer-room-type]").val(g(u))}),u.on("change","tbody tr .checkboxes",function(){$(this).parents("tr").toggleClass("active"),$("#modal-edit-offer :input[name=count-offer-room-type]").val(g(u))}),$("#modal-edit-offer :input[name=search-code]").on("keyup",function(){u.api().columns(2).search($('#modal-edit-offer :input[name="search-code"]').val()).columns(3).search($('#modal-edit-offer :input[name="search-name"]').val()).draw()}),$("#modal-edit-offer :input[name=search-name]").on("keyup",function(){u.api().columns(2).search($('#modal-edit-offer :input[name="search-code"]').val()).columns(3).search($('#modal-edit-offer :input[name="search-name"]').val()).draw()}),$(".add-offer").on("click",function(e){l.validate().resetForm(),l[0].reset(),$("#modal-add-offer .range-optional").each(function(){$(this).remove()});var a=y.room_types;p.api().clear();for(var t=0;t<a.length;t++)p.api().row.add(['<label class="mt-checkbox mt-checkbox-single mt-checkbox-outline"><input type="checkbox" class="checkboxes" value="1" /><span></span></label>',a[t].id,a[t].code,a[t].name]).draw(!1);$("#modal-complements :input[name=count-room-type]").val(a.length),p.api().columns.adjust().draw()});var o=!1;$("#table tbody").on("click",".dt-delete",function(e){if(!o){var a=D.row($(this).parents("tr")).data();$(this).confirmation("show"),$(this).on("confirmed.bs.confirmation",function(){o=!0,$.ajax({url:routeDelete,type:"POST",data:{id:a.id},beforeSend:function(){App.showMask(!0,$("#table"))},complete:function(e,a){if(o=!1,App.showMask(!1,$("#table")),"419"==e.status)location.reload(!0);else if("200"!=e.status)toastr.error("Please check your connection and try again.","Error on loading the content");else{var t=$.parseJSON(e.responseText);"success"==t.status?(toastr.success(t.message,"Success"),D.draw()):toastr.error(t.message,"Error")}}})})}e.preventDefault()});var n=!1;$("#table-offer tbody").on("click",".dt-delete",function(e){if(!n){var a=R.row($(this).parents("tr")).data();$(this).confirmation("show"),$(this).on("confirmed.bs.confirmation",function(){n=!0,$.ajax({url:routeDeleteOffer,type:"POST",data:{id:a.id},beforeSend:function(){App.showMask(!0,$("#table-offer"))},complete:function(e,a){if(n=!1,App.showMask(!1,$("#table-offer")),"419"==e.status)location.reload(!0);else if("200"!=e.status)toastr.error("Please check your connection and try again.","Error on loading the content");else{var t=$.parseJSON(e.responseText);"success"==t.status?(toastr.success(t.message,"Success"),R.draw()):toastr.error(t.message,"Error")}}})})}e.preventDefault()}),$(".cancel-form").on("click",function(e){r&&(D.draw(),r=!1)}),$(".cancel-form-offer").on("click",function(e){d&&(R.draw(),d=!1)}),$(".btn-search-reset").on("click",function(e){e.preventDefault(),$("#search-section :input[name=name]").val(""),$("#search-section :input[name=hotel]").val(""),$("#search-section :input[name=active]").val(""),$("#search-section :input[name=valid-from]").val(""),$("#search-section :input[name=valid-to]").val(""),$("#search-section :input[name=location]").val("")}),$(".btn-search-cancel").on("click",function(e){e.preventDefault(),$("#search-section").slideToggle()}),$(".btn-search-submit").on("click",function(e){e.preventDefault(),D.columns("name:name").search($("#search-section :input[name=name]").val()).columns("hotel:name").search($("#search-section :input[name=hotel]").val()).columns("valid_from:name").search($("#search-section :input[name=valid-from]").val()).columns("valid_to:name").search($("#search-section :input[name=valid-to]").val()).columns("active:name").search($("#search-section :input[name=active]").val()).columns("location:name").search($("#search-section :input[name=location]").val()).draw()});var v=$("#modal-add .table-pax-type").dataTable({sDom:"t",autoWidth:!1,columnDefs:[{orderable:!1,className:"dt-center",targets:[0],width:"20%"},{visible:!1,targets:[1]}],order:[[3,"asc"]],lengthMenu:[[-1],["All"]]});v.find(".group-checkable").change(function(){var e=jQuery(this).attr("data-set"),a=jQuery(this).is(":checked");jQuery(e).each(function(){a?($(this).prop("checked",!0),$(this).parents("tr").addClass("active")):($(this).prop("checked",!1),$(this).parents("tr").removeClass("active"))}),$("#modal-add :input[name=count-pax-type]").val(g(v))}),v.on("change","tbody tr .checkboxes",function(){$(this).parents("tr").toggleClass("active"),$("#modal-add :input[name=count-pax-type]").val(g(v))});var h=$("#modal-add .table-board-type").dataTable({sDom:"t",columnDefs:[{orderable:!1,className:"dt-center",targets:[0],width:"20%"},{visible:!1,targets:[1]}],order:[[2,"asc"]],autoWidth:!1,lengthMenu:[[-1],["All"]]});h.find(".group-checkable").change(function(){var e=jQuery(this).attr("data-set"),a=jQuery(this).is(":checked");jQuery(e).each(function(){a?($(this).prop("checked",!0),$(this).parents("tr").addClass("active")):($(this).prop("checked",!1),$(this).parents("tr").removeClass("active"))}),$("#modal-add :input[name=count-board-type]").val(g(h))}),h.on("change","tbody tr .checkboxes",function(){$(this).parents("tr").toggleClass("active"),$("#modal-add :input[name=count-board-type]").val(g(h))});var _=$("#modal-add .table-market").dataTable({sDom:"t",columnDefs:[{orderable:!1,className:"dt-center",targets:[0],width:"20%"},{visible:!1,targets:[1]}],order:[[2,"asc"]],autoWidth:!1,lengthMenu:[[-1],["All"]]});_.find(".group-checkable").change(function(){var e=jQuery(this).attr("data-set"),a=jQuery(this).is(":checked");jQuery(e).each(function(){a?($(this).prop("checked",!0),$(this).parents("tr").addClass("active")):($(this).prop("checked",!1),$(this).parents("tr").removeClass("active"))})}),_.on("change","tbody tr .checkboxes",function(){$(this).parents("tr").toggleClass("active")});var b=$("#modal-add .table-room-type").dataTable({sDom:"tip",lengthMenu:[[-1],["All"]],ordering:!1,autoWidth:!1,columnDefs:[{visible:!1,targets:[0]},{targets:[1],width:"35%"}],language:{emptyTable:"No room type selected"},pageLength:10}),Y=$("#modal-info .table-pax-type").dataTable({sDom:"t",columnDefs:[{visible:!1,targets:[0]}],order:[[2,"asc"]],lengthMenu:[[-1],["All"]]}),w=$("#modal-info .table-board-type").dataTable({sDom:"t",columnDefs:[{visible:!1,targets:[0]}],order:[[1,"asc"]],lengthMenu:[[-1],["All"]]}),M=$("#modal-info .table-room-type").dataTable({sDom:"tip",lengthMenu:[[-1],["All"]],order:[[1,"asc"]],autoWidth:!1,columnDefs:[{visible:!1,targets:[0]},{targets:[1],width:"35%"},{orderable:!1,targets:[2]},{orderable:!1,targets:[3]},{orderable:!1,targets:[4]},{orderable:!1,targets:[5]},{orderable:!1,targets:[6]},{orderable:!1,targets:[7]},{orderable:!1,targets:[8]},{orderable:!1,targets:[9]}],language:{emptyTable:"No room type selected"},pageLength:10}),T=$("#modal-edit .table-pax-type").dataTable({sDom:"t",autoWidth:!1,columnDefs:[{orderable:!1,className:"dt-center",targets:[0],width:"20%"},{visible:!1,targets:[1]}],order:[[3,"asc"]],lengthMenu:[[-1],["All"]]});T.find(".group-checkable").change(function(){var e=jQuery(this).attr("data-set"),a=jQuery(this).is(":checked");jQuery(e).each(function(){a?($(this).prop("checked",!0),$(this).parents("tr").addClass("active")):($(this).prop("checked",!1),$(this).parents("tr").removeClass("active"))}),$("#modal-edit :input[name=count-pax-type]").val(g(T))}),T.on("change","tbody tr .checkboxes",function(){$(this).parents("tr").toggleClass("active"),$("#modal-edit :input[name=count-pax-type]").val(g(T))});var A=$("#modal-edit .table-board-type").dataTable({sDom:"t",autoWidth:!1,columnDefs:[{orderable:!1,className:"dt-center",targets:[0],width:"20%"},{visible:!1,targets:[1]}],order:[[2,"asc"]],lengthMenu:[[-1],["All"]]});A.find(".group-checkable").change(function(){var e=jQuery(this).attr("data-set"),a=jQuery(this).is(":checked");jQuery(e).each(function(){a?($(this).prop("checked",!0),$(this).parents("tr").addClass("active")):($(this).prop("checked",!1),$(this).parents("tr").removeClass("active"))}),$("#modal-edit :input[name=count-board-type]").val(g(A))}),A.on("change","tbody tr .checkboxes",function(){$(this).parents("tr").toggleClass("active"),$("#modal-edit :input[name=count-board-type]").val(g(A))});var t=$("#modal-edit .table-measure").dataTable({sDom:"t",autoWidth:!1,columnDefs:[{orderable:!1,className:"dt-center",targets:[0],width:"20%"},{visible:!1,targets:[1]}],order:[[2,"asc"]],lengthMenu:[[-1],["All"]]});t.find(".group-checkable").change(function(){var e=jQuery(this).attr("data-set"),a=jQuery(this).is(":checked");jQuery(e).each(function(){a?($(this).prop("checked",!0),$(this).parents("tr").addClass("active")):($(this).prop("checked",!1),$(this).parents("tr").removeClass("active"))}),$("#modal-edit :input[name=count-measure]").val(g(t))}),t.on("change","tbody tr .checkboxes",function(){$(this).parents("tr").toggleClass("active"),$("#modal-edit :input[name=count-measure]").val(g(t))});var S=$("#modal-edit .table-room-type").dataTable({sDom:"tip",lengthMenu:[[-1],["All"]],ordering:!1,autoWidth:!1,columnDefs:[{visible:!1,targets:[0]},{width:"35%",targets:[1]}],language:{emptyTable:"No room type selected"},pageLength:10});function j(e){return e.loading?e.text:"<div class=''><div class=''>"+e.code+": "+e.name+" (Max Pax: "+e.max_pax+", Min Pax: "+e.min_pax+", Max AD: "+e.max_adult+", Min AD: "+e.min_adult+", Max CH: "+e.max_children+", Min CH: "+e.min_children+", Max INF: "+e.max_infant+", Min INF: "+e.min_infant+")</div></div>"}function C(e){return e.code+": "+e.name}function e(e){return e.loading?e.text:"<div class=''><div class=''>"+e.name+"</div></div>"}function a(e){return e.name}$("#modal-add :input[name=hotel]").select2({width:"off",ajax:{url:routeHotelSearchActive,type:"POST",dataType:"json",delay:250,data:function(e){return{q:e.term,page:e.page}},processResults:function(e,a){return{results:e}},complete:function(e,a){"419"==e.status&&location.reload(!0)},cache:!0},escapeMarkup:function(e){return e},minimumInputLength:3,templateResult:e,templateSelection:a}),$("#modal-add :input[name=hotel]").on("select2:select select2:unselect",function(e){var a=e.params.data;if(a.selected){var t=null!=a.country?a.country.name:"",o=null!=a.state?a.state.name:"",n=null!=a.city?a.city.name:"",i=null!=a.hotel_chain?a.hotel_chain.name:"";$("#modal-add .show-hotel :input[name=hotel-id]").val(a.id),$("#modal-add .show-hotel :input[name=name]").val(a.name),$("#modal-add .show-hotel :input[name=country-text]").val(t),$("#modal-add .show-hotel :input[name=state-text]").val(o),$("#modal-add .show-hotel :input[name=city-text]").val(n),$("#modal-add .show-hotel :input[name=postal-code]").val(a.postal_code),$("#modal-add .show-hotel :input[name=address]").val(a.address),$("#modal-add .show-hotel :input[name=category]").barrating("readonly",!0);var d=null!=a.category?a.category:"";$("#modal-add .show-hotel :input[name=category]").barrating("set",d),$("#modal-add .show-hotel :input[name=hotel-chain]").val(i),$("#modal-add .show-hotel :input[name=admin-phone]").val(a.admin_phone),$("#modal-add .show-hotel :input[name=admin-fax]").val(a.admin_fax),$("#modal-add .show-hotel :input[name=web-site]").val(a.web_site),$("#modal-add .show-hotel :input[name=turistic-licence]").val(a.turistic_licence),$("#modal-add .show-hotel :input[name=email]").val(a.email)}}),$("#modal-add .js-data-ajax").select2({width:"off",ajax:{url:routeRoomTypeSearchActive,type:"POST",dataType:"json",delay:250,data:function(e){return{q:e.term,page:e.page}},processResults:function(e,a){return{results:e}},complete:function(e,a){"419"==e.status&&location.reload(!0)},cache:!0},escapeMarkup:function(e){return e},minimumInputLength:3,templateResult:j,templateSelection:C}),$("#modal-add .js-data-ajax").on("select2:select select2:unselect",function(e){var o=e.params.data;if(o.selected)b.api().row.add([o.id,o.code+": "+o.name,o.max_pax,o.min_pax,o.max_adult,o.min_adult,o.max_children,o.min_children,o.max_infant,o.min_infant]).draw(!1),b.api().columns.adjust().draw();else{var a=!1,t=$(this).val();if(null!=t)for(var n=0;n<t.length;n++)if(t[n]==o.id){a=!0;break}a||b.api().rows(function(e,a,t){return a[0]==o.id}).remove().draw()}$("#modal-add :input[name=count-room-type]").val(b.api().rows().count())}),$("button[data-select2-open]").click(function(){$("#"+$(this).data("select2-open")).select2("open")}),$(".excel").on("click",function(){var e={name:$("#search-section :input[name=name]").val(),hotel:$("#search-section :input[name=hotel]").val(),location:$("#search-section :input[name=location]").val(),validFrom:$("#search-section :input[name=valid-from]").val(),validTo:$("#search-section :input[name=valid-to]").val(),active:$("#search-section :input[name=active]").val()},a=routeExcel+"?"+$.param(e);window.location=a});var i=!1;$("#table tbody").on("click",".dt-duplicate",function(e){if(!i){var a=D.row($(this).parents("tr")).data();$(this).confirmation("show"),$(this).on("confirmed.bs.confirmation",function(){i=!0,$.ajax({url:routeDuplicate,type:"POST",data:{id:a.id},beforeSend:function(){App.showMask(!0,$("#table"))},complete:function(e,a){if(i=!1,App.showMask(!1,$("#table")),"419"==e.status)location.reload(!0);else if("200"!=e.status)toastr.error("Please check your connection and try again.","Error on loading the content");else{var t=$.parseJSON(e.responseText);"success"==t.status?(toastr.success(t.message,"Success"),D.draw()):toastr.error(t.message,"Error")}}})})}e.preventDefault()}),$.fn.dataTable.ext.errMode="none";var R=$("#table-offer").on("error.dt",function(e,a,t,o){}).on("processing.dt",function(e,a,t){App.showMask(t,$(this)),App.reloadToolTips()}).on("init.dt",function(){}).DataTable({processing:!0,serverSide:!0,sDom:"tip",iDisplayLength:10,ajax:{url:routeReadOffer,type:"POST",data:function(e){return e.contractId=null==y?0:y.id,e},complete:function(e,a){"419"==e.status?location.reload(!0):"200"!=e.status&&toastr.error("Please check your connection and try again.","Error on loading the content"),$(".br-readonly").on("click",function(e){e.preventDefault()})}},order:[[1,"asc"]],columns:[{data:"id",name:"id",visible:!1},{data:"name",name:"name",width:"35%"},{data:"type",name:"type",orderable:!1,width:"30%"},{data:"active",name:"active",className:"dt-center",data:function(e,a,t,o){var n='<span><i class="fa fa-close dt-active dt-active-0"></i></span>';return 1==e.active&&(n='<span><i class="fa fa-check dt-active dt-active-1"></i></span>'),n}},{targets:"actions",orderable:!1,name:"actions",className:"dt-center",data:function(e,a,t,o){return'<div class="dt-actions"><a class="btn btn-default btn-circle btn-icon-only btn-action dt-view" data-toggle="modal" href="#modal-info-offer"><i class="glyphicon glyphicon-eye-open btn-action-icon"></i></a><a class="btn btn-default btn-circle btn-icon-only btn-action dt-edit" data-toggle="modal" href="#modal-edit-offer"><i class="icon-pencil btn-action-icon"></i></a><a class="btn btn-default btn-circle btn-icon-only btn-action dt-delete" href="javascript:;" data-popout="true" data-placement="left"data-btn-ok-label="Yes" data-btn-ok-class="btn-sm btn-success"  data-btn-ok-icon-content="check" data-btn-cancel-label="No" data-btn-cancel-class="btn-sm btn-danger" data-btn-cancel-icon-content="close" data-title="Are you sure?" data-content=""><i class="icon-trash btn-action-icon"></i></a></div>'}}]});$("table tbody").on("click",".dt-complements",function(){var e=D.row($(this).parents("tr")).data();y=e.object,$("#modal-complements .contract-name").html(y.name),R.draw()})});