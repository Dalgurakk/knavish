$(document).ready(function(){var r=$("#search-accomodation"),c=null;function o(e){var n=e.hotel_contract.room_types,o=e.hotel_contract.measures,t=e.hotel_contract,a=e.client,r=1==t.active?"Enabled":"Disabled";$("#search-accomodation :input[name=hotel]").val(t.hotel.name),$("#search-accomodation :input[name=status]").val(r),$("#search-accomodation :input[name=client]").val(a.name),$("#search-accomodation :input[name=period]").val(moment(t.valid_from,"YYYY-MM-DD").format("DD.MM.YYYY")+" - "+moment(t.valid_to,"YYYY-MM-DD").format("DD.MM.YYYY")),$(".result-container").html(""),$(".measures-list").html(""),$.each(o,function(e,t){var a='<label class="mt-checkbox mt-checkbox-outline mt-checkbox-row"><input type="checkbox" name="row-selected" checked value="'+o[e].id+'"> '+o[e].name+"<span></span></label>";$(".measures-list").append(a)}),$(".room-types-list").html(""),$.each(n,function(e,t){var a='<label class="mt-checkbox mt-checkbox-outline mt-checkbox-row"><input type="checkbox" name="room-selected" checked value="'+n[e].id+'"> '+n[e].name+"<span></span></label>";$(".room-types-list").append(a)}),$("input[name=from]").datepicker("destroy"),$("input[name=to]").datepicker("destroy"),$(".datepicker-from-container").html(""),$(".datepicker-to-container").html("");var c='<label>From</label><div class="form-group"><div class="input-icon"><i class="fa fa-calendar"></i><input class="form-control datepicker" name="from"> </div></div>';$(".datepicker-from-container").append(c),c='<label>To</label><div class="form-group"><div class="input-icon"><i class="fa fa-calendar"></i><input class="form-control datepicker" name="to"> </div></div>',$(".datepicker-to-container").append(c),$(".datepicker").datepicker({format:"MM yyyy",viewMode:"months",minViewMode:"months",autoclose:!0,orientation:"bottom"});var i=moment(t.valid_from,"YYYY-MM-DD"),s=moment(t.valid_to,"YYYY-MM-DD"),l=moment(),m=l,d=l;l.isSameOrBefore(s)&&l.isSameOrAfter(i)?(m=moment(l).startOf("month"),d=moment(l).endOf("month")):l.isBefore(i)?(m=moment(i).startOf("month"),d=moment(i).endOf("month")):l.isAfter(s)&&(m=moment(s).startOf("month"),d=moment(s).endOf("month")),m.isBefore(i)&&(m=i),d.isAfter(s)&&(d=s),$("input[name=from]").datepicker("setStartDate",new Date(i)),$("input[name=from]").datepicker("setEndDate",new Date(s)),$("input[name=to]").datepicker("setStartDate",new Date(i)),$("input[name=to]").datepicker("setEndDate",new Date(s)),$("input[name=from]").datepicker("setDate",new Date(m)),$("input[name=to]").datepicker("setDate",new Date(d))}$("#search-accomodation :input[name=contract]").select2({width:"off",ajax:{url:routeSearch,type:"POST",dataType:"json",delay:250,data:function(e){return{q:e.term,page:e.page}},processResults:function(e,t){return{results:e}},complete:function(e,t){"419"==e.status&&location.reload(!0)},cache:!0},escapeMarkup:function(e){return e},minimumInputLength:3,templateResult:function(e){return e.loading?e.text:"<div class=''><div class=''>"+e.name+"</div></div>"},templateSelection:function(e){return e.name}}),$("#search-accomodation :input[name=contract]").on("select2:select select2:unselect",function(e){var t=e.params.data;if(t.selected){o(c=t);var a=window.location.href;if(0<a.indexOf("?")){var n=a.substring(0,a.indexOf("?"));window.history.replaceState({},document.title,n)}}}),$.ajax({url:routeContract,type:"POST",data:{contractId:contractId},beforeSend:function(){App.showMask(!0,r)},complete:function(e,t){if(App.showMask(!1,r),"419"==e.status)location.reload(!0);else if("200"!=e.status)toastr.error("Please check your connection and try again.","Error on loading the content");else{var a=JSON.parse(e.responseText);null==(c=a.data)?toastr.warning(a.message,"Warning"):($("#search-accomodation :input[name=contract]").next().find(".select2-selection__rendered").html(c.name+'<span class="select2-selection__placeholder"></span>'),o(c),$(".filter-content").show())}}}),$(".btn-search-submit").on("click",function(e){if(e.preventDefault(),null==c)toastr.error("Invalid contract.","Error");else{var t=moment($("input[name=from]").datepicker("getDate")).format("DD.MM.YYYY"),a=moment($("input[name=to]").datepicker("getDate")).format("DD.MM.YYYY"),n=[];$('[name="room-selected"]:checked').each(function(){n.push($(this).val())});var o=[];$('[name="row-selected"]:checked').each(function(){o.push($(this).val())}),$.ajax({url:routeData,type:"POST",data:{id:c.id,from:t,to:a,rooms:JSON.stringify(n),rows:JSON.stringify(o)},beforeSend:function(){App.showMask(!0,r)},complete:function(e,t){if(App.showMask(!1,r),"419"==e.status)location.reload(!0);else if("200"!=e.status)toastr.error("Please check your connection and try again.","Error on loading the content");else{var a=$.parseJSON(e.responseText);if("success"==a.status){var n=a.table;$(".result-container").html(""),$(".result-container").html('<div class="note note-info"><p>Costing and pricing are all per person per night.</p></div>'),$(".result-container").append(n)}else toastr.error(a.message,"Error")}}})}})});