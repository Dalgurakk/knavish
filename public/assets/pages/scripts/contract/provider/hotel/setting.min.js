$(document).ready(function(){var o=!1,i=$("#search-accomodation"),c=null;function r(e){var n=e.room_types,r=e.measures,o=e.markets,t=e,a=1==t.active?"Enabled":"Disabled";$("#search-accomodation :input[name=hotel]").val(t.hotel.name),$("#search-accomodation :input[name=status]").val(a),$("#search-accomodation :input[name=period]").val(moment(t.valid_from,"YYYY-MM-DD").format("DD.MM.YYYY")+" - "+moment(t.valid_to,"YYYY-MM-DD").format("DD.MM.YYYY")),$(".result-container").html(""),$(".measures-list").html(""),$.each(r,function(e,t){var a='<label class="mt-checkbox mt-checkbox-outline mt-checkbox-row"><input type="checkbox" name="row-selected" checked value="'+r[e].id+'"> '+r[e].name+"<span></span></label>";$(".measures-list").append(a)}),$("#market").empty(),$.each(o,function(e,t){var a=(o[e].id,o[e].name);a='<option value="'+o[e].id+'"> '+o[e].name+"</option>";$("#market").append(a)}),$(".room-types-list").html(""),$.each(n,function(e,t){var a='<label class="mt-checkbox mt-checkbox-outline mt-checkbox-row"><input type="checkbox" name="room-selected" checked value="'+n[e].id+'"> '+n[e].name+"<span></span></label>";$(".room-types-list").append(a)}),$("input[name=from]").datepicker("destroy"),$("input[name=to]").datepicker("destroy"),$(".datepicker-from-container").html(""),$(".datepicker-to-container").html("");var s='<label>From</label><div class="form-group"><div class="input-icon"><i class="fa fa-calendar"></i><input class="form-control datepicker" name="from"> </div></div>';$(".datepicker-from-container").append(s),s='<label>To</label><div class="form-group"><div class="input-icon"><i class="fa fa-calendar"></i><input class="form-control datepicker" name="to"> </div></div>',$(".datepicker-to-container").append(s),$(".datepicker").datepicker({format:"MM yyyy",viewMode:"months",minViewMode:"months",autoclose:!0,orientation:"bottom"});var i=moment(t.valid_from,"YYYY-MM-DD"),c=moment(t.valid_to,"YYYY-MM-DD"),m=moment();if(m.isSameOrBefore(c)&&m.isSameOrAfter(i)){var d=moment(m).startOf("month"),l=moment(m).endOf("month");$("input[name=from]").datepicker("setDate",new Date(d)),$("input[name=to]").datepicker("setDate",new Date(l))}else if(m.isBefore(i)){d=moment(i).startOf("month"),l=moment(i).endOf("month");$("input[name=from]").datepicker("setDate",new Date(d)),$("input[name=to]").datepicker("setDate",new Date(l))}else if(m.isAfter(c)){d=moment(c).startOf("month"),l=moment(c).endOf("month");$("input[name=from]").datepicker("setDate",new Date(d)),$("input[name=to]").datepicker("setDate",new Date(l))}$("input[name=from]").datepicker("setStartDate",new Date(i)),$("input[name=from]").datepicker("setEndDate",new Date(c)),$("input[name=to]").datepicker("setStartDate",new Date(i)),$("input[name=to]").datepicker("setEndDate",new Date(c)),$("#modal-setting :input[name=setting-from]").datepicker("setStartDate",new Date(i)),$("#modal-setting :input[name=setting-from]").datepicker("setEndDate",new Date(c)),$("#modal-setting :input[name=setting-to]").datepicker("setStartDate",new Date(i)),$("#modal-setting :input[name=setting-to]").datepicker("setEndDate",new Date(c)),$(".measures-container").html("");for(var p=0;p<t.measures.length;p++){s='<div class="row"><div class="col-md-12"><div class="col-md-6 col-sm-6 col-xs-6"><div class="form-group"><label>'+t.measures[p].name+'</label><input type="text" class="form-control" name="'+t.measures[p].code+'" readonly></div></div><div class="col-md-6 col-sm-6 col-xs-6"><div class="mt-checkbox-list"><label class="mt-checkbox mt-checkbox-outline no-margin-bottom margin-top-15"> Set<input type="checkbox" value="" name="set-'+t.measures[p].code+'" data-set="'+t.measures[p].code+'" data-measure-id="'+t.measures[p].id+'" /><span></span></label></div></div></div></div>';$(".measures-container").append(s),$('input[name="set-'+t.measures[p].code+'"]').change(function(){var e=$(this).attr("data-set");$(this).is(":checked")?($("input[name="+e+"]").prop("readonly",""),$(this).val($(this).attr("data-measure-id"))):($(this).val("0"),$("input[name="+e+"]").prop("readonly",!0))})}}$(".date-picker").datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0,format:"dd.mm.yyyy",orientation:"bottom"}),$("#search-accomodation :input[name=contract]").select2({width:"off",ajax:{url:routeSearch,type:"POST",dataType:"json",delay:250,data:function(e){return{q:e.term,page:e.page}},processResults:function(e,t){return{results:e}},cache:!0},escapeMarkup:function(e){return e},minimumInputLength:3,templateResult:function(e){return e.loading?e.text:"<div class=''><div class=''>"+e.name+"</div></div>"},templateSelection:function(e){return e.name}}),$("#search-accomodation :input[name=contract]").on("select2:select select2:unselect",function(e){var t=e.params.data;if(t.selected){r(c=t);var a=window.location.href;if(0<a.indexOf("?")){var n=a.substring(0,a.indexOf("?"));window.history.replaceState({},document.title,n)}}}),$.ajax({url:routeContract,type:"POST",data:{contractId:contractId},beforeSend:function(){App.showMask(!0,i)},complete:function(e,t){if(App.showMask(!1,i),"200"!=e.status)toastr.error("Please check your connection and try again.","Error on loading the content");else{var a=JSON.parse(e.responseText);null==(c=a.data)?toastr.warning(a.message,"Warning"):($("#search-accomodation :input[name=contract]").next().find(".select2-selection__rendered").html(c.name+'<span class="select2-selection__placeholder"></span>'),r(c),$(".filter-content").show())}}}),$(".btn-search-submit").on("click",function(e){if(e.preventDefault(),null==c)toastr.error("Invalid contract.","Error");else{var t=moment($("input[name=from]").datepicker("getDate")).format("DD.MM.YYYY"),a=moment($("input[name=to]").datepicker("getDate")).format("DD.MM.YYYY"),n=$("#market").val(),r=[];$('[name="room-selected"]:checked').each(function(){r.push($(this).val())});var o=[];$('[name="row-selected"]:checked').each(function(){o.push($(this).val())}),$.ajax({url:routeData,type:"POST",data:{id:c.id,from:t,to:a,market:n,rooms:JSON.stringify(r),rows:JSON.stringify(o)},beforeSend:function(){App.showMask(!0,i)},complete:function(e,t){if(App.showMask(!1,i),"200"!=e.status)toastr.error("Please check your connection and try again.","Error on loading the content");else{var a=$.parseJSON(e.responseText);if("success"==a.status){var n=a.table;$(".result-container").html(""),$(".result-container").append(n),a.from,a.to,s=c,$(".item-setting").on("click",function(){m.validate().resetForm(),m[0].reset();var e=$(this).parents("table").find("th:first").html();$("#modal-setting .room-name-header").html(e);var t=$(this).attr("data-date");$("#modal-setting :input[name=setting-from]").datepicker("setDate",new Date(moment(t,"YYYY-MM-DD"))),$("#modal-setting :input[name=setting-to]").datepicker("setDate",new Date(moment(t,"YYYY-MM-DD"))),$("#modal-setting .measures-container :input").prop("readonly",!0),$("#modal-setting .measures-container :input").prop("checked","");var a=$(this).parents("tr").find("td:first").attr("data-measure-code");$("#modal-setting :input[name="+a+"]").prop("readonly",!1),$("#modal-setting :input[data-set="+a+"]").prop("checked","checked"),$("#modal-setting :input[data-set="+a+"]").val($("#modal-setting :input[data-set="+a+"]").attr("data-measure-id")),$("#modal-setting :input[name=contract-id]").val(s.id),$("#modal-setting :input[name=room-type-id]").val($(this).attr("data-room-type-id")),$("#modal-setting :input[name=market-id]").val($(this).attr("data-market-id"));for(var n=0;n<s.measures.length;n++){var t=$(this).attr("data-date"),r=s.measures[n].id,o=$(this).parents("table").find('td[data-date="'+t+'"][data-measure-id="'+r+'"]').html();$('#modal-setting :input[name="'+s.measures[n].code+'"]').val(o)}$("#modal-setting").modal("show")})}else toastr.error(a.message,"Error")}var s}})}});var m=$("#form-add");m.validate({errorElement:"span",errorClass:"help-block help-block-error",focusInvalid:!1,ignore:"",rules:{cost:{required:!0},"setting-from":{required:!0},"setting-to":{required:!0}},errorPlacement:function(e,t){0<t.parents(".mt-radio-list").size()||0<t.parents(".mt-checkbox-list").size()?(0<t.parents(".mt-radio-list").size()&&e.appendTo(t.parents(".mt-radio-list")[0]),0<t.parents(".mt-checkbox-list").size()&&e.appendTo(t.parents(".mt-checkbox-list")[0])):0<t.parents(".mt-radio-inline").size()||0<t.parents(".mt-checkbox-inline").size()?(0<t.parents(".mt-radio-inline").size()&&e.appendTo(t.parents(".mt-radio-inline")[0]),0<t.parents(".mt-checkbox-inline").size()&&e.appendTo(t.parents(".mt-checkbox-inline")[0])):0<t.parent(".input-group").size()?e.insertAfter(t.parent(".input-group")):t.attr("data-error-container")?e.appendTo(t.attr("data-error-container")):e.insertAfter(t)},invalidHandler:function(e,t){toastr.error("Please check the entry fields.","Error")},highlight:function(e){$(e).closest(".form-group").addClass("has-error")},unhighlight:function(e){$(e).closest(".form-group").removeClass("has-error")},success:function(e){e.closest(".form-group").removeClass("has-error")},submitHandler:function(n){var r=$(n).find("button[type=submit]:focus").attr("data");$.ajax({url:routeSave,type:"POST",data:m.serialize(),beforeSend:function(){App.showMask(!0,m)},complete:function(e,t){if(App.showMask(!1,m),"200"!=e.status)toastr.error("Please check your connection and try again.","Error on loading the content");else{var a=$.parseJSON(e.responseText);"success"==a.status?(toastr.success(a.message,"Success"),m[0].reset(),o=!0,"accept"==r&&$(n).find("button.cancel-form").click()):toastr.error(a.message,"Error")}}})}}),$(".cancel-form").on("click",function(e){o&&($(".btn-search-submit").click(),o=!1)})});