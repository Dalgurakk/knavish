$(document).ready(function(){var c=!1,r=$("#search-accomodation"),s=null,l=!1;$("#modal-setting :input[name=setting-from]").datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0,format:"dd.mm.yyyy",orientation:"bottom"}).on("changeDate",function(e){var t=$(this).val(),a=$("#modal-setting :input[name=setting-to]").val(),n=moment(t,"DD.MM.YYYY"),o=moment(a,"DD.MM.YYYY");0!=t&&""!=t&&moment(o).isBefore(n)&&$("#modal-setting :input[name=setting-to]").datepicker("setDate",new Date(moment(t,"DD.MM.YYYY")))}),$("#modal-setting :input[name=setting-to]").datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0,format:"dd.mm.yyyy",orientation:"bottom"}).on("changeDate",function(e){var t=$(this).val(),a=$('input[name="setting-from"]').val(),n=moment(a,"DD.MM.YYYY"),o=moment(t,"DD.MM.YYYY");0!=a&&""!=a&&moment(o).isBefore(n)&&$('input[name="setting-from"]').datepicker("setDate",new Date(moment(t,"DD.MM.YYYY")))}),$("#modal-import :input[name=import-from]").datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0,format:"dd.mm.yyyy",orientation:"bottom"}).on("changeDate",function(e){var t=$(this).val(),a=$("#modal-import :input[name=import-to]").val(),n=moment(t,"DD.MM.YYYY"),o=moment(a,"DD.MM.YYYY");0!=t&&""!=t&&moment(o).isBefore(n)&&$("#modal-import :input[name=import-to]").datepicker("setDate",new Date(moment(t,"DD.MM.YYYY")))}),$("#modal-import :input[name=import-to]").datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0,format:"dd.mm.yyyy",orientation:"bottom"}).on("changeDate",function(e){var t=$(this).val(),a=$('input[name="import-from"]').val(),n=moment(a,"DD.MM.YYYY"),o=moment(t,"DD.MM.YYYY");0!=a&&""!=a&&moment(o).isBefore(n)&&$('input[name="import-from"]').datepicker("setDate",new Date(moment(t,"DD.MM.YYYY")))}),$("#search-accomodation :input[name=contract]").select2({width:"off",ajax:{url:routeSearch,type:"POST",dataType:"json",delay:250,data:function(e){return{q:e.term,page:e.page}},processResults:function(e,t){return{results:e}},complete:function(e,t){"419"==e.status&&location.reload(!0)},cache:!0},escapeMarkup:function(e){return e},minimumInputLength:3,templateResult:function(e){return e.loading?e.text:"<div class=''><div class=''>"+e.name+"</div></div>"},templateSelection:function(e){return e.name}}),$("#search-accomodation :input[name=contract]").on("select2:select select2:unselect",function(e){var t=e.params.data;if(t.selected){l=!1,o(s=t);var a=window.location.href;if(0<a.indexOf("?")){var n=a.substring(0,a.indexOf("?"));window.history.replaceState({},document.title,n)}}}),$.ajax({url:routeContract,type:"POST",data:{contractId:contractId},beforeSend:function(){App.showMask(!0,r)},complete:function(e,t){if(App.showMask(!1,r),"419"==e.status)location.reload(!0);else if("200"!=e.status)toastr.error("Please check your connection and try again.","Error on loading the content");else{var a=JSON.parse(e.responseText);null==(s=a.data)?toastr.warning(a.message,"Warning"):($("#search-accomodation :input[name=contract]").next().find(".select2-selection__rendered").html(s.name+'<span class="select2-selection__placeholder"></span>'),o(s),$(".filter-content").show())}}}),$(".btn-import").on("click",function(e){e.preventDefault(),s.markets.length<=1?toastr.info("There are no price rates available to import.","Information"):swal({title:"Confirmation",text:"Are you sure you want to import the costs from the "+$("#import-cost-from-rate option:selected").text()+" price rate to the "+$("#market option:selected").text()+" price rate?",type:null,allowOutsideClick:!1,showConfirmButton:!0,showCancelButton:!0,confirmButtonClass:"green",cancelButtonClass:"red",closeOnConfirm:!0,closeOnCancel:!0,confirmButtonText:"Accept",cancelButtonText:"Cancel"},function(e){e&&$.ajax({url:routeImportCostFromPriceRate,type:"POST",data:{"contract-id":s.id,"price-rate-from":$("#import-cost-from-rate").val(),"price-rate-to":$("#market").val()},beforeSend:function(){App.showMask(!0,r)},complete:function(e,t){if(App.showMask(!1,r),"419"==e.status)location.reload(!0);else if("200"!=e.status)toastr.error("Please check your connection and try again.","Error on loading the content");else{var a=$.parseJSON(e.responseText);"success"==a.status?($(".btn-search-submit").click(),toastr.success(a.message,"Success")):"warning"==a.status?toastr.warning(a.message,"Warning"):toastr.error(a.message,"Error")}}})})}),$(".btn-search-submit").on("click",function(e){if(e.preventDefault(),null==s)toastr.error("Invalid contract.","Error");else{var t=moment($("input[name=from]").datepicker("getDate")).format("DD.MM.YYYY"),a=moment($("input[name=to]").datepicker("getDate")).format("DD.MM.YYYY"),n=$("#market").val(),o=[];$('[name="room-selected"]:checked').each(function(){o.push($(this).val())});var i=[];$('[name="row-selected"]:checked').each(function(){i.push($(this).val())}),$.ajax({url:routeData,type:"POST",data:{id:s.id,from:t,to:a,market:n,rooms:JSON.stringify(o),rows:JSON.stringify(i)},beforeSend:function(){App.showMask(!0,r)},complete:function(e,t){if(App.showMask(!1,r),"419"==e.status)location.reload(!0);else if("200"!=e.status)toastr.error("Please check your connection and try again.","Error on loading the content");else{l=!0;var a=$.parseJSON(e.responseText);if("success"==a.status){var n=a.table;$(".result-container").html(""),$(".result-container").html('<div class="note note-info"><p>Costing and pricing are all per person per night.</p></div>'),$(".result-container").append(n),a.from,a.to,D=(b=s).room_types,$(".item-setting").on("click",function(){$('input[name^="cost"]').each(function(e){$(this).rules("remove","required")}),$('input[name^="price"]').each(function(e){$(this).rules("remove","required")}),$('input[name^="allotment"]').each(function(e){$(this).rules("remove","required")}),$('input[name^="release"]').each(function(e){$(this).rules("remove","required")}),$('input[name^="stop_sale"]').each(function(e){$(this).rules("remove","required")}),$("#modal-setting .expand").each(function(){$(this).click()});var e=$(this).attr("data-room-type-id");$("#modal-setting :input[name=room-type-id]").val(e);for(var a=null,t=b.measures,n=0;n<D.length;n++)if(D[n].id==e){a=D[n];break}$(".measures-container").html("");for(var o=0;o<t.length;o++)if("cost"==t[o].code){var i='<div class="row"><div class="col-md-12"><div class="col-md-5 col-sm-5 col-xs-5"><div class="form-group"><label>'+t[o].name+' Adult</label><input type="text" class="form-control measure-input" name="'+t[o].code+'" readonly></div></div><div class="col-md-7 col-sm-7 col-xs-7"><div class="mt-checkbox-inline"><label class="mt-checkbox mt-checkbox-outline no-margin-bottom margin-top-15 margin-right-40"> Set<input type="checkbox" class="set" value="1" name="set-'+t[o].code+'" data-set="'+t[o].code+'" data-measure-id="'+t[o].id+'" /><span></span></label><label class="mt-checkbox mt-checkbox-outline no-margin-bottom margin-top-15 margin-right-40"> Unset<input type="checkbox" class="set" value="0" name="unset-cost" /><span></span></label><label class="mt-checkbox mt-checkbox-outline no-margin-bottom margin-top-15"> Import<input type="checkbox" class="set" value="0" name="import-cost" /><span></span></label></div></div></div></div>';if($(".measures-container").append(i),null!=a&&0<a.max_children&&a.max_children<=3)for(var n=1;n<=a.max_children;n++){var r='<div class="row"><div class="col-md-12"><div class="col-md-5 col-sm-5 col-xs-5"><div class="form-group"><label>'+t[o].name+" Children "+n+'</label><input type="text" class="form-control measure-input" name="'+t[o].code+"_children_"+n+'" readonly></div></div><div class="col-md-7 col-sm-7 col-xs-7 label_contentainer" style="display: none;"><div class="mt-checkbox-inline"><label class="mt-checkbox mt-checkbox-outline no-margin-bottom margin-top-15 margin-right-40"><p class="label_'+t[o].code+"_children_"+n+'">From Adult</p><input type="checkbox" class="set use-adult" value="1" name="use-adult-'+t[o].code+"_children_"+n+'" data-set="'+t[o].code+"_children_"+n+'"/><span></span></label><input type="hidden" value="" name="use-adult-rate-'+t[o].code+"_children_"+n+'" data-set="'+t[o].code+"_children_"+n+'" data-type="rate"/><input type="hidden" value="" name="use-adult-type-'+t[o].code+"_children_"+n+'" data-set="'+t[o].code+"_children_"+n+'" data-type="type"/></div></div></div></div>';$(".measures-container").append(r)}$("input[name=import-cost]").change(function(){if($(this).is(":checked")){$('input[name="set-cost"]').prop("checked",""),$('input[name="unset-cost"]').prop("checked",""),M.validate().resetForm(),M[0].reset();var e=b.valid_from,t=b.valid_to;$("#modal-import :input[name=import-from]").datepicker("setDate",new Date(moment(e,"YYYY-MM-DD"))),$("#modal-import :input[name=import-to]").datepicker("setDate",new Date(moment(t,"YYYY-MM-DD"))),$("#modal-import .room-name-header").html(a.code+": "+a.name),$("input[name=add-value]").prop("checked",""),$('input[name="rate_fee_value"]').attr("disabled","disabled").val(""),$('input[name="rate_percent_value"]').attr("disabled","disabled").val(""),$('input[data-target="rate_fee_value"]').prop("checked",!0).attr("disabled","disabled"),$('input[data-target="rate_percent_value"]').attr("disabled","disabled"),$(".add-value-container").hide(),$("#modal-import .range-optional").each(function(){$(this).remove()}),$("#modal-import .expand").each(function(){$(this).click()}),$("#modal-import").modal("show")}}),$(".use-adult").on("click",function(e){e.preventDefault();var t=$(this).attr("data-set");$(".from-adult-content").html("");for(var a=$("#modal-setting :input[name=room-type-id]").val(),n=b.room_types,o=null,i=0;i<n.length;i++)if(a==n[i].id){o=n[i];break}for(var i=1;i<=o.max_children;i++){var r="";1<i&&(r="<hr>"),r+='<div class="children-setting" style="margin-bottom: 10px;margin-top: 10px;"><div class="row"><div class="col-md-12"><div class="row"><div class="col-md-12"><label class=""> Cost Children '+i+'</label></div></div></div><div class="col-md-12" style="margin-top: 10px;"><div class="row" style="margin-top: 5px;"><div class="col-md-4"><div class="form-group"><label>Rate</label><input type="text" class="form-control use-adult-input-rate" name="cost_children_'+i+'_rate"></div></div><div class="col-md-4"><label>Type</label><div class="form-group"><select class="form-control" name="cost_children_'+i+'_type" id="cost_children_'+i+'_type"><option value="1">Percent</option><option value="2">Fee</option></select></div></div><div class="col-md-4"><label class="mt-checkbox mt-checkbox-outline no-margin-bottom" style="width: 100%; margin-top: 24px;"> Enable<input class="active-use-adult" type="checkbox" value="1" name="cost_children_'+i+'_active" data-set="cost_children_'+i+'"/><span></span></label></div></div></div></div></div>',$(".from-adult-content").append(r),$('input[name="cost_children_'+i+'_active"]').on("click",function(){var e=$(this).attr("data-set");$(this).prop("checked")?$('input[name="'+e+'_rate"]').rules("add","required"):$('input[name="'+e+'_rate"]').rules("remove","required")})}$(".use-adult").each(function(){$(".active-use-adult").each(function(){var e=$(this).attr("data-set");$('input[name="'+e+'_rate"]').rules("remove","required"),$('input[name="'+e+'_active"]').rules("remove","required")});var e=$(this).attr("data-set"),t=$('[data-set="'+e+'"][data-type="rate"]').val(),a=$('[data-set="'+e+'"][data-type="type"]').val();""!=t&&""!=a&&($('input[name="'+e+'_rate"]').val(t),$("#"+e+"_type").val(a),$('input[name="'+e+'_active"]').prop("checked",!0))}),$('input[name="'+t+'_rate"]').rules("add","required"),$('input[name="'+t+'_active"]').prop("checked",!0),$("#modal-use-adult").modal("show")}),$(".cancel-import").on("click",function(e){$('input[name="import-cost"]').prop("checked",""),$('input[name="import-cost"]').val(0)})}else if("price"==t[o].code){var i='<div class="row"><div class="col-md-12"><div class="col-md-5 col-sm-5 col-xs-5"><div class="form-group"><label>'+t[o].name+' Adult</label><input type="text" class="form-control measure-input" name="'+t[o].code+'" readonly></div></div><div class="col-md-7 col-sm-7 col-xs-7"><div class="mt-checkbox-inline"><label class="mt-checkbox mt-checkbox-outline no-margin-bottom margin-top-15 margin-right-40"> Set<input type="checkbox" class="set" value="1" name="set-'+t[o].code+'" data-set="'+t[o].code+'" data-measure-id="'+t[o].id+'" /><span></span></label></div></div></div></div>';if($(".measures-container").append(i),null!=a&&0<a.max_children&&a.max_children<=3)for(var n=1;n<=a.max_children;n++){var r='<div class="row"><div class="col-md-12"><div class="col-md-5 col-sm-5 col-xs-5"><div class="form-group"><label>'+t[o].name+" Children "+n+'</label><input type="text" class="form-control measure-input" name="'+t[o].code+"_children_"+n+'" readonly></div></div></div></div>';$(".measures-container").append(r)}}else if("stop_sale"==t[o].code){var i='<div class="row"><div class="col-md-12"><div class="col-md-5 col-sm-5 col-xs-5"><div class="form-group"><label>'+t[o].name+'</label><select id="select-stop-sale" class="form-control measure-input" name="'+t[o].code+'" readonly="" disabled="disabled"><option value="0">No</option><option value="1">Yes</option></select></div></div><div class="col-md-7 col-sm-7 col-xs-7"><div class="mt-checkbox-inline"><label class="mt-checkbox mt-checkbox-outline no-margin-bottom margin-top-15 margin-right-40"> Set<input type="checkbox" class="set" value="" name="set-'+t[o].code+'" data-set="'+t[o].code+'" data-measure-id="'+t[o].id+'" /><span></span></label></div></div></div></div>';$(".measures-container").append(i),$("#select-stop-sale").val(0).change(),$('input[name="set-'+t[o].code+'"]').change(function(){var e=$(this).attr("data-set");$(this).is(":checked")?($("#select-stop-sale").removeAttr("readonly",""),$('input[name="unset-'+e+'"]').prop("checked",""),$("#select-stop-sale").removeAttr("disabled"),$(this).val(1)):($("#select-stop-sale").attr("readonly",!0),$("#select-stop-sale").attr("disabled","disabled"))}),$('input[name="unset-'+t[o].code+'"]').change(function(){var e=$(this).attr("data-unset");$(this).is(":checked")?($("input[name="+e+"]").prop("readonly",!0),$('input[name="set-'+e+'"]').prop("checked",""),$(this).val($(this).attr("data-measure-id")),$("#select-stop-sale").attr("disabled","disabled")):$(this).val("0")})}else{var i='<div class="row"><div class="col-md-12"><div class="col-md-5 col-sm-5 col-xs-5"><div class="form-group"><label>'+t[o].name+'</label><input type="text" class="form-control measure-input" name="'+t[o].code+'" readonly></div></div><div class="col-md-7 col-sm-7 col-xs-7"><div class="mt-checkbox-inline"><label class="mt-checkbox mt-checkbox-outline no-margin-bottom margin-top-15 margin-right-40"> Set<input type="checkbox" class="set" value="" name="set-'+t[o].code+'" data-set="'+t[o].code+'" data-measure-id="'+t[o].id+'" /><span></span></label><label class="mt-checkbox mt-checkbox-outline no-margin-bottom margin-top-15 margin-right-30"> Unset<input type="checkbox" class="set" value="0" name="unset-'+t[o].code+'" data-unset="'+t[o].code+'" data-measure-id="'+t[o].id+'"/><span></span></label></div></div></div></div>';$(".measures-container").append(i),$('input[name="set-'+t[o].code+'"]').change(function(){var e=$(this).attr("data-set");$(this).is(":checked")?($("input[name="+e+"]").prop("readonly",""),$("input[name="+e+"]").rules("add","required"),$(this).val($(this).attr("data-measure-id")),$('input[name="unset-'+e+'"]').prop("checked",""),$(this).val(1)):($("input[name="+e+"]").prop("readonly",!0),$("input[name="+e+"]").rules("remove","required"))}),$('input[name="unset-'+t[o].code+'"]').change(function(){var e=$(this).attr("data-unset");$(this).is(":checked")?($("input[name="+e+"]").prop("readonly",!0),$("input[name="+e+"]").rules("remove","required"),$('input[name="set-'+e+'"]').prop("checked",""),$(this).val($(this).attr("data-measure-id"))):$(this).val("0")})}$('input[name="set-cost"]').change(function(){$(this).is(":checked")?($('input[name^="cost"]').each(function(e){$(this).rules("add","required");var t=$(this).attr("name");0!=$('.use-adult[data-set="'+t+'"]').prop("checked")&&"cost"!=t||$(this).prop("readonly","")}),$(".label_contentainer").show()):($('input[name^="cost"]').each(function(e){$(this).rules("remove","required"),$(this).prop("readonly",!0)}),$(".label_contentainer").hide()),$('input[name="unset-cost"]').prop("checked",""),$('input[name="import-cost"]').prop("checked","")}),$('input[name="unset-cost"]').change(function(){$(this).is(":checked")&&($('input[name^="cost"]').each(function(e){$(this).rules("remove","required"),$(this).prop("readonly",!0),$('input[name="set-price"]').prop("checked",""),$("input[name=set-cost]").prop("checked",""),$('input[name="import-cost"]').prop("checked","")}),$('input[name^="price"]').each(function(e){$(this).rules("remove","required"),$(this).prop("readonly",!0)}),$(".label_contentainer").hide())}),$('input[name="set-price"]').change(function(){$(this).is(":checked")?($('input[name^="cost"]').each(function(e){$(this).rules("add","required")}),$('input[name^="price"]').each(function(e){$(this).rules("add","required"),$(this).prop("readonly","")})):$('input[name^="price"]').each(function(e){$(this).rules("remove","required"),$(this).prop("readonly",!0)})}),_.validate(),_.validate().resetForm(),_[0].reset(),$("#modal-setting .room-name-header").html(a.code+": "+a.name);var s=$(this).attr("data-date");$("#modal-setting :input[name=setting-from]").datepicker("setDate",new Date(moment(s,"YYYY-MM-DD"))),$("#modal-setting :input[name=setting-to]").datepicker("setDate",new Date(moment(s,"YYYY-MM-DD"))),$("#modal-setting .measures-container :input").prop("readonly",!0),$("#modal-setting .measures-container :input").prop("checked","");var c=$(this).parents("tr").find("td:first").attr("data-measure-code");"cost"==c.substr(0,4)?$("#modal-setting :input[data-set=cost]").click():"price"==c.substr(0,5)?$("#modal-setting :input[data-set=price]").click():$("#modal-setting :input[data-set="+c+"]").click(),$("#modal-setting :input[name=contract-id]").val(b.id),$("#modal-setting :input[name=market-id]").val($(this).attr("data-market-id"));var t=b.measures;if(0<a.max_children&&a.max_children<3){var l=t;t=[];for(var o=0;o<l.length;o++)if(t.push(l[o]),"cost"==l[o].code)for(var n=1;n<=a.max_children;n++){var m={id:1e3+n,name:"Cost CH "+n,active:1,code:"cost_children_"+n};t.push(m)}else if("price"==l[o].code)for(var n=1;n<=a.max_children;n++){var m={id:2e3+n,name:"Price CH "+n,active:1,code:"price_children_"+n};t.push(m)}}for(var o=0;o<t.length;o++){var s=$(this).attr("data-date"),d=t[o].id,p=$(this).parents("table").find('td[data-date="'+s+'"][data-measure-id="'+d+'"]'),u=p.attr("data"),h=p.attr("data-measure-code");if("cost_children_1"==h||"cost_children_2"==h||"cost_children_3"==h){var v=p.attr("data-use-adult-type"),f=p.attr("data-use-adult-rate"),g="";g=1==v?"("+f+"%)":"($"+f+")",""!=v&&($('.use-adult[data-set="'+h+'"]').prop("checked",!0),$(".label_"+h).html("From Adult "+g),$('[data-set="'+h+'"][data-type="rate"]').val(f),$('[data-set="'+h+'"][data-type="type"]').val(v),$('input[name="'+h+'"]').prop("readonly",!0),$('input[name="'+h+'"]').rules("remove","required"))}if("stop_sale"==t[o].code){var k=1==u?1:0;$("#select-stop-sale").val(k).change()}else $('#modal-setting :input[name="'+t[o].code+'"]').val(u)}$("#modal-setting .range-optional").each(function(){$(this).remove()}),Y(b.markets),y(),x(b.room_types),$("#modal-setting").modal("show")})}else toastr.error(a.message,"Error")}var b,D}})}});var m=$("#modal-setting .table-room-type").dataTable({sDom:"tip",autoWidth:!1,columnDefs:[{orderable:!1,className:"dt-center",targets:[0],width:"20%"},{visible:!1,targets:[1]}],order:[[3,"asc"]],lengthMenu:[[-1],["All"]],pageLength:10});function o(e){var o=e.room_types,n=e.measures,i=e.markets,t=e,a=null!=t.hotel.hotel_chain?t.hotel.hotel_chain.name:"",r=1==t.active?"Enabled":"Disabled";$("#search-accomodation :input[name=hotel]").val(t.hotel.name),$("#search-accomodation :input[name=hotel-chain]").val(a),$("#search-accomodation :input[name=status]").val(r),$("#search-accomodation :input[name=period]").val(moment(t.valid_from,"YYYY-MM-DD").format("DD.MM.YYYY")+" - "+moment(t.valid_to,"YYYY-MM-DD").format("DD.MM.YYYY")),$(".result-container").html(""),$(".measures-list").html(""),$.each(n,function(e,t){var a='<label class="mt-checkbox mt-checkbox-outline mt-checkbox-row"><input type="checkbox" name="row-selected" checked value="'+n[e].id+'"> '+n[e].name+"<span></span></label>";$(".measures-list").append(a)}),$("#market").empty(),$.each(i,function(e,t){var a='<option value="'+i[e].id+'"> '+i[e].name+"</option>";$("#market").append(a)}),Y(i),$(".room-types-list").html(""),$('#modal-change :input[name="change-room"]').empty(),$.each(o,function(e,t){var a='<label class="mt-checkbox mt-checkbox-outline mt-checkbox-row"><input type="checkbox" name="room-selected" checked value="'+o[e].id+'"> '+o[e].name+"<span></span></label>";$(".room-types-list").append(a);var n='<option value="'+o[e].id+'" data-name="'+o[e].name+'"> '+o[e].code+": "+o[e].name+" (Max Pax: "+o[e].max_pax+", Min Pax: "+o[e].min_pax+", Max AD: "+o[e].max_adult+", Min AD: "+o[e].min_adult+", Max CH: "+o[e].max_children+", Min CH: "+o[e].min_children+", Max INF: "+o[e].max_infant+", Min INF: "+o[e].min_infant+")</option>";$('#modal-change :input[name="change-room"]').append(n)}),$("input[name=from]").datepicker("destroy"),$("input[name=to]").datepicker("destroy"),$(".datepicker-from-container").html(""),$(".datepicker-to-container").html("");var s='<label>From</label><div class="form-group"><div class="input-icon"><i class="fa fa-calendar"></i><input class="form-control datepicker" name="from"> </div></div>';$(".datepicker-from-container").append(s),s='<label>To</label><div class="form-group"><div class="input-icon"><i class="fa fa-calendar"></i><input class="form-control datepicker" name="to"> </div></div>',$(".datepicker-to-container").append(s),$(".datepicker").datepicker({format:"MM yyyy",viewMode:"months",minViewMode:"months",autoclose:!0,orientation:"bottom"});var c=moment(t.valid_from,"YYYY-MM-DD"),l=moment(t.valid_to,"YYYY-MM-DD"),m=moment(),d=m,p=m;m.isSameOrBefore(l)&&m.isSameOrAfter(c)?(d=moment(m).startOf("month"),p=moment(m).endOf("month")):m.isBefore(c)?(d=moment(c).startOf("month"),p=moment(c).endOf("month")):m.isAfter(l)&&(d=moment(l).startOf("month"),p=moment(l).endOf("month")),d.isBefore(c)&&(d=c),p.isAfter(l)&&(p=l),$("input[name=from]").datepicker("setStartDate",new Date(c)),$("input[name=from]").datepicker("setEndDate",new Date(l)),$("input[name=to]").datepicker("setStartDate",new Date(c)),$("input[name=to]").datepicker("setEndDate",new Date(l)),$("input[name=from]").datepicker("setDate",new Date(d)),$("input[name=to]").datepicker("setDate",new Date(p)),$("#modal-setting :input[name=setting-from]").datepicker("setStartDate",new Date(c)),$("#modal-setting :input[name=setting-from]").datepicker("setEndDate",new Date(l)),$("#modal-setting :input[name=setting-to]").datepicker("setStartDate",new Date(c)),$("#modal-setting :input[name=setting-to]").datepicker("setEndDate",new Date(l)),$("#modal-import :input[name=import-from]").datepicker("setStartDate",new Date(c)),$("#modal-import :input[name=import-from]").datepicker("setEndDate",new Date(l)),$("#modal-import :input[name=import-to]").datepicker("setStartDate",new Date(c)),$("#modal-import :input[name=import-to]").datepicker("setEndDate",new Date(l))}function y(){$(".share-rooms").hide();var e=s.room_types;if(1<e.length){m.api().clear().draw();for(var t=0;t<e.length;t++)e[t].id!=$('input[name="room-type-id"]').val()&&(m.api().row.add(['<label class="mt-checkbox mt-checkbox-single mt-checkbox-outline"><input type="checkbox" class="checkboxes" value="1" /><span></span></label>',e[t].id,e[t].code,e[t].name]).draw(!1),m.api().columns.adjust().draw());$(".share-container").show()}else $(".share-container").hide()}function Y(e){$("#import-cost-from-rate").empty(),$("#import-cost-from-rate").removeAttr("disabled"),$(".btn-import").removeAttr("disabled"),1<e.length?$("#market option:not(:selected)").each(function(e){var t='<option value="'+$(this).val()+'"> '+$(this).text()+"</option>";$("#import-cost-from-rate").append(t)}):($("#import-cost-from-rate").attr("disabled","disabled"),$(".btn-import").attr("disabled","disabled"))}function x(n){$('#modal-import :input[name="select-room"]').empty(),$.each(n,function(e,t){var a='<option value="'+n[e].id+'" data-name="'+n[e].name+'"> '+n[e].code+": "+n[e].name+" (Max Pax: "+n[e].max_pax+", Min Pax: "+n[e].min_pax+", Max AD: "+n[e].max_adult+", Min AD: "+n[e].min_adult+", Max CH: "+n[e].max_children+", Min CH: "+n[e].min_children+", Max INF: "+n[e].max_infant+", Min INF: "+n[e].min_infant+")</option>";$('#modal-import :input[name="select-room"]').append(a)})}m.find(".group-checkable").change(function(){var e=jQuery(this).attr("data-set"),t=jQuery(this).is(":checked");jQuery(e).each(function(){t?($(this).prop("checked",!0),$(this).parents("tr").addClass("active")):($(this).prop("checked",!1),$(this).parents("tr").removeClass("active"))})}),m.on("change","tbody tr .checkboxes",function(){$(this).parents("tr").toggleClass("active")}),$("input[name=search-code]").on("keyup",function(){m.api().columns(2).search($('input[name="search-code"]').val()).columns(3).search($('input[name="search-name"]').val()).draw()}),$("input[name=search-name]").on("keyup",function(){m.api().columns(2).search($('input[name="search-code"]').val()).columns(3).search($('input[name="search-name"]').val()).draw()}),$('#modal-change :input[name="change-room"]').select2({width:"off"}),$('#modal-import :input[name="select-room"]').select2({width:"off"}),$("#form-use-adult").validate({errorElement:"span",errorClass:"help-block help-block-error",focusInvalid:!1,ignore:"",errorPlacement:function(e,t){0<t.parents(".mt-radio-list").size()||0<t.parents(".mt-checkbox-list").size()?(0<t.parents(".mt-radio-list").size()&&e.appendTo(t.parents(".mt-radio-list")[0]),0<t.parents(".mt-checkbox-list").size()&&e.appendTo(t.parents(".mt-checkbox-list")[0])):0<t.parents(".mt-radio-inline").size()||0<t.parents(".mt-checkbox-inline").size()?(0<t.parents(".mt-radio-inline").size()&&e.appendTo(t.parents(".mt-radio-inline")[0]),0<t.parents(".mt-checkbox-inline").size()&&e.appendTo(t.parents(".mt-checkbox-inline")[0])):0<t.parent(".input-group").size()?e.insertAfter(t.parent(".input-group")):e.insertAfter(t)},invalidHandler:function(e,t){toastr.error("Please check the entry fields.","Error")},highlight:function(e){$(e).closest(".form-group").addClass("has-error")},unhighlight:function(e){$(e).closest(".form-group").removeClass("has-error")},success:function(e){e.closest(".form-group").removeClass("has-error")},submitHandler:function(e){return $(".active-use-adult").each(function(){var e=$(this).attr("data-set");if($(this).prop("checked")){var t=$('input[name="'+e+'_rate"]').val(),a=$("#"+e+"_type").val(),n="";n=1==a?"("+t+"%)":"($"+t+")",$('[data-set="'+e+'"][data-type="rate"]').val(t),$('[data-set="'+e+'"][data-type="type"]').val(a),$(".label_"+e).html("From Adult "+n),$('input[name="'+e+'"]').prop("readonly",!0),$('input[name="'+e+'"]').rules("remove","required"),$('input[name="use-adult-'+e+'"]').prop("checked",!0)}else $('[data-set="'+e+'"][data-type="rate"]').val(""),$('[data-set="'+e+'"][data-type="type"]').val(""),$(".label_"+e).html("From Adult"),$('input[name="'+e+'"]').prop("readonly",!1),$('input[name="'+e+'"]').rules("add","required"),$('input[name="use-adult-'+e+'"]').prop("checked",!1)}),$(".cancel-use-adult").click(),!1}}),jQuery.validator.addMethod("validDate",function(e,t){return this.optional(t)||moment(e,"DD.MM.YYYY",!0).isValid()},"Invalid date, use dd.mm.yyyy.");var _=$("#form-setting");_.validate({errorElement:"span",errorClass:"help-block help-block-error",focusInvalid:!1,ignore:"",rules:{"setting-from":{required:!0,validDate:!0},"setting-to":{required:!0,validDate:!0}},errorPlacement:function(e,t){0<t.parents(".mt-radio-list").size()||0<t.parents(".mt-checkbox-list").size()?(0<t.parents(".mt-radio-list").size()&&e.appendTo(t.parents(".mt-radio-list")[0]),0<t.parents(".mt-checkbox-list").size()&&e.appendTo(t.parents(".mt-checkbox-list")[0])):0<t.parents(".mt-radio-inline").size()||0<t.parents(".mt-checkbox-inline").size()?(0<t.parents(".mt-radio-inline").size()&&e.appendTo(t.parents(".mt-radio-inline")[0]),0<t.parents(".mt-checkbox-inline").size()&&e.appendTo(t.parents(".mt-checkbox-inline")[0])):0<t.parent(".input-group").size()?e.insertAfter(t.parent(".input-group")):t.attr("data-error-container")?e.appendTo(t.attr("data-error-container")):e.insertAfter(t)},invalidHandler:function(e,t){toastr.error("Please check the entry fields.","Error")},highlight:function(e){$(e).closest(".form-group").addClass("has-error")},unhighlight:function(e){$(e).closest(".form-group").removeClass("has-error")},success:function(e){e.closest(".form-group").removeClass("has-error")},submitHandler:function(n){var o=$(n).find("button[type=submit]:focus").attr("data"),t=0;if($('#modal-setting :input[name^="set-"]').each(function(e){1==$(this).prop("checked")&&t++}),$('#modal-setting :input[name^="unset-"]').each(function(e){1==$(this).prop("checked")&&t++}),0==t)$(n).find("button.cancel-form").click();else{var e=new FormData(_[0]),a=$("#market").val(),i=[];$("#modal-setting .range").each(function(){var e={from:$(this).find('input[name^="setting-from"]').val(),to:$(this).find('input[name^="setting-to"]').val()};i.push(e)});var r=function(e){for(var t=[],a=m.api().rows(".active").data(),n=0;n<a.length;n++)t.push(a[n][1]);return t}(),s=$('input[name="room-type-id"]').val();r.push(parseInt(s)),e.append("room-types",JSON.stringify(r)),e.append("ranges",JSON.stringify(i)),e.append("market",a),$.ajax({url:routeSave,type:"POST",data:e,contentType:!1,processData:!1,beforeSend:function(){App.showMask(!0,_)},complete:function(e,t){if(App.showMask(!1,_),"419"==e.status)location.reload(!0);else if("200"!=e.status)toastr.error("Please check your connection and try again.","Error on loading the content");else{var a=$.parseJSON(e.responseText);"success"==a.status?(toastr.success(a.message,"Success"),c=!0,"accept"==o&&($(n).find("button.cancel-form").click(),_[0].reset())):toastr.error(a.message,"Error")}}})}}}),$(".add-row-setting").on("click",function(e){e.preventDefault();var i=$.now(),t='<div class="range range-optional" data="'+i+'"><div class="col-md-5 col-sm-5 col-xs-5"><div class="form-group"><label>From</label><div class="input-icon left"><i class="fa fa-calendar"></i><input type="text" class="form-control date-picker" name="setting-from-'+i+'"></div></div></div><div class="col-md-5 col-sm-5 col-xs-5"><div class="form-group"><label>To</label><div class="input-icon left"><i class="fa fa-calendar"></i><input type="text" class="form-control date-picker" name="setting-to-'+i+'"></div></div></div><div class="col-md-2 col-sm-2 col-xs-2"><div class="form-group"><a class="btn red btn-outline delete-row" href="#" data="'+i+'"><i class="fa fa-trash"></i></a></div></div></div>';$(".range-container").append(t),$('input[name="setting-from-'+i+'"]').datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0,format:"dd.mm.yyyy",orientation:"bottom"}).on("changeDate",function(e){var t=$(this).val(),a=$('input[name="setting-to-'+i+'"]').val(),n=moment(t,"DD.MM.YYYY"),o=moment(a,"DD.MM.YYYY");0==t||""==t||0!=a&&""!=a&&!moment(o).isBefore(n)||$('input[name="setting-to-'+i+'"]').datepicker("setDate",new Date(moment(t,"DD.MM.YYYY")))}),$('input[name="setting-to-'+i+'"]').datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0,format:"dd.mm.yyyy",orientation:"bottom"}).on("changeDate",function(e){var t=$(this).val(),a=$('input[name="setting-from-'+i+'"]').val(),n=moment(a,"DD.MM.YYYY"),o=moment(t,"DD.MM.YYYY");0==t||""==t||0!=a&&""!=a&&!moment(o).isBefore(n)||$('input[name="setting-from-'+i+'"]').datepicker("setDate",new Date(moment(t,"DD.MM.YYYY")))});var a=moment(s.valid_from,"YYYY-MM-DD"),n=moment(s.valid_to,"YYYY-MM-DD");$('input[name="setting-from-'+i+'"]').datepicker("setStartDate",new Date(a)),$('input[name="setting-from-'+i+'"]').datepicker("setEndDate",new Date(n)),$('input[name="setting-to-'+i+'"]').datepicker("setStartDate",new Date(a)),$('input[name="setting-to-'+i+'"]').datepicker("setEndDate",new Date(n)),_.validate(),$('input[name="setting-from-'+i+'"]').rules("add","required"),$('input[name="setting-to-'+i+'"]').rules("add","required"),$('.delete-row[data="'+i+'"]').on("click",function(e){$('.range[data="'+i+'"]').remove(),e.preventDefault()})}),$(".add-row-import").on("click",function(e){e.preventDefault();var i=$.now(),t='<div class="range range-optional" data="'+i+'"><div class="col-md-5 col-sm-5 col-xs-5"><div class="form-group"><label>From</label><div class="input-icon left"><i class="fa fa-calendar"></i><input type="text" class="form-control date-picker" name="import-from-'+i+'"></div></div></div><div class="col-md-5 col-sm-5 col-xs-5"><div class="form-group"><label>To</label><div class="input-icon left"><i class="fa fa-calendar"></i><input type="text" class="form-control date-picker" name="import-to-'+i+'"></div></div></div><div class="col-md-2 col-sm-2 col-xs-2"><div class="form-group"><a class="btn red btn-outline delete-row" href="#" data="'+i+'"><i class="fa fa-trash"></i></a></div></div></div>';$(".import-range-container").append(t),$('input[name="import-from-'+i+'"]').datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0,format:"dd.mm.yyyy",orientation:"bottom"}).on("changeDate",function(e){var t=$(this).val(),a=$('input[name="import-to-'+i+'"]').val(),n=moment(t,"DD.MM.YYYY"),o=moment(a,"DD.MM.YYYY");0==t||""==t||0!=a&&""!=a&&!moment(o).isBefore(n)||$('input[name="import-to-'+i+'"]').datepicker("setDate",new Date(moment(t,"DD.MM.YYYY")))}),$('input[name="import-to-'+i+'"]').datepicker({rtl:App.isRTL(),orientation:"left",autoclose:!0,format:"dd.mm.yyyy",orientation:"bottom"}).on("changeDate",function(e){var t=$(this).val(),a=$('input[name="import-from-'+i+'"]').val(),n=moment(a,"DD.MM.YYYY"),o=moment(t,"DD.MM.YYYY");0==t||""==t||0!=a&&""!=a&&!moment(o).isBefore(n)||$('input[name="import-from-'+i+'"]').datepicker("setDate",new Date(moment(t,"DD.MM.YYYY")))});var a=moment(s.valid_from,"YYYY-MM-DD"),n=moment(s.valid_to,"YYYY-MM-DD");$('input[name="import-from-'+i+'"]').datepicker("setStartDate",new Date(a)),$('input[name="import-from-'+i+'"]').datepicker("setEndDate",new Date(n)),$('input[name="import-to-'+i+'"]').datepicker("setStartDate",new Date(a)),$('input[name="import-to-'+i+'"]').datepicker("setEndDate",new Date(n)),M.validate(),$('input[name="import-from-'+i+'"]').rules("add","required"),$('input[name="import-to-'+i+'"]').rules("add","required"),$('.delete-row[data="'+i+'"]').on("click",function(e){$('.range[data="'+i+'"]').remove(),e.preventDefault()})}),$(".cancel-form").on("click",function(e){c&&($(".btn-search-submit").click(),c=!1)}),$("#market").change(function(){l&&$(".btn-search-submit").click(),Y(s.markets)}),$("input[name=share]").change(function(){$(this).is(":checked")?$(".share-rooms").show():$(".share-rooms").hide()}),$("input[name=change]").change(function(){$(this).is(":checked")&&($('#modal-change :input[name="change-room"]').val($('#modal-setting :input[name="room-type-id"]').val()).trigger("change"),$("#modal-change").modal("show"))}),$(".cancel-change").on("click",function(e){$("#modal-setting :input[name=change]").prop("checked",""),$("#modal-setting :input[name=change]").val(0)}),$(".accept-change").on("click",function(e){for(var t=$('#modal-change :input[name="change-room"]').val(),a=s.room_types,n=null,o=0;o<a.length;o++)if(t==a[o].id){n=a[o];break}$('#modal-setting :input[name="room-type-id"]').val(t),$("#modal-setting .room-name-header").html(n.code+": "+n.name),$(".cancel-change").click(),y(),x(a),$("#modal-setting :input[name=share]").prop("checked",""),$("#modal-setting :input[name=share]").val(0)}),$("#modal-import [id=rate_fee_value]").TouchSpin({min:-1e9,max:1e9,stepinterval:50,decimals:2,maxboostedstep:1e7,prefix:"$"}),$("#modal-import [id=rate_percent_value]").TouchSpin({min:-1e9,max:1e9,step:1,decimals:2,maxboostedstep:1e7,postfix:"%"}),$("input[name=add-value]").on("click",function(e){$(this).is(":checked")?($('input[name="rate_fee_value"]').removeAttr("disabled"),$('input[data-target="rate_fee_value"]').removeAttr("disabled"),$('input[data-target="rate_percent_value"]').removeAttr("disabled"),$(".add-value-container").show()):($(".add-value-container").hide(),$('input[name="rate_fee_value"]').attr("disabled","disabled").val(""),$('input[name="rate_percent_value"]').attr("disabled","disabled").val(""),$('input[data-target="rate_fee_value"]').attr("disabled","disabled").prop("checked",!0),$('input[data-target="rate_percent_value"]').attr("disabled","disabled"))}),$('input[name="rate_type"]').change(function(){1==$(this).val()?($('input[name="rate_fee_value"]').attr("disabled","disabled").val(""),$('input[name="rate_percent_value"]').removeAttr("disabled")):($('input[name="rate_percent_value"]').attr("disabled","disabled").val(""),$('input[name="rate_fee_value"]').removeAttr("disabled"))}),$(".cancel-use-adult").on("click",function(e){$(".use-adult-input-rate").each(function(){$(this).rules("remove","required")})});var M=$("#form-import");M.validate({errorElement:"span",errorClass:"help-block help-block-error",focusInvalid:!1,ignore:"",rules:{"import-from":{required:!0,validDate:!0},"import-to":{required:!0,validDate:!0}},errorPlacement:function(e,t){0<t.parents(".mt-radio-list").size()||0<t.parents(".mt-checkbox-list").size()?(0<t.parents(".mt-radio-list").size()&&e.appendTo(t.parents(".mt-radio-list")[0]),0<t.parents(".mt-checkbox-list").size()&&e.appendTo(t.parents(".mt-checkbox-list")[0])):0<t.parents(".mt-radio-inline").size()||0<t.parents(".mt-checkbox-inline").size()?(0<t.parents(".mt-radio-inline").size()&&e.appendTo(t.parents(".mt-radio-inline")[0]),0<t.parents(".mt-checkbox-inline").size()&&e.appendTo(t.parents(".mt-checkbox-inline")[0])):0<t.parent(".input-group").size()?e.insertAfter(t.parent(".input-group")):t.attr("data-error-container")?e.appendTo(t.attr("data-error-container")):e.insertAfter(t)},invalidHandler:function(e,t){toastr.error("Please check the entry fields.","Error")},highlight:function(e){$(e).closest(".form-group").addClass("has-error")},unhighlight:function(e){$(e).closest(".form-group").removeClass("has-error")},success:function(e){e.closest(".form-group").removeClass("has-error")},submitHandler:function(n){var e=$('#modal-setting :input[name="contract-id"]').val(),t=$('#modal-setting :input[name="room-type-id"]').val(),a=$('#modal-setting :input[name="market-id"]').val(),o=new FormData(M[0]),i=[];$("#modal-import .range").each(function(){var e={from:$(this).find('input[name^="import-from"]').val(),to:$(this).find('input[name^="import-to"]').val()};i.push(e)}),o.append("ranges",JSON.stringify(i)),o.append("contract-id",e),o.append("room-type-id",t),o.append("market-id",a),$.ajax({url:routeImportCostFromRoomtype,type:"POST",data:o,contentType:!1,processData:!1,beforeSend:function(){App.showMask(!0,M)},complete:function(e,t){if(App.showMask(!1,M),"419"==e.status)location.reload(!0);else if("200"!=e.status)toastr.error("Please check your connection and try again.","Error on loading the content");else{var a=$.parseJSON(e.responseText);"success"==a.status?(toastr.success(a.message,"Success"),c=!0,$(n).find("button.cancel-import").click(),M[0].reset()):toastr.error(a.message,"Error")}}})}})});